var Se=require("siyuan");async function p(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(o){throw o}}async function h(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function Y(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light";n.getAttribute("data-asri-palette")==="amber"&&n.removeAttribute("data-asri-palette");let i=await h(e,t);if(i&&i["asri-enhance-amber"]){let r=i["asri-enhance-amber"];typeof r=="boolean"?delete i["asri-enhance-amber"]:(r[o]=!1,i["asri-enhance-amber"]=r),await p(e,t,i)}}async function X(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light";n.getAttribute("data-asri-palette")==="wilderness"&&n.removeAttribute("data-asri-palette");let i=await h(e,t);if(i&&i["asri-enhance-wilderness"]){let r=i["asri-enhance-wilderness"];typeof r=="boolean"?delete i["asri-enhance-wilderness"]:(r[o]=!1,i["asri-enhance-wilderness"]=r),await p(e,t,i)}}async function J(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light";n.getAttribute("data-asri-palette")==="midnight"&&n.removeAttribute("data-asri-palette");let i=await h(e,t);if(i&&i["asri-enhance-midnight"]){let r=i["asri-enhance-midnight"];typeof r=="boolean"?delete i["asri-enhance-midnight"]:(r[o]=!1,i["asri-enhance-midnight"]=r),await p(e,t,i)}}async function Q(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light";n.getAttribute("data-asri-palette")==="salt"&&n.removeAttribute("data-asri-palette");let i=await h(e,t);if(i&&i["asri-enhance-salt"]){let r=i["asri-enhance-salt"];typeof r=="boolean"?delete i["asri-enhance-salt"]:(r[o]=!1,i["asri-enhance-salt"]=r),await p(e,t,i)}}async function ge(e,t="config.json"){let n=document.documentElement;if(!n)return;(n.getAttribute("data-asri-palette")==="amber"||n.getAttribute("data-asri-palette")==="wilderness"||n.getAttribute("data-asri-palette")==="midnight"||n.getAttribute("data-asri-palette")==="salt")&&n.removeAttribute("data-asri-palette"),n.hasAttribute("data-asri-enhance-coloredheading")&&n.removeAttribute("data-asri-enhance-coloredheading");let o=await h(e,t);if(o){let i=Object.keys(o).filter(r=>r.startsWith("asri-enhance-"));i.length>0&&(i.forEach(r=>{delete o[r]}),await p(e,t,o))}}var Z="config.json";async function P(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";if(o.getAttribute("data-asri-palette")===t.name)return;let a=await h(e,Z)||{},l=a[t.configKey]||{light:!1,dark:!1},c=()=>{o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name),l[i]=!0;for(let u of t.otherConfigKeys)if(a[u]){let m=a[u];typeof m=="object"&&(m[i]=!1,a[u]=m)}a[t.configKey]=l};document.startViewTransition?await document.startViewTransition(()=>{c()}).finished.catch(()=>{}):c(),await p(e,Z,a).catch(()=>{})}async function T(e,t){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light",i=await h(e,Z);if(i&&i[t.configKey]){let r=i[t.configKey];(typeof r=="boolean"?r:r[o]===!0)?(n.removeAttribute("data-asri-palette"),n.setAttribute("data-asri-palette",t.name)):n.getAttribute("data-asri-palette")===t.name&&n.removeAttribute("data-asri-palette")}}var be={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt"]};async function pe(e,t){return P(e,be,t)}async function R(e){return T(e,be)}var ve={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt"]};async function we(e,t){return P(e,ve,t)}async function K(e){return T(e,ve)}var ye={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt"]};async function Ee(e,t){return P(e,ye,t)}async function j(e){return T(e,ye)}var Ce={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight"]};async function Me(e,t){return P(e,Ce,t)}async function q(e){return T(e,Ce)}var ee="config.json",te="asri-enhance-coloredheading";async function Pe(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-coloredheading"),i=await h(e,ee)||{};o?(n.removeAttribute("data-asri-enhance-coloredheading"),i[te]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),i[te]=!0),await p(e,ee,i).catch(()=>{})}async function W(e){let t=document.documentElement;if(!t)return;let n=await h(e,ee);n&&n[te]===!0?t.setAttribute("data-asri-enhance-coloredheading","true"):t.removeAttribute("data-asri-enhance-coloredheading")}var ne="config.json",ie="asri-enhance-coloredoutline";async function Te(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-coloredoutline"),i=await h(e,ne)||{};o?(n.removeAttribute("data-asri-enhance-coloredoutline"),i[ie]=!1):(n.setAttribute("data-asri-enhance-coloredoutline","true"),i[ie]=!0),await p(e,ne,i).catch(()=>{})}async function V(e){let t=document.documentElement;if(!t)return;let n=await h(e,ne);n&&n[ie]===!0?t.setAttribute("data-asri-enhance-coloredoutline","true"):t.removeAttribute("data-asri-enhance-coloredoutline")}var oe="config.json",re="asri-enhance-typewriter",z=null,ae=!1,G=!1,M=null,x=!1,Ne=500;function Be(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,o;if(n.nodeType===Node.TEXT_NODE?o=n.parentElement:o=n.nodeType===Node.ELEMENT_NODE?n:null,o){let i=o;for(;i&&i!==document.body;){if(i.hasAttribute&&i.hasAttribute("contenteditable"))return o;i=i.parentElement}}return null}function Fe(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth,i=t.top+t.height/2,r=t.left+t.width/2,a=n/2,l=o/2,c=Math.abs(i-a),u=Math.abs(r-l);return c>5||u>5}function Re(e){e&&Fe(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function Ke(){let e=null,t=()=>{if(!ae||G||x)return;let r=Be();r!==e&&(e=r,r&&setTimeout(()=>{Re(r)},50))},n=()=>{G=!0,x=!1,M=window.setTimeout(()=>{x=!0},Ne)},o=()=>{G=!1,M&&(clearTimeout(M),M=null),x?setTimeout(()=>{x=!1},200):setTimeout(t,10)},i=()=>{G=!1,x=!1,M&&(clearTimeout(M),M=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",o),document.addEventListener("mouseleave",i),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",o),document.removeEventListener("mouseleave",i),M&&(clearTimeout(M),M=null)}}}function Ae(){z&&U(),ae=!0,z=Ke()}function U(){ae=!1,z&&(z.destroy(),z=null)}async function ke(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-typewriter"),i=await h(e,oe)||{};o?(n.removeAttribute("data-asri-enhance-typewriter"),i[re]=!1,U()):(n.setAttribute("data-asri-enhance-typewriter","true"),i[re]=!0,Ae()),await p(e,oe,i).catch(()=>{})}async function $(e){let t=document.documentElement;if(!t)return;let n=await h(e,oe);n&&n[re]===!0?(t.setAttribute("data-asri-enhance-typewriter","true"),Ae()):(t.removeAttribute("data-asri-enhance-typewriter"),U())}function Le(e,t,n=100){let o,i,r=null,a=0,l=new Set,c=10,u=100,m=()=>{l.forEach(d=>window.clearTimeout(d)),l.clear()},k=(d,g)=>{let w=window.setTimeout(()=>{l.delete(w),d()},g);return l.add(w),w},s=d=>{o!==void 0&&window.clearTimeout(o),o=window.setTimeout(()=>{m();let g=(w=0)=>{var D,S,N,E,B;let _=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(_){let C=_.parentElement;if(C){if(!C.querySelector("#asri-enhance-palette")){let v=document.createElement("button");v.className="b3-menu__item asri-enhance",v.id="asri-enhance-palette",v.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((N=e.i18n)==null?void 0:N.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((E=e.i18n)==null?void 0:E.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((B=e.i18n)==null?void 0:B.salt)||"salt"}</span></button></div></div>`,C.insertBefore(v,_)}let F=C.querySelector("#asri-enhance-amber");F&&(F.onclick=v=>pe(e,v));let b=C.querySelector("#asri-enhance-wilderness");b&&(b.onclick=v=>we(e,v));let fe=C.querySelector("#asri-enhance-midnight");fe&&(fe.onclick=v=>Ee(e,v));let he=C.querySelector("#asri-enhance-salt");he&&(he.onclick=v=>Me(e,v))}t(d);return}w+1<c?k(()=>g(w+1),u):t(d)};g(),o=void 0},n)},f=()=>{let d=document.querySelector("#barMode");if(d){r=d,d.addEventListener("click",s,!0),i=void 0;return}a+=1,a<c?i=window.setTimeout(f,u):i=void 0};return f(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),m(),r&&(r.removeEventListener("click",s,!0),r=null),o!==void 0&&(window.clearTimeout(o),o=void 0)}}function _e(e,t=100){let n,o,i=null,r=0,a=new Set,l=10,c=100,u=()=>{a.forEach(f=>window.clearTimeout(f)),a.clear()},m=(f,d)=>{let g=window.setTimeout(()=>{a.delete(g),f()},d);return a.add(g),g},k=f=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{u();let d=(g=0)=>{var _,D,S,N;let w=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(w){let E=w.parentElement;if(E){if(!E.querySelector("#asri-enhance-more")){let b=document.createElement("button");b.className="b3-menu__item asri-enhance",b.id="asri-enhance-more",b.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((_=e.i18n)==null?void 0:_.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-colored-heading"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.coloredHeading)||"coloredHeading"}</span></button><button class="b3-menu__item" id="asri-enhance-colored-outline"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.coloredOutline)||"coloredOutline"}</span></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((N=e.i18n)==null?void 0:N.typewriterMode)||"typewriterMode"}</span></button></div></div>`,w.nextSibling?E.insertBefore(b,w.nextSibling):E.appendChild(b)}let B=E.querySelector("#asri-enhance-colored-heading");B&&(B.onclick=b=>Pe(e,b));let C=E.querySelector("#asri-enhance-colored-outline");C&&(C.onclick=b=>Te(e,b));let F=E.querySelector("#asri-enhance-typewriter");F&&(F.onclick=b=>ke(e,b))}return}g+1<l&&m(()=>d(g+1),c)};d(),n=void 0},t)},s=()=>{let f=document.querySelector("#barMode");if(f){i=f,f.addEventListener("click",k,!0),o=void 0;return}r+=1,r<l?o=window.setTimeout(s,c):o=void 0};return s(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),u(),i&&(i.removeEventListener("click",k,!0),i=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var le=!1,A=null,se=0,y=null,H=null,I=null,O=null;function ce(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function L(){if(le=!1,y=null,A!==null&&(clearInterval(A),A=null),H){try{H.disconnect()}catch(e){}H=null}if(I){try{I.disconnect()}catch(e){}I=null}}function ue(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function me(){if(y){if(!H){H=new MutationObserver(()=>{ue(y)||L()});try{H.observe(y,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!I){I=new MutationObserver(()=>{ue(y)||L()});try{I.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function je(){let e=ce();return e?(y=e,me(),!0):(se=0,A=setInterval(()=>{se+=1;let t=ce();t?(y=t,clearInterval(A),A=null,me()):se>=10&&(clearInterval(A),A=null,L())},100),!1)}function qe(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function Ie(e){return e?e.querySelector(".b3-list-item--focus"):null}function ze(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function Ue(e,t,n){if(!t||e.length===0)return null;let o=t.getBoundingClientRect(),i={x:o.left+o.width/2,y:o.top+o.height/2,el:t},r=ze(e),a=Math.max(o.width/2,10),l;switch(n){case"ArrowUp":l=s=>s.y<i.y-1&&Math.abs(s.x-i.x)<=a;break;case"ArrowDown":l=s=>s.y>i.y+1&&Math.abs(s.x-i.x)<=a;break;case"ArrowLeft":l=s=>s.x<i.x-1;break;case"ArrowRight":l=s=>s.x>i.x+1;break;default:return null}let c=r.filter(s=>s.el!==t&&l(s));if(c.length===0)return null;let u=(s,f)=>{let d=s.x-f.x,g=s.y-f.y;return d*d+g*g},m=c[0],k=u(m,i);for(let s=1;s<c.length;s++){let f=u(c[s],i);f<k&&(m=c[s],k=f)}return m.el}function xe(e){if(!y||!e)return;let t=Ie(y);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function We(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[0])!=null?o:null:n+1<e.length?e[n+1]:(i=e[0])!=null?i:null}function Ve(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[e.length-1])!=null?o:null:n-1>=0?e[n-1]:(i=e[e.length-1])!=null?i:null}function He(e,t){let n=t.getBoundingClientRect(),o=n.top+n.height/2,i=[];for(let r of e){if(r===t)continue;let a=r.getBoundingClientRect(),l=a.top+a.height/2,c=Math.min(n.height,a.height)/2;Math.abs(l-o)<=c&&i.push(r)}return i}function Ge(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function $e(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var Ye=e=>{var c,u;if(e.key==="/"){L(),le=!0,je();return}if(!le)return;if(e.key==="Escape"){L();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=y||ce();if(!n||!ue(n)){L();return}e.preventDefault(),e.stopPropagation(),y=n,me();let o=qe(n);if(o.length===0)return;let i=Ie(n);i||(i=o[0],i.classList.add("b3-list-item--focus"));let r=Ue(o,i,e.key);if(r){xe(r);return}let a=null,l=e.key;if(l==="ArrowDown")a=We(o,i);else if(l==="ArrowUp")a=Ve(o,i);else if(l==="ArrowRight"){let m=He(o,i);m.length>0&&(a=(c=Ge(m)[0])!=null?c:null)}else if(l==="ArrowLeft"){let m=He(o,i);m.length>0&&(a=(u=$e(m)[0])!=null?u:null)}a&&a!==i&&xe(a)};function Oe(){typeof document!="undefined"&&(O||(O=Ye,document.addEventListener("keydown",O,{capture:!0})))}function De(){typeof document!="undefined"&&(O&&(document.removeEventListener("keydown",O,{capture:!0}),O=null),L())}var de=class extends Se.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null}async onload(){this.unsubscribeBarModeClick=Le(this,()=>{}),this.unsubscribeTopbarFusionPlus=_e(this),this.asriConfigClickHandler=o=>{let i=o.target;if(!i||i.closest("#asri-enhance-amber")||i.closest("#asri-enhance-wilderness")||i.closest("#asri-enhance-midnight")||i.closest("#asri-enhance-salt"))return;let r=i.closest(".asri-config");r&&r.id!=="topbarFusionPlus"&&(Y(this,"config.json").catch(()=>{}),X(this,"config.json").catch(()=>{}),J(this,"config.json").catch(()=>{}),Q(this,"config.json").catch(()=>{}))},document.addEventListener("click",this.asriConfigClickHandler,!0);let n=document.documentElement;n&&(this.themeModeObserver=new MutationObserver(o=>{for(let i of o)i.type==="attributes"&&i.attributeName==="data-theme-mode"&&(R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),q(this).catch(()=>{}))}),this.themeModeObserver.observe(n,{attributes:!0,attributeFilter:["data-theme-mode"]})),R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),q(this).catch(()=>{}),W(this).catch(()=>{}),V(this).catch(()=>{}),$(this).catch(()=>{}),Oe(),setTimeout(()=>{R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),q(this).catch(()=>{}),W(this).catch(()=>{}),V(this).catch(()=>{}),$(this).catch(()=>{})},500),setTimeout(()=>{R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),q(this).catch(()=>{}),W(this).catch(()=>{}),V(this).catch(()=>{}),$(this).catch(()=>{})},1500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),U(),De()}async uninstall(){this.onunload(),await ge(this,"config.json").catch(()=>{})}};module.exports=de;
