var lt=require("siyuan");var Le="asri-enhance-",xe=["amber","wilderness","midnight","salt","rosepine","topaz","oxygen"];async function E(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(i){throw i}}async function p(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function _e(e,t,n="config.json"){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";i.getAttribute("data-asri-palette")===t&&i.removeAttribute("data-asri-palette");let r=await p(e,n);if(!r)return;let s=`${Le}${t}`,a=r[s];a!==void 0&&(typeof a=="boolean"?delete r[s]:a&&typeof a=="object"&&(a[o]=!1,r[s]=a),await E(e,n,r))}async function ke(e,t="config.json"){let n=await p(e,t);if(!n)return;let i=!1;Object.keys(n).forEach(o=>{o.startsWith(Le)&&(delete n[o],i=!0)}),i&&await E(e,t,n)}var ne="config.json";async function v(e,t,n){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";if(i.getAttribute("data-asri-palette")===t.name)return;let s=await p(e,ne)||{},a=s[t.configKey]||{light:!1,dark:!1},c=()=>{i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",t.name),a[o]=!0;for(let u of t.otherConfigKeys)if(s[u]){let m=s[u];typeof m=="object"&&(m[o]=!1,s[u]=m)}s[t.configKey]=a};document.startViewTransition?await document.startViewTransition(()=>{c()}).finished.catch(()=>{}):c(),await E(e,ne,s).catch(()=>{})}async function w(e,t){let n=document.documentElement;if(!n)return;let i=n.getAttribute("data-theme-mode")||"light",o=await p(e,ne);if(o&&o[t.configKey]){let r=o[t.configKey];(typeof r=="boolean"?r:r[i]===!0)?(n.removeAttribute("data-asri-palette"),n.setAttribute("data-asri-palette",t.name)):n.getAttribute("data-asri-palette")===t.name&&n.removeAttribute("data-asri-palette")}}var Ae={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen"]};async function He(e,t){return v(e,Ae,t)}async function j(e){return w(e,Ae)}var Ie={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen"]};async function Oe(e,t){return v(e,Ie,t)}async function q(e){return w(e,Ie)}var Ne={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen"]};async function Se(e,t){return v(e,Ne,t)}async function $(e){return w(e,Ne)}var Be={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen"]};async function De(e,t){return v(e,Be,t)}async function G(e){return w(e,Be)}var Fe={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen"]};async function Re(e,t){return v(e,Fe,t)}async function V(e){return w(e,Fe)}var ze={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen"]};async function Ke(e,t){return v(e,ze,t)}async function U(e){return w(e,ze)}var je={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz"]};async function qe(e,t){return v(e,je,t)}async function W(e){return w(e,je)}var oe="config.json",ie="asri-enhance-coloredheading";async function $e(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredheading"),o=await p(e,oe)||{};i?(n.removeAttribute("data-asri-enhance-coloredheading"),o[ie]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),o[ie]=!0),await E(e,oe,o).catch(()=>{})}async function Z(e){let t=document.documentElement;if(!t)return;let n=await p(e,oe);n&&n[ie]===!0?t.setAttribute("data-asri-enhance-coloredheading","true"):t.removeAttribute("data-asri-enhance-coloredheading")}var re="config.json",se="asri-enhance-coloredoutline";async function Ge(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredoutline"),o=await p(e,re)||{};i?(n.removeAttribute("data-asri-enhance-coloredoutline"),o[se]=!1):(n.setAttribute("data-asri-enhance-coloredoutline","true"),o[se]=!0),await E(e,re,o).catch(()=>{})}async function J(e){let t=document.documentElement;if(!t)return;let n=await p(e,re);n&&n[se]===!0?t.setAttribute("data-asri-enhance-coloredoutline","true"):t.removeAttribute("data-asri-enhance-coloredoutline")}var ae="config.json",le="asri-enhance-typewriter",Y=null,ce=!1,Q=!1,T=null,A=!1,ct=500;function ut(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,i;if(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n.nodeType===Node.ELEMENT_NODE?n:null,i){let o=i;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return i;o=o.parentElement}}return null}function mt(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,i=window.innerWidth,o=t.top+t.height/2,r=t.left+t.width/2,s=n/2,a=i/2,c=Math.abs(o-s),u=Math.abs(r-a);return c>5||u>5}function dt(e){e&&mt(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function ht(){let e=null,t=()=>{if(!ce||Q||A)return;let r=ut();r!==e&&(e=r,r&&setTimeout(()=>{dt(r)},50))},n=()=>{Q=!0,A=!1,T=window.setTimeout(()=>{A=!0},ct)},i=()=>{Q=!1,T&&(clearTimeout(T),T=null),A?setTimeout(()=>{A=!1},200):setTimeout(t,10)},o=()=>{Q=!1,A=!1,T&&(clearTimeout(T),T=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",o),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",o),T&&(clearTimeout(T),T=null)}}}function Ve(){Y&&X(),ce=!0,Y=ht()}function X(){ce=!1,Y&&(Y.destroy(),Y=null)}async function Ue(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-typewriter"),o=await p(e,ae)||{};i?(n.removeAttribute("data-asri-enhance-typewriter"),o[le]=!1,X()):(n.setAttribute("data-asri-enhance-typewriter","true"),o[le]=!0,Ve()),await E(e,ae,o).catch(()=>{})}async function ee(e){let t=document.documentElement;if(!t)return;let n=await p(e,ae);n&&n[le]===!0?(t.setAttribute("data-asri-enhance-typewriter","true"),Ve()):(t.removeAttribute("data-asri-enhance-typewriter"),X())}var ue="config.json",me="asri-enhance-listbulletline",ft=".asri-bullet-highlight,.asri-bullet-line",Ye="asri-bullet-highlight",Xe="asri-bullet-line",Ze="--asri-bullet-line-height",H=null,de=()=>{document.querySelectorAll(ft).forEach(e=>{e.classList.remove(Ye,Xe),e.style.removeProperty(Ze)})},We=()=>{var i,o;de();let e=window.getSelection();if(!e||!e.rangeCount)return;let t=[],n=e.getRangeAt(0).startContainer;for(;n&&n.nodeType!==Node.ELEMENT_NODE;)n=n.parentElement;for(;n;){let r=n;if(((i=r.dataset)==null?void 0:i.type)==="NodeListItem"&&t.push(r),(o=r.classList)!=null&&o.contains("protyle-wysiwyg"))break;n=r.parentElement}t.forEach((r,s)=>{if(r.classList.add(Ye),s<t.length-1){let a=r.getBoundingClientRect(),c=t[s+1].getBoundingClientRect();r.style.setProperty(Ze,`${a.top-c.top}px`),r.classList.add(Xe)}})},Je=()=>{H||(H=()=>{We()},document.addEventListener("selectionchange",H),We())},he=()=>{if(!H){de();return}document.removeEventListener("selectionchange",H),H=null,de()};async function Qe(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-listbulletline"),o=await p(e,ue)||{};i?(n.removeAttribute("data-asri-enhance-listbulletline"),o[me]=!1,he()):(n.setAttribute("data-asri-enhance-listbulletline","true"),o[me]=!0,Je()),await E(e,ue,o).catch(()=>{})}async function te(e){let t=document.documentElement;if(!t)return;let n=await p(e,ue);n&&n[me]===!0?(t.setAttribute("data-asri-enhance-listbulletline","true"),Je()):(t.removeAttribute("data-asri-enhance-listbulletline"),he())}var et=()=>{he()};function tt(e,t,n=100){let i,o,r=null,s=0,a=new Set,c=10,u=100,m=()=>{a.forEach(d=>window.clearTimeout(d)),a.clear()},x=(d,b)=>{let C=window.setTimeout(()=>{a.delete(C),d()},b);return a.add(C),C},l=d=>{i!==void 0&&window.clearTimeout(i),i=window.setTimeout(()=>{m();let b=(C=0)=>{var S,B,D,F,P,R,z,K;let k=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(k){let y=k.parentElement;if(y){if(!y.querySelector("#asri-enhance-palette")){let h=document.createElement("button");h.className="b3-menu__item asri-enhance",h.id="asri-enhance-palette",h.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((B=e.i18n)==null?void 0:B.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((F=e.i18n)==null?void 0:F.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((P=e.i18n)==null?void 0:P.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((R=e.i18n)==null?void 0:R.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.oxygen)||"Oxygen"}</span></button></div></div>`,y.insertBefore(h,k)}let g=y.querySelector("#asri-enhance-amber");g&&(g.onclick=h=>He(e,h));let ye=y.querySelector("#asri-enhance-wilderness");ye&&(ye.onclick=h=>Oe(e,h));let Ee=y.querySelector("#asri-enhance-midnight");Ee&&(Ee.onclick=h=>Se(e,h));let Ce=y.querySelector("#asri-enhance-salt");Ce&&(Ce.onclick=h=>De(e,h));let Pe=y.querySelector("#asri-enhance-rosepine");Pe&&(Pe.onclick=h=>Re(e,h));let Me=y.querySelector("#asri-enhance-topaz");Me&&(Me.onclick=h=>Ke(e,h));let Te=y.querySelector("#asri-enhance-oxygen");Te&&(Te.onclick=h=>qe(e,h))}t(d);return}C+1<c?x(()=>b(C+1),u):t(d)};b(),i=void 0},n)},f=()=>{let d=document.querySelector("#barMode");if(d){r=d,d.addEventListener("click",l,!0),o=void 0;return}s+=1,s<c?o=window.setTimeout(f,u):o=void 0};return f(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),m(),r&&(r.removeEventListener("click",l,!0),r=null),i!==void 0&&(window.clearTimeout(i),i=void 0)}}function nt(e,t=100){let n,i,o=null,r=0,s=new Set,a=10,c=100,u=()=>{s.forEach(f=>window.clearTimeout(f)),s.clear()},m=(f,d)=>{let b=window.setTimeout(()=>{s.delete(b),f()},d);return s.add(b),b},x=f=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{u();let d=(b=0)=>{var k,S,B,D,F;let C=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(C){let P=C.parentElement;if(P){if(!P.querySelector("#asri-enhance-more")){let g=document.createElement("button");g.className="b3-menu__item asri-enhance",g.id="asri-enhance-more",g.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((k=e.i18n)==null?void 0:k.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-colored-heading"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.coloredHeading)||"coloredHeading"}</span></button><button class="b3-menu__item" id="asri-enhance-colored-outline"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((B=e.i18n)==null?void 0:B.coloredOutline)||"coloredOutline"}</span></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((F=e.i18n)==null?void 0:F.listBulletLine)||"listBulletLine"}</span></button></div></div>`,C.nextSibling?P.insertBefore(g,C.nextSibling):P.appendChild(g)}let R=P.querySelector("#asri-enhance-colored-heading");R&&(R.onclick=g=>$e(e,g));let z=P.querySelector("#asri-enhance-colored-outline");z&&(z.onclick=g=>Ge(e,g));let K=P.querySelector("#asri-enhance-typewriter");K&&(K.onclick=g=>Ue(e,g));let y=P.querySelector("#asri-enhance-list-bullet-line");y&&(y.onclick=g=>Qe(e,g))}return}b+1<a&&m(()=>d(b+1),c)};d(),n=void 0},t)},l=()=>{let f=document.querySelector("#barMode");if(f){o=f,f.addEventListener("click",x,!0),i=void 0;return}r+=1,r<a?i=window.setTimeout(l,c):i=void 0};return l(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),u(),o&&(o.removeEventListener("click",x,!0),o=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var pe=!1,L=null,fe=0,M=null,I=null,O=null,N=null;function ge(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function _(){if(pe=!1,M=null,L!==null&&(clearInterval(L),L=null),I){try{I.disconnect()}catch(e){}I=null}if(O){try{O.disconnect()}catch(e){}O=null}}function be(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function ve(){if(M){if(!I){I=new MutationObserver(()=>{be(M)||_()});try{I.observe(M,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!O){O=new MutationObserver(()=>{be(M)||_()});try{O.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function pt(){let e=ge();return e?(M=e,ve(),!0):(fe=0,L=setInterval(()=>{fe+=1;let t=ge();t?(M=t,clearInterval(L),L=null,ve()):fe>=10&&(clearInterval(L),L=null,_())},100),!1)}function gt(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function rt(e){return e?e.querySelector(".b3-list-item--focus"):null}function bt(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function vt(e,t,n){if(!t||e.length===0)return null;let i=t.getBoundingClientRect(),o={x:i.left+i.width/2,y:i.top+i.height/2,el:t},r=bt(e),s=Math.max(i.width/2,10),a;switch(n){case"ArrowUp":a=l=>l.y<o.y-1&&Math.abs(l.x-o.x)<=s;break;case"ArrowDown":a=l=>l.y>o.y+1&&Math.abs(l.x-o.x)<=s;break;case"ArrowLeft":a=l=>l.x<o.x-1;break;case"ArrowRight":a=l=>l.x>o.x+1;break;default:return null}let c=r.filter(l=>l.el!==t&&a(l));if(c.length===0)return null;let u=(l,f)=>{let d=l.x-f.x,b=l.y-f.y;return d*d+b*b},m=c[0],x=u(m,o);for(let l=1;l<c.length;l++){let f=u(c[l],o);f<x&&(m=c[l],x=f)}return m.el}function ot(e){if(!M||!e)return;let t=rt(M);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function wt(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[0])!=null?i:null:n+1<e.length?e[n+1]:(o=e[0])!=null?o:null}function yt(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[e.length-1])!=null?i:null:n-1>=0?e[n-1]:(o=e[e.length-1])!=null?o:null}function it(e,t){let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=[];for(let r of e){if(r===t)continue;let s=r.getBoundingClientRect(),a=s.top+s.height/2,c=Math.min(n.height,s.height)/2;Math.abs(a-i)<=c&&o.push(r)}return o}function Et(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function Ct(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var Pt=e=>{var c,u;if(e.key==="/"){_(),pe=!0,pt();return}if(!pe)return;if(e.key==="Escape"){_();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=M||ge();if(!n||!be(n)){_();return}e.preventDefault(),e.stopPropagation(),M=n,ve();let i=gt(n);if(i.length===0)return;let o=rt(n);o||(o=i[0],o.classList.add("b3-list-item--focus"));let r=vt(i,o,e.key);if(r){ot(r);return}let s=null,a=e.key;if(a==="ArrowDown")s=wt(i,o);else if(a==="ArrowUp")s=yt(i,o);else if(a==="ArrowRight"){let m=it(i,o);m.length>0&&(s=(c=Et(m)[0])!=null?c:null)}else if(a==="ArrowLeft"){let m=it(i,o);m.length>0&&(s=(u=Ct(m)[0])!=null?u:null)}s&&s!==o&&ot(s)};function st(){typeof document!="undefined"&&(N||(N=Pt,document.addEventListener("keydown",N,{capture:!0})))}function at(){typeof document!="undefined"&&(N&&(document.removeEventListener("keydown",N,{capture:!0}),N=null),_())}var we=class extends lt.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null}async onload(){this.unsubscribeBarModeClick=tt(this,()=>{}),this.unsubscribeTopbarFusionPlus=nt(this),this.asriConfigClickHandler=i=>{let o=i.target;if(!o||o.closest("#asri-enhance-amber")||o.closest("#asri-enhance-wilderness")||o.closest("#asri-enhance-midnight")||o.closest("#asri-enhance-salt")||o.closest("#asri-enhance-rosepine")||o.closest("#asri-enhance-topaz")||o.closest("#asri-enhance-oxygen"))return;let r=o.closest(".asri-config");r&&r.id!=="topbarFusionPlus"&&xe.forEach(s=>{_e(this,s,"config.json").catch(()=>{})})},document.addEventListener("click",this.asriConfigClickHandler,!0);let n=document.documentElement;n&&(this.themeModeObserver=new MutationObserver(i=>{for(let o of i)o.type==="attributes"&&o.attributeName==="data-theme-mode"&&(j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),G(this).catch(()=>{}),V(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}))}),this.themeModeObserver.observe(n,{attributes:!0,attributeFilter:["data-theme-mode"]})),j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),G(this).catch(()=>{}),V(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Z(this).catch(()=>{}),J(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{}),st(),setTimeout(()=>{j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),G(this).catch(()=>{}),V(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Z(this).catch(()=>{}),J(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{})},500),setTimeout(()=>{j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),G(this).catch(()=>{}),V(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Z(this).catch(()=>{}),J(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{})},1500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),et(),X(),at()}async uninstall(){this.onunload(),await ke(this,"config.json").catch(()=>{})}};module.exports=we;
