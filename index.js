var Hn=require("siyuan");var Le="asri-enhance-",xe=["amber","wilderness","midnight","salt","rosepine","topaz","oxygen","shade","gruvbox","glitch"];async function p(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(o){throw o}}async function u(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function mt(e,t,n="config.json"){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";o.getAttribute("data-asri-palette")===t&&o.removeAttribute("data-asri-palette");let r=await u(e,n);if(!r)return;let a=`${Le}${t}`,l=r[a];l!==void 0&&(typeof l=="boolean"?delete r[a]:l&&typeof l=="object"&&(l[i]=!1,r[a]=l),await p(e,n,r))}async function dt(e,t="config.json"){let n=await u(e,t);if(!n)return;let o=!1;Object.keys(n).forEach(i=>{i.startsWith(Le)&&(delete n[i],o=!0)}),o&&await p(e,t,n)}async function ht(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light",i=await u(e,t);if(!i)return;let r=!1;xe.forEach(a=>{let l=`${Le}${a}`,c=i[l];c!==void 0&&(typeof c=="boolean"?(delete i[l],r=!0):c&&typeof c=="object"&&c[o]===!0&&(c[o]=!1,i[l]=c,r=!0))}),r&&await p(e,t,i)}var ke="config.json";async function y(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";if(o.getAttribute("data-asri-palette")===t.name)return;let a=await u(e,ke)||{},l=a[t.configKey]||{light:!1,dark:!1},c=()=>{o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name),l[i]=!0;for(let b of t.otherConfigKeys)if(a[b]){let g=a[b];typeof g=="object"&&(g[i]=!1,a[b]=g)}a[t.configKey]=l};document.startViewTransition?await document.startViewTransition(()=>{c()}).finished.catch(()=>{}):c(),await p(e,ke,a).catch(()=>{})}async function w(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light",r=n!==void 0?n:await u(e,ke);if(r&&r[t.configKey]){let a=r[t.configKey];(typeof a=="boolean"?a:a[i]===!0)?(o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name)):o.getAttribute("data-asri-palette")===t.name&&o.removeAttribute("data-asri-palette")}}var ft={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function pt(e,t){return y(e,ft,t)}async function gt(e,t){return w(e,ft,t)}var bt={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function vt(e,t){return y(e,bt,t)}async function yt(e,t){return w(e,bt,t)}var wt={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Et(e,t){return y(e,wt,t)}async function Ct(e,t){return w(e,wt,t)}var Tt={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Pt(e,t){return y(e,Tt,t)}async function _t(e,t){return w(e,Tt,t)}var Mt={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Lt(e,t){return y(e,Mt,t)}async function xt(e,t){return w(e,Mt,t)}var kt={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function At(e,t){return y(e,kt,t)}async function Ht(e,t){return w(e,kt,t)}var It={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function St(e,t){return y(e,It,t)}async function Dt(e,t){return w(e,It,t)}var Bt={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Nt(e,t){return y(e,Bt,t)}async function Ft(e,t){return w(e,Bt,t)}var Ot={name:"gruvbox",configKey:"asri-enhance-gruvbox",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-glitch"]};async function zt(e,t){return y(e,Ot,t)}async function Rt(e,t){return w(e,Ot,t)}var qt={name:"glitch",configKey:"asri-enhance-glitch",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Kt(e,t){return y(e,qt,t)}async function Gt(e,t){return w(e,qt,t)}var Ae="config.json",He="asri-enhance-coloredheading";async function $t(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-coloredheading"),i=await u(e,Ae)||{};o?(n.removeAttribute("data-asri-enhance-coloredheading"),i[He]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),i[He]=!0),await p(e,Ae,i).catch(()=>{})}async function jt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ae);o&&o[He]===!0?n.setAttribute("data-asri-enhance-coloredheading","true"):n.removeAttribute("data-asri-enhance-coloredheading")}var Ie="config.json",Se="asri-enhance-headinglevelhint",pe="data-asri-enhance-headinglevelhint";async function Vt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute(pe),i=await u(e,Ie)||{};o?(n.removeAttribute(pe),i[Se]=!1):(n.setAttribute(pe,"true"),i[Se]=!0),await p(e,Ie,i).catch(()=>{})}async function Ut(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ie);o&&o[Se]===!0?n.setAttribute(pe,"true"):n.removeAttribute(pe)}var De="config.json",Be="asri-enhance-colored-tree";async function Wt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-colored-tree"),i=await u(e,De)||{};o?(n.removeAttribute("data-asri-enhance-colored-tree"),i[Be]=!1):(n.setAttribute("data-asri-enhance-colored-tree","true"),i[Be]=!0),await p(e,De,i).catch(()=>{})}async function Yt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,De);o&&o[Be]===!0?n.setAttribute("data-asri-enhance-colored-tree","true"):n.removeAttribute("data-asri-enhance-colored-tree")}var Ne="config.json",Fe="asri-enhance-typewriter",ge=null,Oe=!1,Ee=!1,x=null,G=!1,Sn=500;function Dn(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,o;if(n.nodeType===Node.TEXT_NODE?o=n.parentElement:o=n.nodeType===Node.ELEMENT_NODE?n:null,o){let i=o;for(;i&&i!==document.body;){if(i.hasAttribute&&i.hasAttribute("contenteditable"))return o;i=i.parentElement}}return null}function Bn(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth,i=t.top+t.height/2,r=t.left+t.width/2,a=n/2,l=o/2,c=Math.abs(i-a),b=Math.abs(r-l);return c>5||b>5}function Nn(e){e&&Bn(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function Fn(){let e=null,t=()=>{if(!Oe||Ee||G)return;let r=Dn();r!==e&&(e=r,r&&setTimeout(()=>{Nn(r)},50))},n=()=>{Ee=!0,G=!1,x=window.setTimeout(()=>{G=!0},Sn)},o=()=>{Ee=!1,x&&(clearTimeout(x),x=null),G?setTimeout(()=>{G=!1},200):setTimeout(t,10)},i=()=>{Ee=!1,G=!1,x&&(clearTimeout(x),x=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",o),document.addEventListener("mouseleave",i),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",o),document.removeEventListener("mouseleave",i),x&&(clearTimeout(x),x=null)}}}function Xt(){ge&&be(),Oe=!0,ge=Fn()}function be(){Oe=!1,ge&&(ge.destroy(),ge=null)}async function Zt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-typewriter"),i=await u(e,Ne)||{};o?(n.removeAttribute("data-asri-enhance-typewriter"),i[Fe]=!1,be()):(n.setAttribute("data-asri-enhance-typewriter","true"),i[Fe]=!0,Xt()),await p(e,Ne,i).catch(()=>{})}async function Jt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ne);o&&o[Fe]===!0?(n.setAttribute("data-asri-enhance-typewriter","true"),Xt()):(n.removeAttribute("data-asri-enhance-typewriter"),be())}var ze="config.json",Re="asri-enhance-listbulletline",On=".asri-bullet-highlight,.asri-bullet-line",qe="asri-bullet-highlight",N="asri-bullet-line",$="--asri-bullet-line-height",j=null,F=null,Ce=new Set,Qt=()=>{document.querySelectorAll(On).forEach(e=>{e.classList.remove(qe,N),e.style.removeProperty($)}),Ce.clear()},zn=e=>{e.classList.remove(qe,N),e.style.removeProperty($)},Rn=(e,t,n)=>{if(e.classList.add(qe),t&&n){let o=e.getBoundingClientRect(),i=n.getBoundingClientRect();e.style.setProperty($,`${o.top-i.top}px`),e.classList.add(N)}},en=()=>{var o,i;let e=window.getSelection(),t=[];if(e&&e.rangeCount){let r=e.getRangeAt(0).startContainer;for(;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.parentElement;for(;r;){let a=r;if(((o=a.dataset)==null?void 0:o.type)==="NodeListItem"&&t.push(a),(i=a.classList)!=null&&i.contains("protyle-wysiwyg"))break;r=a.parentElement}}let n=new Set(t);Ce.forEach(r=>{n.has(r)||zn(r)}),t.forEach((r,a)=>{let l=a<t.length-1,c=l?t[a+1]:void 0;if(!Ce.has(r))Rn(r,l,c);else if(l&&c){let b=r.getBoundingClientRect(),g=c.getBoundingClientRect(),v=`${b.top-g.top}px`;r.style.getPropertyValue($)!==v&&r.style.setProperty($,v),r.classList.contains(N)||r.classList.add(N)}else r.classList.contains(N)&&(r.classList.remove(N),r.style.removeProperty($))}),Ce=n},tn=()=>{j||(j=()=>{F&&clearTimeout(F),F=setTimeout(()=>{en(),F=null},50)},document.addEventListener("selectionchange",j),en())},Ke=()=>{if(!j){Qt();return}F&&(clearTimeout(F),F=null),document.removeEventListener("selectionchange",j),j=null,Qt()};async function nn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-listbulletline"),i=await u(e,ze)||{};o?(n.removeAttribute("data-asri-enhance-listbulletline"),i[Re]=!1,Ke()):(n.setAttribute("data-asri-enhance-listbulletline","true"),i[Re]=!0,tn()),await p(e,ze,i).catch(()=>{})}async function on(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,ze);o&&o[Re]===!0?(n.setAttribute("data-asri-enhance-listbulletline","true"),tn()):(n.removeAttribute("data-asri-enhance-listbulletline"),Ke())}var rn=()=>{Ke()};var Ge="config.json",$e="asri-enhance-vertical-tab",Pe=150,H=null,I=null,O=null,ve=!1,an=0,sn=0,cn=null,S=null,D=null,ye=!1,k=null,A=null,Te=null,Ve=null,V=null,z=null;function qn(e=10,t=100){return new Promise(n=>{let o=0,i=()=>{let r=document.querySelector(".layout__center");if(r){n(r);return}if(o++,o>=e){n(null);return}setTimeout(i,t)};i()})}function Kn(e=10,t=100){return new Promise(n=>{let o=0,i=()=>{let r=document.querySelector(".layout__center");if(r){let a=r.nextElementSibling;if(a&&a.classList.contains("layout__resize")){n({center:r,resize:a});return}}if(o++,o>=e){n(null);return}setTimeout(i,t)};i()})}function Gn(e=10,t=100){return new Promise(n=>{let o=0,i=()=>{let r=document.querySelector("#toolbar");if(r){n(r);return}if(o++,o>=e){n(null);return}setTimeout(i,t)};i()})}function $n(){let e=document.documentElement,t=getComputedStyle(e).getPropertyValue("--asri-enhance-vertical-tab-width");if(t){let n=parseFloat(t);return isNaN(n)?Pe:n}return Pe}function _e(e){document.documentElement.style.setProperty("--asri-enhance-vertical-tab-width",`${e}px`)}function jn(){_e(Pe)}function Vn(){k!==null&&(cancelAnimationFrame(k),k=null),A=null,S&&(document.removeEventListener("mousemove",S),S=null),D&&(document.removeEventListener("mouseup",D),D=null)}function Un(e){let t=r=>{r.preventDefault(),r.stopPropagation(),ve=!0,an=r.clientX,sn=$n(),document.body.style.userSelect="none",document.body.style.cursor="col-resize",S=a=>{if(!ve)return;a.preventDefault();let l=a.clientX-an;A=Math.max(100,Math.min(300,sn+l)),k!==null&&cancelAnimationFrame(k),k=requestAnimationFrame(()=>{A!==null&&(_e(A),A=null),k=null})},D=()=>{ve&&(ve=!1,document.body.style.userSelect="",document.body.style.cursor="",k!==null&&(cancelAnimationFrame(k),k=null),A!==null&&(_e(A),A=null),S&&(document.removeEventListener("mousemove",S),S=null),D&&(document.removeEventListener("mouseup",D),D=null))},document.addEventListener("mousemove",S),document.addEventListener("mouseup",D)},n=r=>{r.preventDefault(),r.stopPropagation(),jn()},o=e.__asriMousedownHandler,i=e.__asriDblclickHandler;o&&e.removeEventListener("mousedown",o),i&&e.removeEventListener("dblclick",i),e.__asriMousedownHandler=t,e.__asriDblclickHandler=n,e.addEventListener("mousedown",t),e.addEventListener("dblclick",n)}function ln(e){if(ye)return;let t=e.querySelectorAll('[data-type="wnd"]');if(t.length===0)return;let n=null,o=1/0,i=1/0;if(t.forEach(r=>{let a=r.getBoundingClientRect(),l=a.top,c=a.left;(l<o||l===o&&c<i)&&(o=l,i=c,n=r)}),ye=!0,t.forEach(r=>{if(r!==n){r.classList.remove("asri-enhance-verticaltab"),r.classList.remove("asri-enhance-verticaltab-toponly"),r.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing");let a=r.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");a&&a.remove()}}),n){!n.classList.contains("asri-enhance-verticaltab")&&n.classList.add("asri-enhance-verticaltab"),Ve=n;let l=n.getBoundingClientRect().top,c=1,b=!1;t.forEach(v=>{if(v!==n){let f=v.getBoundingClientRect();Math.abs(f.top-l)<=c&&(b=!0)}}),b?n.classList.remove("asri-enhance-verticaltab-toponly"):n.classList.add("asri-enhance-verticaltab-toponly");let g=Array.from(n.children).find(v=>v.classList.contains("fn__flex"));if(g&&g.parentElement){let v=g.parentElement.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");v||(v=document.createElement("div"),v.className="layout__resize layout__resize--lr asri-enhance-verticaltab-resize",g.parentElement.insertBefore(v,g.nextSibling)),Un(v)}je(n)}ye=!1}function Wn(){let e=V!=null?V:document.querySelector("#toolbar");if(!e)return 0;V=e;let t=getComputedStyle(e).getPropertyValue("--topbar-right-spacing");if(!t)return 0;let n=parseFloat(t);return isNaN(n)?0:n}function je(e){let t=e!=null?e:Ve;if(!t)return;Wn()>0?t.classList.add("asri-enhance-verticaltab-dockr-expand-spacing"):t.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing")}async function Yn(){un();let e=await Gn();if(!e)return;V=e;let t=new MutationObserver(n=>{for(let o of n)if(o.type==="attributes"&&o.attributeName==="style"){z!==null&&clearTimeout(z),z=window.setTimeout(()=>{je(),z=null},500);break}});t.observe(e,{attributes:!0,attributeFilter:["style"]}),Te=t,je()}function un(){Te&&(Te.disconnect(),Te=null),z!==null&&(clearTimeout(z),z=null),V=null}async function Xn(){I&&(I.disconnect(),I=null);let e=await Kn();if(!e)return;let{center:t,resize:n}=e,o=()=>{n.classList.contains("fn__none")?t.classList.add("asri-enhance-dockr-fold"):t.classList.remove("asri-enhance-dockr-fold")};o(),I=new MutationObserver(i=>{for(let r of i)if(r.type==="attributes"&&r.attributeName==="class"){o();break}}),I.observe(n,{attributes:!0,attributeFilter:["class"]})}function Zn(){I&&(I.disconnect(),I=null);let e=document.querySelector(".layout__center");e&&e.classList.remove("asri-enhance-dockr-fold")}async function mn(){H&&(H.disconnect(),H=null);let e=await qn();if(!e)return;_e(Pe),ln(e),Xn().catch(()=>{}),Yn();let t=()=>{ye||(O!==null&&clearTimeout(O),O=window.setTimeout(()=>{ln(e),O=null},500))};H=new MutationObserver(()=>{t()}),H.observe(e,{childList:!0,subtree:!0})}function Me(){H&&(H.disconnect(),H=null),Zn(),un(),O!==null&&(clearTimeout(O),O=null),Vn(),document.querySelectorAll('[data-type="wnd"]').forEach(n=>{n.classList.remove("asri-enhance-verticaltab"),n.classList.remove("asri-enhance-verticaltab-toponly"),n.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing");let o=n.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");if(o){let i=o.__asriMousedownHandler,r=o.__asriDblclickHandler;i&&(o.removeEventListener("mousedown",i),delete o.__asriMousedownHandler),r&&(o.removeEventListener("dblclick",r),delete o.__asriDblclickHandler),o.remove()}});let t=document.documentElement;t&&t.style.removeProperty("--asri-enhance-vertical-tab-width"),ye=!1,ve=!1,Ve=null}async function dn(e,t){t&&(t.preventDefault(),t.stopPropagation()),cn=e;let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-vertical-tab"),i=await u(e,Ge)||{};o?(n.removeAttribute("data-asri-enhance-vertical-tab"),i[$e]=!1,Me()):(n.setAttribute("data-asri-enhance-vertical-tab","true"),i[$e]=!0,mn().catch(()=>{})),await p(e,Ge,i).catch(()=>{})}async function hn(e,t){cn=e;let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ge);o&&o[$e]===!0?(n.setAttribute("data-asri-enhance-vertical-tab","true"),mn().catch(()=>{})):(n.removeAttribute("data-asri-enhance-vertical-tab"),Me())}var Ue="config.json",We="asri-enhance-sidebar-top-sticky";async function fn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-sidebar-top-sticky"),i=await u(e,Ue)||{};o?(n.removeAttribute("data-asri-enhance-sidebar-top-sticky"),i[We]=!1):(n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"),i[We]=!0),await p(e,Ue,i).catch(()=>{})}async function pn(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ue);o&&o[We]===!0?n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"):n.removeAttribute("data-asri-enhance-sidebar-top-sticky")}var Ye="config.json",Xe="asri-enhance-cover-image-fade";async function gn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-cover-image-fade"),i=await u(e,Ye)||{};o?(n.removeAttribute("data-asri-enhance-cover-image-fade"),i[Xe]=!1):(n.setAttribute("data-asri-enhance-cover-image-fade","true"),i[Xe]=!0),await p(e,Ye,i).catch(()=>{})}async function bn(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ye);o&&o[Xe]===!0?n.setAttribute("data-asri-enhance-cover-image-fade","true"):n.removeAttribute("data-asri-enhance-cover-image-fade")}var Ze="config.json",Je="asri-enhance-hide-tab-breadcrumb";async function vn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-hide-tab-breadcrumb"),i=await u(e,Ze)||{};o?(n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb"),i[Je]=!1):(n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"),i[Je]=!0),await p(e,Ze,i).catch(()=>{})}async function yn(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ze);o&&o[Je]===!0?n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"):n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb")}var Qe="config.json",et="asri-enhance-paper-texture",we="data-asri-enhance-paper-texture";async function wn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute(we),i=await u(e,Qe)||{};o?(n.removeAttribute(we),i[et]=!1):(n.setAttribute(we,"true"),i[et]=!0),await p(e,Qe,i).catch(()=>{})}async function En(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Qe);o&&o[et]===!0?n.setAttribute(we,"true"):n.removeAttribute(we)}var tt="config.json",nt="asri-enhance-moreanimations";async function Cn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-moreanimations"),i=await u(e,tt)||{};o?(n.removeAttribute("data-asri-enhance-moreanimations"),i[nt]=!1):(n.setAttribute("data-asri-enhance-moreanimations","true"),i[nt]=!0),await p(e,tt,i).catch(()=>{})}async function Tn(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,tt);o&&o[nt]===!0?n.setAttribute("data-asri-enhance-moreanimations","true"):n.removeAttribute("data-asri-enhance-moreanimations")}function Pn(e,t,n=100){let o,i,r=null,a=0,l=new Set,c=10,b=100,g=()=>{l.forEach(E=>window.clearTimeout(E)),l.clear()},v=(E,P)=>{let _=window.setTimeout(()=>{l.delete(_),E()},P);return l.add(_),_},f=E=>{o!==void 0&&window.clearTimeout(o),o=window.setTimeout(()=>{g();let P=(_=0)=>{var X,Z,J,Q,ee,te,ne,oe,ie,re,ae;let q=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(q){let T=q.parentElement;if(T){if(!T.querySelector("#asri-enhance-palette")){let d=document.createElement("button");d.className="b3-menu__item asri-enhance",d.id="asri-enhance-palette",d.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((X=e.i18n)==null?void 0:X.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((Z=e.i18n)==null?void 0:Z.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((J=e.i18n)==null?void 0:J.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((Q=e.i18n)==null?void 0:Q.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((ee=e.i18n)==null?void 0:ee.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((te=e.i18n)==null?void 0:te.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((ne=e.i18n)==null?void 0:ne.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((oe=e.i18n)==null?void 0:oe.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((ie=e.i18n)==null?void 0:ie.shade)||"Shade"}</span></button><button class="b3-menu__item" id="asri-enhance-gruvbox"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((re=e.i18n)==null?void 0:re.gruvbox)||"Gruvbox"}</span></button></div></div>`,T.insertBefore(d,q)}let M=T.querySelector("#asri-enhance-amber");M&&(M.onclick=d=>pt(e,d));let se=T.querySelector("#asri-enhance-wilderness");se&&(se.onclick=d=>vt(e,d));let le=T.querySelector("#asri-enhance-midnight");le&&(le.onclick=d=>Et(e,d));let ce=T.querySelector("#asri-enhance-salt");ce&&(ce.onclick=d=>Pt(e,d));let ue=T.querySelector("#asri-enhance-rosepine");ue&&(ue.onclick=d=>Lt(e,d));let s=T.querySelector("#asri-enhance-topaz");s&&(s.onclick=d=>At(e,d));let me=T.querySelector("#asri-enhance-oxygen");me&&(me.onclick=d=>St(e,d));let de=T.querySelector("#asri-enhance-shade");de&&(de.onclick=d=>Nt(e,d));let he=T.querySelector("#asri-enhance-gruvbox");he&&(he.onclick=d=>zt(e,d));let K=T.querySelector("#asri-enhance-palette .b3-menu__submenu .b3-menu__items");if(K&&!K.querySelector("#asri-enhance-glitch")){let d=document.createElement("button");d.className="b3-menu__item",d.id="asri-enhance-glitch",d.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((ae=e.i18n)==null?void 0:ae.glitch)||"glitch"}</span>`,K.appendChild(d)}let fe=T.querySelector("#asri-enhance-glitch");fe&&(fe.onclick=d=>Kt(e,d))}t(E);return}_+1<c?v(()=>P(_+1),b):t(E)};P(),o=void 0},n)},C=()=>{let E=document.querySelector("#barMode");if(E){r=E,E.addEventListener("click",f,!0),i=void 0;return}a+=1,a<c?i=window.setTimeout(C,b):i=void 0};return C(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),g(),r&&(r.removeEventListener("click",f,!0),r=null),o!==void 0&&(window.clearTimeout(o),o=void 0)}}function _n(e,t=100){let n,o,i=null,r=0,a=new Set,l=10,c=100,b=()=>{a.forEach(C=>window.clearTimeout(C)),a.clear()},g=(C,E)=>{let P=window.setTimeout(()=>{a.delete(P),C()},E);return a.add(P),P},v=C=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{b();let E=(P=0)=>{var q,X,Z,J,Q,ee,te,ne,oe,ie,re,ae,T;let _=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(_){let M=_.parentElement;if(M){if(!M.querySelector("#asri-enhance-more")){let s=document.createElement("button");s.className="b3-menu__item asri-enhance",s.id="asri-enhance-more",s.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-detail-adjustment"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((X=e.i18n)==null?void 0:X.detailAdjustment)||"detailAdjustment"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"></div></div></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((Z=e.i18n)==null?void 0:Z.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((J=e.i18n)==null?void 0:J.listBulletLine)||"listBulletLine"}</span></button><button class="b3-menu__item" id="asri-enhance-vertical-tab"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((Q=e.i18n)==null?void 0:Q.verticalTab)||"verticalTab"}</span></button></div></div>`,_.nextSibling?M.insertBefore(s,_.nextSibling):M.appendChild(s)}let se=M.querySelector("#asri-enhance-typewriter");se&&(se.onclick=s=>Zt(e,s));let le=M.querySelector("#asri-enhance-list-bullet-line");le&&(le.onclick=s=>nn(e,s));let ce=M.querySelector("#asri-enhance-vertical-tab");ce&&(ce.onclick=s=>dn(e,s));let ue=M.querySelector("#asri-enhance-detail-adjustment");if(ue){let s=ue.querySelector(".b3-menu__submenu .b3-menu__items");if(s&&!s.querySelector("#asri-enhance-sidebar-top-sticky")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-sidebar-top-sticky",m.innerHTML=`${h}<span class="b3-menu__label">${((ee=e.i18n)==null?void 0:ee.sidebarTopSticky)||"sidebarTopSticky"}</span>`,s.appendChild(m)}let me=s==null?void 0:s.querySelector("#asri-enhance-sidebar-top-sticky");if(me&&(me.onclick=h=>fn(e,h)),s&&!s.querySelector("#asri-enhance-cover-image-fade")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-cover-image-fade",m.innerHTML=`${h}<span class="b3-menu__label">${((te=e.i18n)==null?void 0:te.coverImageFade)||"coverImageFade"}</span>`,s.appendChild(m)}let de=s==null?void 0:s.querySelector("#asri-enhance-cover-image-fade");if(de&&(de.onclick=h=>gn(e,h)),s&&!s.querySelector("#asri-enhance-paper-texture")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-paper-texture",m.innerHTML=`${h}<span class="b3-menu__label">${((ne=e.i18n)==null?void 0:ne.paperTexture)||"paperTexture"}</span>`,s.appendChild(m)}let he=s==null?void 0:s.querySelector("#asri-enhance-paper-texture");if(he&&(he.onclick=h=>wn(e,h)),s&&!s.querySelector("#asri-enhance-colored-heading")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-colored-heading",m.innerHTML=`${h}<span class="b3-menu__label">${((oe=e.i18n)==null?void 0:oe.coloredHeading)||"coloredHeading"}</span>`,s.appendChild(m)}let K=s==null?void 0:s.querySelector("#asri-enhance-colored-heading");if(K&&(K.onclick=h=>$t(e,h)),s&&!s.querySelector("#asri-enhance-heading-level-hint")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");if(m.className="b3-menu__item",m.id="asri-enhance-heading-level-hint",m.innerHTML=`${h}<span class="b3-menu__label">${((ie=e.i18n)==null?void 0:ie.headingLevelHint)||"headingLevelHint"}</span>`,s.querySelector("#asri-enhance-colored-tree")){let In=s.querySelector("#asri-enhance-colored-tree");s.insertBefore(m,In)}else s.appendChild(m)}let fe=s==null?void 0:s.querySelector("#asri-enhance-heading-level-hint");if(fe&&(fe.onclick=h=>Vt(e,h)),s&&!s.querySelector("#asri-enhance-colored-tree")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-colored-tree",m.innerHTML=`${h}<span class="b3-menu__label">${((re=e.i18n)==null?void 0:re.coloredTree)||"coloredTree"}</span>`,s.appendChild(m)}let d=s==null?void 0:s.querySelector("#asri-enhance-colored-tree");if(d&&(d.onclick=h=>Wt(e,h)),s&&!s.querySelector("#asri-enhance-hide-tab-breadcrumb")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-hide-tab-breadcrumb",m.innerHTML=`${h}<span class="b3-menu__label">${((ae=e.i18n)==null?void 0:ae.hideTabBreadcrumb)||"hideTabBreadcrumb"}</span>`,s.appendChild(m)}let ct=s==null?void 0:s.querySelector("#asri-enhance-hide-tab-breadcrumb");if(ct&&(ct.onclick=h=>vn(e,h)),s&&!s.querySelector("#asri-enhance-moreanimations")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',m=document.createElement("button");m.className="b3-menu__item",m.id="asri-enhance-moreanimations",m.innerHTML=`${h}<span class="b3-menu__label">${((T=e.i18n)==null?void 0:T.moreAnimations)||"moreAnimations"}</span>`,s.appendChild(m)}let ut=s==null?void 0:s.querySelector("#asri-enhance-moreanimations");ut&&(ut.onclick=h=>Cn(e,h))}}return}P+1<l&&g(()=>E(P+1),c)};E(),n=void 0},t)},f=()=>{let C=document.querySelector("#barMode");if(C){i=C,C.addEventListener("click",v,!0),o=void 0;return}r+=1,r<l?o=window.setTimeout(f,c):o=void 0};return f(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),b(),i&&(i.removeEventListener("click",v,!0),i=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var it=!1,B=null,ot=0,L=null,U=null,W=null,Y=null;function rt(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function R(){if(it=!1,L=null,B!==null&&(clearInterval(B),B=null),U){try{U.disconnect()}catch(e){}U=null}if(W){try{W.disconnect()}catch(e){}W=null}}function at(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function st(){if(L){if(!U){U=new MutationObserver(()=>{at(L)||R()});try{U.observe(L,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!W){W=new MutationObserver(()=>{at(L)||R()});try{W.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function Jn(){let e=rt();return e?(L=e,st(),!0):(ot=0,B=setInterval(()=>{ot+=1;let t=rt();t?(L=t,clearInterval(B),B=null,st()):ot>=10&&(clearInterval(B),B=null,R())},100),!1)}function Qn(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function xn(e){return e?e.querySelector(".b3-list-item--focus"):null}function eo(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function to(e,t,n){if(!t||e.length===0)return null;let o=t.getBoundingClientRect(),i={x:o.left+o.width/2,y:o.top+o.height/2,el:t},r=eo(e),a=Math.max(o.width/2,10),l;switch(n){case"ArrowUp":l=f=>f.y<i.y-1&&Math.abs(f.x-i.x)<=a;break;case"ArrowDown":l=f=>f.y>i.y+1&&Math.abs(f.x-i.x)<=a;break;case"ArrowLeft":l=f=>f.x<i.x-1;break;case"ArrowRight":l=f=>f.x>i.x+1;break;default:return null}let c=r.filter(f=>f.el!==t&&l(f));if(c.length===0)return null;let b=(f,C)=>{let E=f.x-C.x,P=f.y-C.y;return E*E+P*P},g=c[0],v=b(g,i);for(let f=1;f<c.length;f++){let C=b(c[f],i);C<v&&(g=c[f],v=C)}return g.el}function Mn(e){if(!L||!e)return;let t=xn(L);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function no(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[0])!=null?o:null:n+1<e.length?e[n+1]:(i=e[0])!=null?i:null}function oo(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[e.length-1])!=null?o:null:n-1>=0?e[n-1]:(i=e[e.length-1])!=null?i:null}function Ln(e,t){let n=t.getBoundingClientRect(),o=n.top+n.height/2,i=[];for(let r of e){if(r===t)continue;let a=r.getBoundingClientRect(),l=a.top+a.height/2,c=Math.min(n.height,a.height)/2;Math.abs(l-o)<=c&&i.push(r)}return i}function io(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function ro(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var ao=e=>{var c,b;if(e.key==="/"){R(),it=!0,Jn();return}if(!it)return;if(e.key==="Escape"){R();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=L||rt();if(!n||!at(n)){R();return}e.preventDefault(),e.stopPropagation(),L=n,st();let o=Qn(n);if(o.length===0)return;let i=xn(n);i||(i=o[0],i.classList.add("b3-list-item--focus"));let r=to(o,i,e.key);if(r){Mn(r);return}let a=null,l=e.key;if(l==="ArrowDown")a=no(o,i);else if(l==="ArrowUp")a=oo(o,i);else if(l==="ArrowRight"){let g=Ln(o,i);g.length>0&&(a=(c=io(g)[0])!=null?c:null)}else if(l==="ArrowLeft"){let g=Ln(o,i);g.length>0&&(a=(b=ro(g)[0])!=null?b:null)}a&&a!==i&&Mn(a)};function kn(){typeof document!="undefined"&&(Y||(Y=ao,document.addEventListener("keydown",Y,{capture:!0})))}function An(){typeof document!="undefined"&&(Y&&(document.removeEventListener("keydown",Y,{capture:!0}),Y=null),R())}var lt=class extends Hn.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null;this.themeModeChangeTimers=[];this.paletteDisableMouseUpHandler=null;this.paletteDisableDebounceTimer=null}async applyAllConfigs(n){await Promise.all([gt(this,n).catch(()=>{}),yt(this,n).catch(()=>{}),Ct(this,n).catch(()=>{}),_t(this,n).catch(()=>{}),xt(this,n).catch(()=>{}),Ht(this,n).catch(()=>{}),Dt(this,n).catch(()=>{}),Ft(this,n).catch(()=>{}),Rt(this,n).catch(()=>{}),Gt(this,n).catch(()=>{}),jt(this,n).catch(()=>{}),Yt(this,n).catch(()=>{}),Ut(this,n).catch(()=>{}),Jt(this,n).catch(()=>{}),on(this,n).catch(()=>{}),hn(this,n).catch(()=>{}),pn(this,n).catch(()=>{}),bn(this,n).catch(()=>{}),yn(this,n).catch(()=>{}),En(this,n).catch(()=>{}),Tn(this,n).catch(()=>{})])}async onload(){this.unsubscribeBarModeClick=Pn(this,()=>{}),this.unsubscribeTopbarFusionPlus=_n(this),this.asriConfigClickHandler=i=>{queueMicrotask(()=>{let r=i.target;if(!r||r.closest("#asri-enhance-amber")||r.closest("#asri-enhance-wilderness")||r.closest("#asri-enhance-midnight")||r.closest("#asri-enhance-salt")||r.closest("#asri-enhance-rosepine")||r.closest("#asri-enhance-topaz")||r.closest("#asri-enhance-oxygen")||r.closest("#asri-enhance-shade")||r.closest("#asri-enhance-gruvbox")||r.closest("#asri-enhance-glitch"))return;let a=r.closest(".asri-config");a&&a.id!=="topbarFusionPlus"&&xe.forEach(l=>{mt(this,l,"config.json").catch(()=>{})})})},document.addEventListener("click",this.asriConfigClickHandler,!0),this.paletteDisableMouseUpHandler=i=>{queueMicrotask(()=>{var l;let r=i.target;if(!r)return;(((l=r.id)==null?void 0:l.startsWith("prst-palette"))||r.closest("[id^='prst-palette']")!==null||r.id==="pickColor"||r.closest("#pickColor")!==null||r.id==="followSysAccent"||r.closest("#followSysAccent")!==null||r.id==="followCoverImgColor"||r.closest("#followCoverImgColor")!==null)&&(this.paletteDisableDebounceTimer!==null&&clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=window.setTimeout(()=>{ht(this,"config.json").then(()=>{u(this,"config.json").then(c=>{this.applyAllConfigs(c).catch(()=>{})}).catch(()=>{})}).catch(()=>{}),this.paletteDisableDebounceTimer=null},200))})},document.addEventListener("mouseup",this.paletteDisableMouseUpHandler,!1);let n=await u(this,"config.json"),o=document.documentElement;o&&(this.themeModeObserver=new MutationObserver(i=>{queueMicrotask(()=>{for(let r of i)if(r.type==="attributes"&&r.attributeName==="data-theme-mode"){this.themeModeChangeTimers.forEach(c=>{clearTimeout(c)}),this.themeModeChangeTimers=[],u(this,"config.json").then(c=>{this.applyAllConfigs(c).catch(()=>{})}).catch(()=>{});let a=window.setTimeout(()=>{u(this,"config.json").then(c=>{this.applyAllConfigs(c).catch(()=>{})}).catch(()=>{})},100);this.themeModeChangeTimers.push(a);let l=window.setTimeout(()=>{u(this,"config.json").then(c=>{this.applyAllConfigs(c).catch(()=>{})}).catch(()=>{})},500);this.themeModeChangeTimers.push(l)}})}),this.themeModeObserver.observe(o,{attributes:!0,attributeFilter:["data-theme-mode"]})),await this.applyAllConfigs(n),kn(),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},100),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),this.themeModeChangeTimers.forEach(n=>{clearTimeout(n)}),this.themeModeChangeTimers=[],this.paletteDisableMouseUpHandler&&(document.removeEventListener("mouseup",this.paletteDisableMouseUpHandler,!0),this.paletteDisableMouseUpHandler=null),this.paletteDisableDebounceTimer!==null&&(clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=null),rn(),be(),An(),Me()}async uninstall(){this.onunload(),await dt(this,"config.json").catch(()=>{})}};module.exports=lt;
