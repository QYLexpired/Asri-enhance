var yt=require("siyuan");var Fe="asri-enhance-",Oe=["amber","wilderness","midnight","salt","rosepine","topaz","oxygen","shade"];async function E(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(i){throw i}}async function f(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function De(e,t,n="config.json"){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";i.getAttribute("data-asri-palette")===t&&i.removeAttribute("data-asri-palette");let r=await f(e,n);if(!r)return;let a=`${Fe}${t}`,s=r[a];s!==void 0&&(typeof s=="boolean"?delete r[a]:s&&typeof s=="object"&&(s[o]=!1,r[a]=s),await E(e,n,r))}async function Re(e,t="config.json"){let n=await f(e,t);if(!n)return;let i=!1;Object.keys(n).forEach(o=>{o.startsWith(Fe)&&(delete n[o],i=!0)}),i&&await E(e,t,n)}var fe="config.json";async function b(e,t,n){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";if(i.getAttribute("data-asri-palette")===t.name)return;let a=await f(e,fe)||{},s=a[t.configKey]||{light:!1,dark:!1},u=()=>{i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",t.name),s[o]=!0;for(let m of t.otherConfigKeys)if(a[m]){let d=a[m];typeof d=="object"&&(d[o]=!1,a[m]=d)}a[t.configKey]=s};document.startViewTransition?await document.startViewTransition(()=>{u()}).finished.catch(()=>{}):u(),await E(e,fe,a).catch(()=>{})}async function v(e,t){let n=document.documentElement;if(!n)return;let i=n.getAttribute("data-theme-mode")||"light",o=await f(e,fe);if(o&&o[t.configKey]){let r=o[t.configKey];(typeof r=="boolean"?r:r[i]===!0)?(n.removeAttribute("data-asri-palette"),n.setAttribute("data-asri-palette",t.name)):n.getAttribute("data-asri-palette")===t.name&&n.removeAttribute("data-asri-palette")}}var ze={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function Ke(e,t){return b(e,ze,t)}async function Z(e){return v(e,ze)}var je={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function qe(e,t){return b(e,je,t)}async function J(e){return v(e,je)}var $e={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function Ge(e,t){return b(e,$e,t)}async function Q(e){return v(e,$e)}var Ve={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function Ue(e,t){return b(e,Ve,t)}async function ee(e){return v(e,Ve)}var Ye={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function We(e,t){return b(e,Ye,t)}async function te(e){return v(e,Ye)}var Xe={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade"]};async function Ze(e,t){return b(e,Xe,t)}async function ne(e){return v(e,Xe)}var Je={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade"]};async function Qe(e,t){return b(e,Je,t)}async function oe(e){return v(e,Je)}var et={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen"]};async function tt(e,t){return b(e,et,t)}async function ie(e){return v(e,et)}var pe="config.json",ge="asri-enhance-coloredheading";async function nt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredheading"),o=await f(e,pe)||{};i?(n.removeAttribute("data-asri-enhance-coloredheading"),o[ge]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),o[ge]=!0),await E(e,pe,o).catch(()=>{})}async function se(e){let t=document.documentElement;if(!t)return;let n=await f(e,pe);n&&n[ge]===!0?t.setAttribute("data-asri-enhance-coloredheading","true"):t.removeAttribute("data-asri-enhance-coloredheading")}var be="config.json",ve="asri-enhance-typewriter",re=null,ye=!1,le=!1,k=null,B=!1,wt=500;function Et(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,i;if(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n.nodeType===Node.ELEMENT_NODE?n:null,i){let o=i;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return i;o=o.parentElement}}return null}function Ct(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,i=window.innerWidth,o=t.top+t.height/2,r=t.left+t.width/2,a=n/2,s=i/2,u=Math.abs(o-a),m=Math.abs(r-s);return u>5||m>5}function Pt(e){e&&Ct(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function Tt(){let e=null,t=()=>{if(!ye||le||B)return;let r=Et();r!==e&&(e=r,r&&setTimeout(()=>{Pt(r)},50))},n=()=>{le=!0,B=!1,k=window.setTimeout(()=>{B=!0},wt)},i=()=>{le=!1,k&&(clearTimeout(k),k=null),B?setTimeout(()=>{B=!1},200):setTimeout(t,10)},o=()=>{le=!1,B=!1,k&&(clearTimeout(k),k=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",o),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",o),k&&(clearTimeout(k),k=null)}}}function ot(){re&&ae(),ye=!0,re=Tt()}function ae(){ye=!1,re&&(re.destroy(),re=null)}async function it(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-typewriter"),o=await f(e,be)||{};i?(n.removeAttribute("data-asri-enhance-typewriter"),o[ve]=!1,ae()):(n.setAttribute("data-asri-enhance-typewriter","true"),o[ve]=!0,ot()),await E(e,be,o).catch(()=>{})}async function ce(e){let t=document.documentElement;if(!t)return;let n=await f(e,be);n&&n[ve]===!0?(t.setAttribute("data-asri-enhance-typewriter","true"),ot()):(t.removeAttribute("data-asri-enhance-typewriter"),ae())}var we="config.json",Ee="asri-enhance-listbulletline",Mt=".asri-bullet-highlight,.asri-bullet-line",Ce="asri-bullet-highlight",A="asri-bullet-line",N="--asri-bullet-line-height",F=null,H=null,ue=new Set,rt=()=>{document.querySelectorAll(Mt).forEach(e=>{e.classList.remove(Ce,A),e.style.removeProperty(N)}),ue.clear()},_t=e=>{e.classList.remove(Ce,A),e.style.removeProperty(N)},Lt=(e,t,n)=>{if(e.classList.add(Ce),t&&n){let i=e.getBoundingClientRect(),o=n.getBoundingClientRect();e.style.setProperty(N,`${i.top-o.top}px`),e.classList.add(A)}},at=()=>{var i,o;let e=window.getSelection(),t=[];if(e&&e.rangeCount){let r=e.getRangeAt(0).startContainer;for(;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.parentElement;for(;r;){let a=r;if(((i=a.dataset)==null?void 0:i.type)==="NodeListItem"&&t.push(a),(o=a.classList)!=null&&o.contains("protyle-wysiwyg"))break;r=a.parentElement}}let n=new Set(t);ue.forEach(r=>{n.has(r)||_t(r)}),t.forEach((r,a)=>{let s=a<t.length-1,u=s?t[a+1]:void 0;if(!ue.has(r))Lt(r,s,u);else if(s&&u){let m=r.getBoundingClientRect(),d=u.getBoundingClientRect(),_=`${m.top-d.top}px`;r.style.getPropertyValue(N)!==_&&r.style.setProperty(N,_),r.classList.contains(A)||r.classList.add(A)}else r.classList.contains(A)&&(r.classList.remove(A),r.style.removeProperty(N))}),ue=n},st=()=>{F||(F=()=>{H&&clearTimeout(H),H=setTimeout(()=>{at(),H=null},50)},document.addEventListener("selectionchange",F),at())},Pe=()=>{if(!F){rt();return}H&&(clearTimeout(H),H=null),document.removeEventListener("selectionchange",F),F=null,rt()};async function lt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-listbulletline"),o=await f(e,we)||{};i?(n.removeAttribute("data-asri-enhance-listbulletline"),o[Ee]=!1,Pe()):(n.setAttribute("data-asri-enhance-listbulletline","true"),o[Ee]=!0,st()),await E(e,we,o).catch(()=>{})}async function me(e){let t=document.documentElement;if(!t)return;let n=await f(e,we);n&&n[Ee]===!0?(t.setAttribute("data-asri-enhance-listbulletline","true"),st()):(t.removeAttribute("data-asri-enhance-listbulletline"),Pe())}var ct=()=>{Pe()};var Te="config.json",Me="asri-enhance-sidebar-top-sticky";async function ut(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-sidebar-top-sticky"),o=await f(e,Te)||{};i?(n.removeAttribute("data-asri-enhance-sidebar-top-sticky"),o[Me]=!1):(n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"),o[Me]=!0),await E(e,Te,o).catch(()=>{})}async function de(e){let t=document.documentElement;if(!t)return;let n=await f(e,Te);n&&n[Me]===!0?t.setAttribute("data-asri-enhance-sidebar-top-sticky","true"):t.removeAttribute("data-asri-enhance-sidebar-top-sticky")}var _e="config.json",Le="asri-enhance-cover-image-fade";async function mt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-cover-image-fade"),o=await f(e,_e)||{};i?(n.removeAttribute("data-asri-enhance-cover-image-fade"),o[Le]=!1):(n.setAttribute("data-asri-enhance-cover-image-fade","true"),o[Le]=!0),await E(e,_e,o).catch(()=>{})}async function he(e){let t=document.documentElement;if(!t)return;let n=await f(e,_e);n&&n[Le]===!0?t.setAttribute("data-asri-enhance-cover-image-fade","true"):t.removeAttribute("data-asri-enhance-cover-image-fade")}function dt(e,t,n=100){let i,o,r=null,a=0,s=new Set,u=10,m=100,d=()=>{s.forEach(p=>window.clearTimeout(p)),s.clear()},_=(p,y)=>{let P=window.setTimeout(()=>{s.delete(P),p()},y);return s.add(P),P},l=p=>{i!==void 0&&window.clearTimeout(i),i=window.setTimeout(()=>{d();let y=(P=0)=>{var z,K,j,q,$,G,T,V,U;let S=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(S){let w=S.parentElement;if(w){if(!w.querySelector("#asri-enhance-palette")){let h=document.createElement("button");h.className="b3-menu__item asri-enhance",h.id="asri-enhance-palette",h.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((j=e.i18n)==null?void 0:j.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((G=e.i18n)==null?void 0:G.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((T=e.i18n)==null?void 0:T.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((V=e.i18n)==null?void 0:V.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((U=e.i18n)==null?void 0:U.shade)||"Shade"}</span></button></div></div>`,w.insertBefore(h,S)}let Y=w.querySelector("#asri-enhance-amber");Y&&(Y.onclick=h=>Ke(e,h));let c=w.querySelector("#asri-enhance-wilderness");c&&(c.onclick=h=>qe(e,h));let W=w.querySelector("#asri-enhance-midnight");W&&(W.onclick=h=>Ge(e,h));let X=w.querySelector("#asri-enhance-salt");X&&(X.onclick=h=>Ue(e,h));let L=w.querySelector("#asri-enhance-rosepine");L&&(L.onclick=h=>We(e,h));let C=w.querySelector("#asri-enhance-topaz");C&&(C.onclick=h=>Ze(e,h));let Be=w.querySelector("#asri-enhance-oxygen");Be&&(Be.onclick=h=>Qe(e,h));let Ne=w.querySelector("#asri-enhance-shade");Ne&&(Ne.onclick=h=>tt(e,h))}t(p);return}P+1<u?_(()=>y(P+1),m):t(p)};y(),i=void 0},n)},g=()=>{let p=document.querySelector("#barMode");if(p){r=p,p.addEventListener("click",l,!0),o=void 0;return}a+=1,a<u?o=window.setTimeout(g,m):o=void 0};return g(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),d(),r&&(r.removeEventListener("click",l,!0),r=null),i!==void 0&&(window.clearTimeout(i),i=void 0)}}function ht(e,t=100){let n,i,o=null,r=0,a=new Set,s=10,u=100,m=()=>{a.forEach(g=>window.clearTimeout(g)),a.clear()},d=(g,p)=>{let y=window.setTimeout(()=>{a.delete(y),g()},p);return a.add(y),y},_=g=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{m();let p=(y=0)=>{var S,z,K,j,q,$,G;let P=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(P){let T=P.parentElement;if(T){if(!T.querySelector("#asri-enhance-more")){let c=document.createElement("button");c.className="b3-menu__item asri-enhance",c.id="asri-enhance-more",c.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-detail-adjustment"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.detailAdjustment)||"detailAdjustment"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"></div></div></button><button class="b3-menu__item" id="asri-enhance-colored-heading"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.coloredHeading)||"coloredHeading"}</span></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((j=e.i18n)==null?void 0:j.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.listBulletLine)||"listBulletLine"}</span></button></div></div>`,P.nextSibling?T.insertBefore(c,P.nextSibling):T.appendChild(c)}let V=T.querySelector("#asri-enhance-colored-heading");V&&(V.onclick=c=>nt(e,c));let U=T.querySelector("#asri-enhance-typewriter");U&&(U.onclick=c=>it(e,c));let w=T.querySelector("#asri-enhance-list-bullet-line");w&&(w.onclick=c=>lt(e,c));let Y=T.querySelector("#asri-enhance-detail-adjustment");if(Y){let c=Y.querySelector(".b3-menu__submenu .b3-menu__items");if(c&&!c.querySelector("#asri-enhance-sidebar-top-sticky")){let L='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',C=document.createElement("button");C.className="b3-menu__item",C.id="asri-enhance-sidebar-top-sticky",C.innerHTML=`${L}<span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.sidebarTopSticky)||"sidebarTopSticky"}</span>`,c.appendChild(C)}let W=c==null?void 0:c.querySelector("#asri-enhance-sidebar-top-sticky");if(W&&(W.onclick=L=>ut(e,L)),c&&!c.querySelector("#asri-enhance-cover-image-fade")){let L='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',C=document.createElement("button");C.className="b3-menu__item",C.id="asri-enhance-cover-image-fade",C.innerHTML=`${L}<span class="b3-menu__label">${((G=e.i18n)==null?void 0:G.coverImageFade)||"coverImageFade"}</span>`,c.appendChild(C)}let X=c==null?void 0:c.querySelector("#asri-enhance-cover-image-fade");X&&(X.onclick=L=>mt(e,L))}}return}y+1<s&&d(()=>p(y+1),u)};p(),n=void 0},t)},l=()=>{let g=document.querySelector("#barMode");if(g){o=g,g.addEventListener("click",_,!0),i=void 0;return}r+=1,r<s?i=window.setTimeout(l,u):i=void 0};return l(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),m(),o&&(o.removeEventListener("click",_,!0),o=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var xe=!1,x=null,ke=0,M=null,O=null,D=null,R=null;function Ae(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function I(){if(xe=!1,M=null,x!==null&&(clearInterval(x),x=null),O){try{O.disconnect()}catch(e){}O=null}if(D){try{D.disconnect()}catch(e){}D=null}}function He(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function Ie(){if(M){if(!O){O=new MutationObserver(()=>{He(M)||I()});try{O.observe(M,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!D){D=new MutationObserver(()=>{He(M)||I()});try{D.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function kt(){let e=Ae();return e?(M=e,Ie(),!0):(ke=0,x=setInterval(()=>{ke+=1;let t=Ae();t?(M=t,clearInterval(x),x=null,Ie()):ke>=10&&(clearInterval(x),x=null,I())},100),!1)}function xt(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function gt(e){return e?e.querySelector(".b3-list-item--focus"):null}function At(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function Ht(e,t,n){if(!t||e.length===0)return null;let i=t.getBoundingClientRect(),o={x:i.left+i.width/2,y:i.top+i.height/2,el:t},r=At(e),a=Math.max(i.width/2,10),s;switch(n){case"ArrowUp":s=l=>l.y<o.y-1&&Math.abs(l.x-o.x)<=a;break;case"ArrowDown":s=l=>l.y>o.y+1&&Math.abs(l.x-o.x)<=a;break;case"ArrowLeft":s=l=>l.x<o.x-1;break;case"ArrowRight":s=l=>l.x>o.x+1;break;default:return null}let u=r.filter(l=>l.el!==t&&s(l));if(u.length===0)return null;let m=(l,g)=>{let p=l.x-g.x,y=l.y-g.y;return p*p+y*y},d=u[0],_=m(d,o);for(let l=1;l<u.length;l++){let g=m(u[l],o);g<_&&(d=u[l],_=g)}return d.el}function ft(e){if(!M||!e)return;let t=gt(M);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function It(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[0])!=null?i:null:n+1<e.length?e[n+1]:(o=e[0])!=null?o:null}function St(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[e.length-1])!=null?i:null:n-1>=0?e[n-1]:(o=e[e.length-1])!=null?o:null}function pt(e,t){let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=[];for(let r of e){if(r===t)continue;let a=r.getBoundingClientRect(),s=a.top+a.height/2,u=Math.min(n.height,a.height)/2;Math.abs(s-i)<=u&&o.push(r)}return o}function Bt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function Nt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var Ft=e=>{var u,m;if(e.key==="/"){I(),xe=!0,kt();return}if(!xe)return;if(e.key==="Escape"){I();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=M||Ae();if(!n||!He(n)){I();return}e.preventDefault(),e.stopPropagation(),M=n,Ie();let i=xt(n);if(i.length===0)return;let o=gt(n);o||(o=i[0],o.classList.add("b3-list-item--focus"));let r=Ht(i,o,e.key);if(r){ft(r);return}let a=null,s=e.key;if(s==="ArrowDown")a=It(i,o);else if(s==="ArrowUp")a=St(i,o);else if(s==="ArrowRight"){let d=pt(i,o);d.length>0&&(a=(u=Bt(d)[0])!=null?u:null)}else if(s==="ArrowLeft"){let d=pt(i,o);d.length>0&&(a=(m=Nt(d)[0])!=null?m:null)}a&&a!==o&&ft(a)};function bt(){typeof document!="undefined"&&(R||(R=Ft,document.addEventListener("keydown",R,{capture:!0})))}function vt(){typeof document!="undefined"&&(R&&(document.removeEventListener("keydown",R,{capture:!0}),R=null),I())}var Se=class extends yt.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null}async onload(){this.unsubscribeBarModeClick=dt(this,()=>{}),this.unsubscribeTopbarFusionPlus=ht(this),this.asriConfigClickHandler=i=>{let o=i.target;if(!o||o.closest("#asri-enhance-amber")||o.closest("#asri-enhance-wilderness")||o.closest("#asri-enhance-midnight")||o.closest("#asri-enhance-salt")||o.closest("#asri-enhance-rosepine")||o.closest("#asri-enhance-topaz")||o.closest("#asri-enhance-oxygen")||o.closest("#asri-enhance-shade"))return;let r=o.closest(".asri-config");r&&r.id!=="topbarFusionPlus"&&Oe.forEach(a=>{De(this,a,"config.json").catch(()=>{})})},document.addEventListener("click",this.asriConfigClickHandler,!0);let n=document.documentElement;n&&(this.themeModeObserver=new MutationObserver(i=>{for(let o of i)o.type==="attributes"&&o.attributeName==="data-theme-mode"&&(Z(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{}),oe(this).catch(()=>{}),ie(this).catch(()=>{}))}),this.themeModeObserver.observe(n,{attributes:!0,attributeFilter:["data-theme-mode"]})),Z(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{}),oe(this).catch(()=>{}),ie(this).catch(()=>{}),se(this).catch(()=>{}),ce(this).catch(()=>{}),me(this).catch(()=>{}),de(this).catch(()=>{}),he(this).catch(()=>{}),bt(),setTimeout(()=>{Z(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{}),oe(this).catch(()=>{}),ie(this).catch(()=>{}),se(this).catch(()=>{}),ce(this).catch(()=>{}),me(this).catch(()=>{}),de(this).catch(()=>{}),he(this).catch(()=>{})},500),setTimeout(()=>{Z(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),ee(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{}),oe(this).catch(()=>{}),ie(this).catch(()=>{}),se(this).catch(()=>{}),ce(this).catch(()=>{}),me(this).catch(()=>{}),de(this).catch(()=>{}),he(this).catch(()=>{})},1500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),ct(),ae(),vt()}async uninstall(){this.onunload(),await Re(this,"config.json").catch(()=>{})}};module.exports=Se;
