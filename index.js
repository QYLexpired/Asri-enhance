var Dt=require("siyuan");var re="asri-enhance-",ae=["amber","wilderness","midnight","salt","rosepine","topaz","oxygen","shade","gruvbox"];async function b(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(o){throw o}}async function u(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function He(e,t,n="config.json"){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";o.getAttribute("data-asri-palette")===t&&o.removeAttribute("data-asri-palette");let r=await u(e,n);if(!r)return;let a=`${re}${t}`,s=r[a];s!==void 0&&(typeof s=="boolean"?delete r[a]:s&&typeof s=="object"&&(s[i]=!1,r[a]=s),await b(e,n,r))}async function Ie(e,t="config.json"){let n=await u(e,t);if(!n)return;let o=!1;Object.keys(n).forEach(i=>{i.startsWith(re)&&(delete n[i],o=!0)}),o&&await b(e,t,n)}async function De(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light",i=await u(e,t);if(!i)return;let r=!1;ae.forEach(a=>{let s=`${re}${a}`,l=i[s];l!==void 0&&(typeof l=="boolean"?(delete i[s],r=!0):l&&typeof l=="object"&&l[o]===!0&&(l[o]=!1,i[s]=l,r=!0))}),r&&await b(e,t,i)}var se="config.json";async function y(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";if(o.getAttribute("data-asri-palette")===t.name)return;let a=await u(e,se)||{},s=a[t.configKey]||{light:!1,dark:!1},l=()=>{o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name),s[i]=!0;for(let p of t.otherConfigKeys)if(a[p]){let g=a[p];typeof g=="object"&&(g[i]=!1,a[p]=g)}a[t.configKey]=s};document.startViewTransition?await document.startViewTransition(()=>{l()}).finished.catch(()=>{}):l(),await b(e,se,a).catch(()=>{})}async function w(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light",r=n!==void 0?n:await u(e,se);if(r&&r[t.configKey]){let a=r[t.configKey];(typeof a=="boolean"?a:a[i]===!0)?(o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name)):o.getAttribute("data-asri-palette")===t.name&&o.removeAttribute("data-asri-palette")}}var Se={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Be(e,t){return y(e,Se,t)}async function Ne(e,t){return w(e,Se,t)}var Fe={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Re(e,t){return y(e,Fe,t)}async function Oe(e,t){return w(e,Fe,t)}var ze={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Ke(e,t){return y(e,ze,t)}async function je(e,t){return w(e,ze,t)}var qe={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function $e(e,t){return y(e,qe,t)}async function Ge(e,t){return w(e,qe,t)}var Ue={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Ve(e,t){return y(e,Ue,t)}async function Ye(e,t){return w(e,Ue,t)}var We={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Xe(e,t){return y(e,We,t)}async function Ze(e,t){return w(e,We,t)}var Je={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade","asri-enhance-gruvbox"]};async function Qe(e,t){return y(e,Je,t)}async function et(e,t){return w(e,Je,t)}var tt={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-gruvbox"]};async function nt(e,t){return y(e,tt,t)}async function ot(e,t){return w(e,tt,t)}var it={name:"gruvbox",configKey:"asri-enhance-gruvbox",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function rt(e,t){return y(e,it,t)}async function at(e,t){return w(e,it,t)}var le="config.json",ce="asri-enhance-coloredheading";async function st(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-coloredheading"),i=await u(e,le)||{};o?(n.removeAttribute("data-asri-enhance-coloredheading"),i[ce]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),i[ce]=!0),await b(e,le,i).catch(()=>{})}async function lt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,le);o&&o[ce]===!0?n.setAttribute("data-asri-enhance-coloredheading","true"):n.removeAttribute("data-asri-enhance-coloredheading")}var ue="config.json",me="asri-enhance-colored-tree";async function ct(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-colored-tree"),i=await u(e,ue)||{};o?(n.removeAttribute("data-asri-enhance-colored-tree"),i[me]=!1):(n.setAttribute("data-asri-enhance-colored-tree","true"),i[me]=!0),await b(e,ue,i).catch(()=>{})}async function ut(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,ue);o&&o[me]===!0?n.setAttribute("data-asri-enhance-colored-tree","true"):n.removeAttribute("data-asri-enhance-colored-tree")}var de="config.json",he="asri-enhance-typewriter",te=null,fe=!1,oe=!1,k=null,S=!1,St=500;function Bt(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,o;if(n.nodeType===Node.TEXT_NODE?o=n.parentElement:o=n.nodeType===Node.ELEMENT_NODE?n:null,o){let i=o;for(;i&&i!==document.body;){if(i.hasAttribute&&i.hasAttribute("contenteditable"))return o;i=i.parentElement}}return null}function Nt(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth,i=t.top+t.height/2,r=t.left+t.width/2,a=n/2,s=o/2,l=Math.abs(i-a),p=Math.abs(r-s);return l>5||p>5}function Ft(e){e&&Nt(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function Rt(){let e=null,t=()=>{if(!fe||oe||S)return;let r=Bt();r!==e&&(e=r,r&&setTimeout(()=>{Ft(r)},50))},n=()=>{oe=!0,S=!1,k=window.setTimeout(()=>{S=!0},St)},o=()=>{oe=!1,k&&(clearTimeout(k),k=null),S?setTimeout(()=>{S=!1},200):setTimeout(t,10)},i=()=>{oe=!1,S=!1,k&&(clearTimeout(k),k=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",o),document.addEventListener("mouseleave",i),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",o),document.removeEventListener("mouseleave",i),k&&(clearTimeout(k),k=null)}}}function mt(){te&&ne(),fe=!0,te=Rt()}function ne(){fe=!1,te&&(te.destroy(),te=null)}async function dt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-typewriter"),i=await u(e,de)||{};o?(n.removeAttribute("data-asri-enhance-typewriter"),i[he]=!1,ne()):(n.setAttribute("data-asri-enhance-typewriter","true"),i[he]=!0,mt()),await b(e,de,i).catch(()=>{})}async function ht(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,de);o&&o[he]===!0?(n.setAttribute("data-asri-enhance-typewriter","true"),mt()):(n.removeAttribute("data-asri-enhance-typewriter"),ne())}var pe="config.json",ge="asri-enhance-listbulletline",Ot=".asri-bullet-highlight,.asri-bullet-line",be="asri-bullet-highlight",A="asri-bullet-line",B="--asri-bullet-line-height",N=null,H=null,ie=new Set,ft=()=>{document.querySelectorAll(Ot).forEach(e=>{e.classList.remove(be,A),e.style.removeProperty(B)}),ie.clear()},zt=e=>{e.classList.remove(be,A),e.style.removeProperty(B)},Kt=(e,t,n)=>{if(e.classList.add(be),t&&n){let o=e.getBoundingClientRect(),i=n.getBoundingClientRect();e.style.setProperty(B,`${o.top-i.top}px`),e.classList.add(A)}},pt=()=>{var o,i;let e=window.getSelection(),t=[];if(e&&e.rangeCount){let r=e.getRangeAt(0).startContainer;for(;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.parentElement;for(;r;){let a=r;if(((o=a.dataset)==null?void 0:o.type)==="NodeListItem"&&t.push(a),(i=a.classList)!=null&&i.contains("protyle-wysiwyg"))break;r=a.parentElement}}let n=new Set(t);ie.forEach(r=>{n.has(r)||zt(r)}),t.forEach((r,a)=>{let s=a<t.length-1,l=s?t[a+1]:void 0;if(!ie.has(r))Kt(r,s,l);else if(s&&l){let p=r.getBoundingClientRect(),g=l.getBoundingClientRect(),x=`${p.top-g.top}px`;r.style.getPropertyValue(B)!==x&&r.style.setProperty(B,x),r.classList.contains(A)||r.classList.add(A)}else r.classList.contains(A)&&(r.classList.remove(A),r.style.removeProperty(B))}),ie=n},gt=()=>{N||(N=()=>{H&&clearTimeout(H),H=setTimeout(()=>{pt(),H=null},50)},document.addEventListener("selectionchange",N),pt())},ve=()=>{if(!N){ft();return}H&&(clearTimeout(H),H=null),document.removeEventListener("selectionchange",N),N=null,ft()};async function bt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-listbulletline"),i=await u(e,pe)||{};o?(n.removeAttribute("data-asri-enhance-listbulletline"),i[ge]=!1,ve()):(n.setAttribute("data-asri-enhance-listbulletline","true"),i[ge]=!0,gt()),await b(e,pe,i).catch(()=>{})}async function vt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,pe);o&&o[ge]===!0?(n.setAttribute("data-asri-enhance-listbulletline","true"),gt()):(n.removeAttribute("data-asri-enhance-listbulletline"),ve())}var yt=()=>{ve()};var ye="config.json",we="asri-enhance-sidebar-top-sticky";async function wt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-sidebar-top-sticky"),i=await u(e,ye)||{};o?(n.removeAttribute("data-asri-enhance-sidebar-top-sticky"),i[we]=!1):(n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"),i[we]=!0),await b(e,ye,i).catch(()=>{})}async function Ct(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,ye);o&&o[we]===!0?n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"):n.removeAttribute("data-asri-enhance-sidebar-top-sticky")}var Ce="config.json",Ee="asri-enhance-cover-image-fade";async function Et(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-cover-image-fade"),i=await u(e,Ce)||{};o?(n.removeAttribute("data-asri-enhance-cover-image-fade"),i[Ee]=!1):(n.setAttribute("data-asri-enhance-cover-image-fade","true"),i[Ee]=!0),await b(e,Ce,i).catch(()=>{})}async function Pt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Ce);o&&o[Ee]===!0?n.setAttribute("data-asri-enhance-cover-image-fade","true"):n.removeAttribute("data-asri-enhance-cover-image-fade")}var Pe="config.json",Te="asri-enhance-hide-tab-breadcrumb";async function Tt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-hide-tab-breadcrumb"),i=await u(e,Pe)||{};o?(n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb"),i[Te]=!1):(n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"),i[Te]=!0),await b(e,Pe,i).catch(()=>{})}async function Mt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await u(e,Pe);o&&o[Te]===!0?n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"):n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb")}function xt(e,t,n=100){let o,i,r=null,a=0,s=new Set,l=10,p=100,g=()=>{s.forEach(v=>window.clearTimeout(v)),s.clear()},x=(v,P)=>{let T=window.setTimeout(()=>{s.delete(T),v()},P);return s.add(T),T},m=v=>{o!==void 0&&window.clearTimeout(o),o=window.setTimeout(()=>{g();let P=(T=0)=>{var z,K,j,q,$,G,U,V,_,Y;let D=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(D){let E=D.parentElement;if(E){if(!E.querySelector("#asri-enhance-palette")){let f=document.createElement("button");f.className="b3-menu__item asri-enhance",f.id="asri-enhance-palette",f.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((j=e.i18n)==null?void 0:j.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((G=e.i18n)==null?void 0:G.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((U=e.i18n)==null?void 0:U.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((V=e.i18n)==null?void 0:V.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((_=e.i18n)==null?void 0:_.shade)||"Shade"}</span></button><button class="b3-menu__item" id="asri-enhance-gruvbox"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((Y=e.i18n)==null?void 0:Y.gruvbox)||"Gruvbox"}</span></button></div></div>`,E.insertBefore(f,D)}let W=E.querySelector("#asri-enhance-amber");W&&(W.onclick=f=>Be(e,f));let c=E.querySelector("#asri-enhance-wilderness");c&&(c.onclick=f=>Re(e,f));let X=E.querySelector("#asri-enhance-midnight");X&&(X.onclick=f=>Ke(e,f));let Z=E.querySelector("#asri-enhance-salt");Z&&(Z.onclick=f=>$e(e,f));let J=E.querySelector("#asri-enhance-rosepine");J&&(J.onclick=f=>Ve(e,f));let Q=E.querySelector("#asri-enhance-topaz");Q&&(Q.onclick=f=>Xe(e,f));let ee=E.querySelector("#asri-enhance-oxygen");ee&&(ee.onclick=f=>Qe(e,f));let h=E.querySelector("#asri-enhance-shade");h&&(h.onclick=f=>nt(e,f));let d=E.querySelector("#asri-enhance-gruvbox");d&&(d.onclick=f=>rt(e,f))}t(v);return}T+1<l?x(()=>P(T+1),p):t(v)};P(),o=void 0},n)},C=()=>{let v=document.querySelector("#barMode");if(v){r=v,v.addEventListener("click",m,!0),i=void 0;return}a+=1,a<l?i=window.setTimeout(C,p):i=void 0};return C(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),g(),r&&(r.removeEventListener("click",m,!0),r=null),o!==void 0&&(window.clearTimeout(o),o=void 0)}}function _t(e,t=100){let n,o,i=null,r=0,a=new Set,s=10,l=100,p=()=>{a.forEach(C=>window.clearTimeout(C)),a.clear()},g=(C,v)=>{let P=window.setTimeout(()=>{a.delete(P),C()},v);return a.add(P),P},x=C=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{p();let v=(P=0)=>{var D,z,K,j,q,$,G,U,V;let T=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(T){let _=T.parentElement;if(_){if(!_.querySelector("#asri-enhance-more")){let c=document.createElement("button");c.className="b3-menu__item asri-enhance",c.id="asri-enhance-more",c.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-detail-adjustment"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.detailAdjustment)||"detailAdjustment"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"></div></div></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((j=e.i18n)==null?void 0:j.listBulletLine)||"listBulletLine"}</span></button></div></div>`,T.nextSibling?_.insertBefore(c,T.nextSibling):_.appendChild(c)}let Y=_.querySelector("#asri-enhance-typewriter");Y&&(Y.onclick=c=>dt(e,c));let E=_.querySelector("#asri-enhance-list-bullet-line");E&&(E.onclick=c=>bt(e,c));let W=_.querySelector("#asri-enhance-detail-adjustment");if(W){let c=W.querySelector(".b3-menu__submenu .b3-menu__items");if(c&&!c.querySelector("#asri-enhance-sidebar-top-sticky")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',d=document.createElement("button");d.className="b3-menu__item",d.id="asri-enhance-sidebar-top-sticky",d.innerHTML=`${h}<span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.sidebarTopSticky)||"sidebarTopSticky"}</span>`,c.appendChild(d)}let X=c==null?void 0:c.querySelector("#asri-enhance-sidebar-top-sticky");if(X&&(X.onclick=h=>wt(e,h)),c&&!c.querySelector("#asri-enhance-cover-image-fade")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',d=document.createElement("button");d.className="b3-menu__item",d.id="asri-enhance-cover-image-fade",d.innerHTML=`${h}<span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.coverImageFade)||"coverImageFade"}</span>`,c.appendChild(d)}let Z=c==null?void 0:c.querySelector("#asri-enhance-cover-image-fade");if(Z&&(Z.onclick=h=>Et(e,h)),c&&!c.querySelector("#asri-enhance-colored-heading")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',d=document.createElement("button");d.className="b3-menu__item",d.id="asri-enhance-colored-heading",d.innerHTML=`${h}<span class="b3-menu__label">${((G=e.i18n)==null?void 0:G.coloredHeading)||"coloredHeading"}</span>`,c.appendChild(d)}let J=c==null?void 0:c.querySelector("#asri-enhance-colored-heading");if(J&&(J.onclick=h=>st(e,h)),c&&!c.querySelector("#asri-enhance-colored-tree")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',d=document.createElement("button");d.className="b3-menu__item",d.id="asri-enhance-colored-tree",d.innerHTML=`${h}<span class="b3-menu__label">${((U=e.i18n)==null?void 0:U.coloredTree)||"coloredTree"}</span>`,c.appendChild(d)}let Q=c==null?void 0:c.querySelector("#asri-enhance-colored-tree");if(Q&&(Q.onclick=h=>ct(e,h)),c&&!c.querySelector("#asri-enhance-hide-tab-breadcrumb")){let h='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',d=document.createElement("button");d.className="b3-menu__item",d.id="asri-enhance-hide-tab-breadcrumb",d.innerHTML=`${h}<span class="b3-menu__label">${((V=e.i18n)==null?void 0:V.hideTabBreadcrumb)||"hideTabBreadcrumb"}</span>`,c.appendChild(d)}let ee=c==null?void 0:c.querySelector("#asri-enhance-hide-tab-breadcrumb");ee&&(ee.onclick=h=>Tt(e,h))}}return}P+1<s&&g(()=>v(P+1),l)};v(),n=void 0},t)},m=()=>{let C=document.querySelector("#barMode");if(C){i=C,C.addEventListener("click",x,!0),o=void 0;return}r+=1,r<s?o=window.setTimeout(m,l):o=void 0};return m(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),p(),i&&(i.removeEventListener("click",x,!0),i=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var xe=!1,L=null,Me=0,M=null,F=null,R=null,O=null;function _e(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function I(){if(xe=!1,M=null,L!==null&&(clearInterval(L),L=null),F){try{F.disconnect()}catch(e){}F=null}if(R){try{R.disconnect()}catch(e){}R=null}}function ke(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function Le(){if(M){if(!F){F=new MutationObserver(()=>{ke(M)||I()});try{F.observe(M,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!R){R=new MutationObserver(()=>{ke(M)||I()});try{R.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function jt(){let e=_e();return e?(M=e,Le(),!0):(Me=0,L=setInterval(()=>{Me+=1;let t=_e();t?(M=t,clearInterval(L),L=null,Le()):Me>=10&&(clearInterval(L),L=null,I())},100),!1)}function qt(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function At(e){return e?e.querySelector(".b3-list-item--focus"):null}function $t(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function Gt(e,t,n){if(!t||e.length===0)return null;let o=t.getBoundingClientRect(),i={x:o.left+o.width/2,y:o.top+o.height/2,el:t},r=$t(e),a=Math.max(o.width/2,10),s;switch(n){case"ArrowUp":s=m=>m.y<i.y-1&&Math.abs(m.x-i.x)<=a;break;case"ArrowDown":s=m=>m.y>i.y+1&&Math.abs(m.x-i.x)<=a;break;case"ArrowLeft":s=m=>m.x<i.x-1;break;case"ArrowRight":s=m=>m.x>i.x+1;break;default:return null}let l=r.filter(m=>m.el!==t&&s(m));if(l.length===0)return null;let p=(m,C)=>{let v=m.x-C.x,P=m.y-C.y;return v*v+P*P},g=l[0],x=p(g,i);for(let m=1;m<l.length;m++){let C=p(l[m],i);C<x&&(g=l[m],x=C)}return g.el}function kt(e){if(!M||!e)return;let t=At(M);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function Ut(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[0])!=null?o:null:n+1<e.length?e[n+1]:(i=e[0])!=null?i:null}function Vt(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[e.length-1])!=null?o:null:n-1>=0?e[n-1]:(i=e[e.length-1])!=null?i:null}function Lt(e,t){let n=t.getBoundingClientRect(),o=n.top+n.height/2,i=[];for(let r of e){if(r===t)continue;let a=r.getBoundingClientRect(),s=a.top+a.height/2,l=Math.min(n.height,a.height)/2;Math.abs(s-o)<=l&&i.push(r)}return i}function Yt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function Wt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var Xt=e=>{var l,p;if(e.key==="/"){I(),xe=!0,jt();return}if(!xe)return;if(e.key==="Escape"){I();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=M||_e();if(!n||!ke(n)){I();return}e.preventDefault(),e.stopPropagation(),M=n,Le();let o=qt(n);if(o.length===0)return;let i=At(n);i||(i=o[0],i.classList.add("b3-list-item--focus"));let r=Gt(o,i,e.key);if(r){kt(r);return}let a=null,s=e.key;if(s==="ArrowDown")a=Ut(o,i);else if(s==="ArrowUp")a=Vt(o,i);else if(s==="ArrowRight"){let g=Lt(o,i);g.length>0&&(a=(l=Yt(g)[0])!=null?l:null)}else if(s==="ArrowLeft"){let g=Lt(o,i);g.length>0&&(a=(p=Wt(g)[0])!=null?p:null)}a&&a!==i&&kt(a)};function Ht(){typeof document!="undefined"&&(O||(O=Xt,document.addEventListener("keydown",O,{capture:!0})))}function It(){typeof document!="undefined"&&(O&&(document.removeEventListener("keydown",O,{capture:!0}),O=null),I())}var Ae=class extends Dt.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null;this.themeModeChangeTimers=[];this.paletteDisableMouseUpHandler=null;this.paletteDisableDebounceTimer=null}async applyAllConfigs(n){await Promise.all([Ne(this,n).catch(()=>{}),Oe(this,n).catch(()=>{}),je(this,n).catch(()=>{}),Ge(this,n).catch(()=>{}),Ye(this,n).catch(()=>{}),Ze(this,n).catch(()=>{}),et(this,n).catch(()=>{}),ot(this,n).catch(()=>{}),at(this,n).catch(()=>{}),lt(this,n).catch(()=>{}),ut(this,n).catch(()=>{}),ht(this,n).catch(()=>{}),vt(this,n).catch(()=>{}),Ct(this,n).catch(()=>{}),Pt(this,n).catch(()=>{}),Mt(this,n).catch(()=>{})])}async onload(){this.unsubscribeBarModeClick=xt(this,()=>{}),this.unsubscribeTopbarFusionPlus=_t(this),this.asriConfigClickHandler=i=>{queueMicrotask(()=>{let r=i.target;if(!r||r.closest("#asri-enhance-amber")||r.closest("#asri-enhance-wilderness")||r.closest("#asri-enhance-midnight")||r.closest("#asri-enhance-salt")||r.closest("#asri-enhance-rosepine")||r.closest("#asri-enhance-topaz")||r.closest("#asri-enhance-oxygen")||r.closest("#asri-enhance-shade")||r.closest("#asri-enhance-gruvbox"))return;let a=r.closest(".asri-config");a&&a.id!=="topbarFusionPlus"&&ae.forEach(s=>{He(this,s,"config.json").catch(()=>{})})})},document.addEventListener("click",this.asriConfigClickHandler,!0),this.paletteDisableMouseUpHandler=i=>{queueMicrotask(()=>{var s;let r=i.target;if(!r)return;(((s=r.id)==null?void 0:s.startsWith("prst-palette"))||r.closest("[id^='prst-palette']")!==null||r.id==="pickColor"||r.closest("#pickColor")!==null||r.id==="followSysAccent"||r.closest("#followSysAccent")!==null||r.id==="followCoverImgColor"||r.closest("#followCoverImgColor")!==null)&&(this.paletteDisableDebounceTimer!==null&&clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=window.setTimeout(()=>{De(this,"config.json").then(()=>{u(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{})}).catch(()=>{}),this.paletteDisableDebounceTimer=null},200))})},document.addEventListener("mouseup",this.paletteDisableMouseUpHandler,!1);let n=await u(this,"config.json"),o=document.documentElement;o&&(this.themeModeObserver=new MutationObserver(i=>{queueMicrotask(()=>{for(let r of i)if(r.type==="attributes"&&r.attributeName==="data-theme-mode"){this.themeModeChangeTimers.forEach(l=>{clearTimeout(l)}),this.themeModeChangeTimers=[],u(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{});let a=window.setTimeout(()=>{u(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{})},100);this.themeModeChangeTimers.push(a);let s=window.setTimeout(()=>{u(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{})},500);this.themeModeChangeTimers.push(s)}})}),this.themeModeObserver.observe(o,{attributes:!0,attributeFilter:["data-theme-mode"]})),await this.applyAllConfigs(n),Ht(),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},100),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),this.themeModeChangeTimers.forEach(n=>{clearTimeout(n)}),this.themeModeChangeTimers=[],this.paletteDisableMouseUpHandler&&(document.removeEventListener("mouseup",this.paletteDisableMouseUpHandler,!0),this.paletteDisableMouseUpHandler=null),this.paletteDisableDebounceTimer!==null&&(clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=null),yt(),ne(),It()}async uninstall(){this.onunload(),await Ie(this,"config.json").catch(()=>{})}};module.exports=Ae;
