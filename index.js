var ne=require("siyuan");async function b(t,i,e){if(!t.saveData)throw new Error("Plugin saveData method is not available");try{await t.saveData(i,e)}catch(o){throw o}}async function l(t,i){if(!t.loadData)return null;try{return await t.loadData(i)||null}catch(e){return null}}async function B(t,i="config.json"){let e=document.documentElement;if(!e)return;let o=e.getAttribute("data-theme-mode")||"light";e.getAttribute("data-asri-palette")==="amber"&&e.removeAttribute("data-asri-palette");let n=await l(t,i);if(n&&n["asri-enhance-amber"]){let a=n["asri-enhance-amber"];typeof a=="boolean"?delete n["asri-enhance-amber"]:(a[o]=!1,n["asri-enhance-amber"]=a),await b(t,i,n)}}async function F(t,i="config.json"){let e=document.documentElement;if(!e)return;let o=e.getAttribute("data-theme-mode")||"light";e.getAttribute("data-asri-palette")==="wilderness"&&e.removeAttribute("data-asri-palette");let n=await l(t,i);if(n&&n["asri-enhance-wilderness"]){let a=n["asri-enhance-wilderness"];typeof a=="boolean"?delete n["asri-enhance-wilderness"]:(a[o]=!1,n["asri-enhance-wilderness"]=a),await b(t,i,n)}}async function D(t,i="config.json"){let e=document.documentElement;if(!e)return;let o=e.getAttribute("data-theme-mode")||"light";e.getAttribute("data-asri-palette")==="midnight"&&e.removeAttribute("data-asri-palette");let n=await l(t,i);if(n&&n["asri-enhance-midnight"]){let a=n["asri-enhance-midnight"];typeof a=="boolean"?delete n["asri-enhance-midnight"]:(a[o]=!1,n["asri-enhance-midnight"]=a),await b(t,i,n)}}async function $(t,i="config.json"){let e=document.documentElement;if(!e)return;(e.getAttribute("data-asri-palette")==="amber"||e.getAttribute("data-asri-palette")==="wilderness"||e.getAttribute("data-asri-palette")==="midnight")&&e.removeAttribute("data-asri-palette"),e.hasAttribute("data-asri-enhance-coloredheading")&&e.removeAttribute("data-asri-enhance-coloredheading");let o=await l(t,i);if(o){let n=Object.keys(o).filter(a=>a.startsWith("asri-enhance-"));n.length>0&&(n.forEach(a=>{delete o[a]}),await b(t,i,o))}}var j="config.json";async function y(t,i,e){let o=document.documentElement;if(!o)return;let n=o.getAttribute("data-theme-mode")||"light";if(o.getAttribute("data-asri-palette")===i.name)return;let r=await l(t,j)||{},h=r[i.configKey]||{light:!1,dark:!1},w=()=>{o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",i.name),h[n]=!0;for(let f of i.otherConfigKeys)if(r[f]){let C=r[f];typeof C=="object"&&(C[n]=!1,r[f]=C)}r[i.configKey]=h};document.startViewTransition?await document.startViewTransition(()=>{w()}).finished.catch(()=>{}):w(),await b(t,j,r).catch(()=>{})}async function M(t,i){let e=document.documentElement;if(!e)return;let o=e.getAttribute("data-theme-mode")||"light",n=await l(t,j);if(n&&n[i.configKey]){let a=n[i.configKey];(typeof a=="boolean"?a:a[o]===!0)?(e.removeAttribute("data-asri-palette"),e.setAttribute("data-asri-palette",i.name)):e.getAttribute("data-asri-palette")===i.name&&e.removeAttribute("data-asri-palette")}}var G={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness"]};async function U(t,i){return y(t,G,i)}async function T(t){return M(t,G)}var V={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight"]};async function Y(t,i){return y(t,V,i)}async function x(t){return M(t,V)}var J={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness"]};async function Q(t,i){return y(t,J,i)}async function L(t){return M(t,J)}var S="config.json",K="asri-enhance-coloredheading";async function X(t,i){i&&(i.preventDefault(),i.stopPropagation());let e=document.documentElement;if(!e)return;let o=e.hasAttribute("data-asri-enhance-coloredheading"),n=await l(t,S)||{};o?(e.removeAttribute("data-asri-enhance-coloredheading"),n[K]=!1):(e.setAttribute("data-asri-enhance-coloredheading","true"),n[K]=!0),await b(t,S,n).catch(()=>{})}async function I(t){let i=document.documentElement;if(!i)return;let e=await l(t,S);e&&e[K]===!0?i.setAttribute("data-asri-enhance-coloredheading","true"):i.removeAttribute("data-asri-enhance-coloredheading")}var N="config.json",q="asri-enhance-coloredoutline";async function Z(t,i){i&&(i.preventDefault(),i.stopPropagation());let e=document.documentElement;if(!e)return;let o=e.hasAttribute("data-asri-enhance-coloredoutline"),n=await l(t,N)||{};o?(e.removeAttribute("data-asri-enhance-coloredoutline"),n[q]=!1):(e.setAttribute("data-asri-enhance-coloredoutline","true"),n[q]=!0),await b(t,N,n).catch(()=>{})}async function O(t){let i=document.documentElement;if(!i)return;let e=await l(t,N);e&&e[q]===!0?i.setAttribute("data-asri-enhance-coloredoutline","true"):i.removeAttribute("data-asri-enhance-coloredoutline")}function ee(t,i,e=100){let o,n,a=null,r=0,h=new Set,w=10,f=100,C=()=>{h.forEach(s=>window.clearTimeout(s)),h.clear()},H=(s,d)=>{let m=window.setTimeout(()=>{h.delete(m),s()},d);return h.add(m),m},E=s=>{o!==void 0&&window.clearTimeout(o),o=window.setTimeout(()=>{C();let d=(m=0)=>{var _,k,p,A;let P=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(P){let v=P.parentElement;if(v){if(!v.querySelector("#asri-enhance-palette")){let g=document.createElement("button");g.className="b3-menu__item asri-enhance",g.id="asri-enhance-palette",g.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((_=t.i18n)==null?void 0:_.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((k=t.i18n)==null?void 0:k.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((p=t.i18n)==null?void 0:p.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((A=t.i18n)==null?void 0:A.midnight)||"midnight"}</span></button></div></div>`,v.insertBefore(g,P)}let c=v.querySelector("#asri-enhance-amber");c&&(c.onclick=g=>U(t,g));let W=v.querySelector("#asri-enhance-wilderness");W&&(W.onclick=g=>Y(t,g));let R=v.querySelector("#asri-enhance-midnight");R&&(R.onclick=g=>Q(t,g))}i(s);return}m+1<w?H(()=>d(m+1),f):i(s)};d(),o=void 0},e)},u=()=>{let s=document.querySelector("#barMode");if(s){a=s,s.addEventListener("click",E,!0),n=void 0;return}r+=1,r<w?n=window.setTimeout(u,f):n=void 0};return u(),()=>{n!==void 0&&(window.clearTimeout(n),n=void 0),C(),a&&(a.removeEventListener("click",E,!0),a=null),o!==void 0&&(window.clearTimeout(o),o=void 0)}}function te(t,i=100){let e,o,n=null,a=0,r=new Set,h=10,w=100,f=()=>{r.forEach(u=>window.clearTimeout(u)),r.clear()},C=(u,s)=>{let d=window.setTimeout(()=>{r.delete(d),u()},s);return r.add(d),d},H=u=>{e!==void 0&&window.clearTimeout(e),e=window.setTimeout(()=>{f();let s=(d=0)=>{var P,_,k;let m=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(m){let p=m.parentElement;if(p){if(!p.querySelector("#asri-enhance-more")){let c=document.createElement("button");c.className="b3-menu__item asri-enhance",c.id="asri-enhance-more",c.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((P=t.i18n)==null?void 0:P.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-colored-heading"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((_=t.i18n)==null?void 0:_.coloredHeading)||"coloredHeading"}</span></button><button class="b3-menu__item" id="asri-enhance-colored-outline"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((k=t.i18n)==null?void 0:k.coloredOutline)||"coloredOutline"}</span></button></div></div>`,m.nextSibling?p.insertBefore(c,m.nextSibling):p.appendChild(c)}let A=p.querySelector("#asri-enhance-colored-heading");A&&(A.onclick=c=>X(t,c));let v=p.querySelector("#asri-enhance-colored-outline");v&&(v.onclick=c=>Z(t,c))}return}d+1<h&&C(()=>s(d+1),w)};s(),e=void 0},i)},E=()=>{let u=document.querySelector("#barMode");if(u){n=u,u.addEventListener("click",H,!0),o=void 0;return}a+=1,a<h?o=window.setTimeout(E,w):o=void 0};return E(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),f(),n&&(n.removeEventListener("click",H,!0),n=null),e!==void 0&&(window.clearTimeout(e),e=void 0)}}var z=class extends ne.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null}async onload(){this.unsubscribeBarModeClick=ee(this,()=>{}),this.unsubscribeTopbarFusionPlus=te(this),this.asriConfigClickHandler=o=>{let n=o.target;if(!n||n.closest("#asri-enhance-amber")||n.closest("#asri-enhance-wilderness")||n.closest("#asri-enhance-midnight"))return;let a=n.closest(".asri-config");a&&a.id!=="topbarFusionPlus"&&(B(this,"config.json").catch(()=>{}),F(this,"config.json").catch(()=>{}),D(this,"config.json").catch(()=>{}))},document.addEventListener("click",this.asriConfigClickHandler,!0);let e=document.documentElement;e&&(this.themeModeObserver=new MutationObserver(o=>{for(let n of o)n.type==="attributes"&&n.attributeName==="data-theme-mode"&&(T(this).catch(()=>{}),x(this).catch(()=>{}),L(this).catch(()=>{}))}),this.themeModeObserver.observe(e,{attributes:!0,attributeFilter:["data-theme-mode"]})),T(this).catch(()=>{}),x(this).catch(()=>{}),L(this).catch(()=>{}),I(this).catch(()=>{}),O(this).catch(()=>{}),setTimeout(()=>{T(this).catch(()=>{}),x(this).catch(()=>{}),L(this).catch(()=>{}),I(this).catch(()=>{}),O(this).catch(()=>{})},500),setTimeout(()=>{T(this).catch(()=>{}),x(this).catch(()=>{}),L(this).catch(()=>{}),I(this).catch(()=>{}),O(this).catch(()=>{})},1500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null)}async uninstall(){this.onunload(),await $(this,"config.json").catch(()=>{})}};module.exports=z;
