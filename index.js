var ht=require("siyuan");var ke="asri-enhance-",Ae=["amber","wilderness","midnight","salt","rosepine","topaz","oxygen","shade"];async function y(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(i){throw i}}async function g(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function He(e,t,n="config.json"){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";i.getAttribute("data-asri-palette")===t&&i.removeAttribute("data-asri-palette");let r=await g(e,n);if(!r)return;let a=`${ke}${t}`,s=r[a];s!==void 0&&(typeof s=="boolean"?delete r[a]:s&&typeof s=="object"&&(s[o]=!1,r[a]=s),await y(e,n,r))}async function Ie(e,t="config.json"){let n=await g(e,t);if(!n)return;let i=!1;Object.keys(n).forEach(o=>{o.startsWith(ke)&&(delete n[o],i=!0)}),i&&await y(e,t,n)}var oe="config.json";async function b(e,t,n){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";if(i.getAttribute("data-asri-palette")===t.name)return;let a=await g(e,oe)||{},s=a[t.configKey]||{light:!1,dark:!1},u=()=>{i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",t.name),s[o]=!0;for(let d of t.otherConfigKeys)if(a[d]){let h=a[d];typeof h=="object"&&(h[o]=!1,a[d]=h)}a[t.configKey]=s};document.startViewTransition?await document.startViewTransition(()=>{u()}).finished.catch(()=>{}):u(),await y(e,oe,a).catch(()=>{})}async function v(e,t){let n=document.documentElement;if(!n)return;let i=n.getAttribute("data-theme-mode")||"light",o=await g(e,oe);if(o&&o[t.configKey]){let r=o[t.configKey];(typeof r=="boolean"?r:r[i]===!0)?(n.removeAttribute("data-asri-palette"),n.setAttribute("data-asri-palette",t.name)):n.getAttribute("data-asri-palette")===t.name&&n.removeAttribute("data-asri-palette")}}var Se={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function Oe(e,t){return b(e,Se,t)}async function j(e){return v(e,Se)}var Ne={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function Be(e,t){return b(e,Ne,t)}async function q(e){return v(e,Ne)}var De={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function Fe(e,t){return b(e,De,t)}async function $(e){return v(e,De)}var Re={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function ze(e,t){return b(e,Re,t)}async function V(e){return v(e,Re)}var Ke={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function je(e,t){return b(e,Ke,t)}async function G(e){return v(e,Ke)}var qe={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade"]};async function $e(e,t){return b(e,qe,t)}async function U(e){return v(e,qe)}var Ve={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade"]};async function Ge(e,t){return b(e,Ve,t)}async function W(e){return v(e,Ve)}var Ue={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen"]};async function We(e,t){return b(e,Ue,t)}async function Y(e){return v(e,Ue)}var ie="config.json",re="asri-enhance-coloredheading";async function Ye(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredheading"),o=await g(e,ie)||{};i?(n.removeAttribute("data-asri-enhance-coloredheading"),o[re]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),o[re]=!0),await y(e,ie,o).catch(()=>{})}async function J(e){let t=document.documentElement;if(!t)return;let n=await g(e,ie);n&&n[re]===!0?t.setAttribute("data-asri-enhance-coloredheading","true"):t.removeAttribute("data-asri-enhance-coloredheading")}var ae="config.json",se="asri-enhance-coloredoutline";async function Xe(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredoutline"),o=await g(e,ae)||{};i?(n.removeAttribute("data-asri-enhance-coloredoutline"),o[se]=!1):(n.setAttribute("data-asri-enhance-coloredoutline","true"),o[se]=!0),await y(e,ae,o).catch(()=>{})}async function Q(e){let t=document.documentElement;if(!t)return;let n=await g(e,ae);n&&n[se]===!0?t.setAttribute("data-asri-enhance-coloredoutline","true"):t.removeAttribute("data-asri-enhance-coloredoutline")}var le="config.json",ce="asri-enhance-typewriter",X=null,ue=!1,ee=!1,M=null,k=!1,ft=500;function pt(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,i;if(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n.nodeType===Node.ELEMENT_NODE?n:null,i){let o=i;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return i;o=o.parentElement}}return null}function gt(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,i=window.innerWidth,o=t.top+t.height/2,r=t.left+t.width/2,a=n/2,s=i/2,u=Math.abs(o-a),d=Math.abs(r-s);return u>5||d>5}function bt(e){e&&gt(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function vt(){let e=null,t=()=>{if(!ue||ee||k)return;let r=pt();r!==e&&(e=r,r&&setTimeout(()=>{bt(r)},50))},n=()=>{ee=!0,k=!1,M=window.setTimeout(()=>{k=!0},ft)},i=()=>{ee=!1,M&&(clearTimeout(M),M=null),k?setTimeout(()=>{k=!1},200):setTimeout(t,10)},o=()=>{ee=!1,k=!1,M&&(clearTimeout(M),M=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",o),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",o),M&&(clearTimeout(M),M=null)}}}function Ze(){X&&Z(),ue=!0,X=vt()}function Z(){ue=!1,X&&(X.destroy(),X=null)}async function Je(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-typewriter"),o=await g(e,le)||{};i?(n.removeAttribute("data-asri-enhance-typewriter"),o[ce]=!1,Z()):(n.setAttribute("data-asri-enhance-typewriter","true"),o[ce]=!0,Ze()),await y(e,le,o).catch(()=>{})}async function te(e){let t=document.documentElement;if(!t)return;let n=await g(e,le);n&&n[ce]===!0?(t.setAttribute("data-asri-enhance-typewriter","true"),Ze()):(t.removeAttribute("data-asri-enhance-typewriter"),Z())}var me="config.json",de="asri-enhance-listbulletline",wt=".asri-bullet-highlight,.asri-bullet-line",et="asri-bullet-highlight",tt="asri-bullet-line",nt="--asri-bullet-line-height",A=null,he=()=>{document.querySelectorAll(wt).forEach(e=>{e.classList.remove(et,tt),e.style.removeProperty(nt)})},Qe=()=>{var i,o;he();let e=window.getSelection();if(!e||!e.rangeCount)return;let t=[],n=e.getRangeAt(0).startContainer;for(;n&&n.nodeType!==Node.ELEMENT_NODE;)n=n.parentElement;for(;n;){let r=n;if(((i=r.dataset)==null?void 0:i.type)==="NodeListItem"&&t.push(r),(o=r.classList)!=null&&o.contains("protyle-wysiwyg"))break;n=r.parentElement}t.forEach((r,a)=>{if(r.classList.add(et),a<t.length-1){let s=r.getBoundingClientRect(),u=t[a+1].getBoundingClientRect();r.style.setProperty(nt,`${s.top-u.top}px`),r.classList.add(tt)}})},ot=()=>{A||(A=()=>{Qe()},document.addEventListener("selectionchange",A),Qe())},fe=()=>{if(!A){he();return}document.removeEventListener("selectionchange",A),A=null,he()};async function it(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-listbulletline"),o=await g(e,me)||{};i?(n.removeAttribute("data-asri-enhance-listbulletline"),o[de]=!1,fe()):(n.setAttribute("data-asri-enhance-listbulletline","true"),o[de]=!0,ot()),await y(e,me,o).catch(()=>{})}async function ne(e){let t=document.documentElement;if(!t)return;let n=await g(e,me);n&&n[de]===!0?(t.setAttribute("data-asri-enhance-listbulletline","true"),ot()):(t.removeAttribute("data-asri-enhance-listbulletline"),fe())}var rt=()=>{fe()};function at(e,t,n=100){let i,o,r=null,a=0,s=new Set,u=10,d=100,h=()=>{s.forEach(f=>window.clearTimeout(f)),s.clear()},L=(f,w)=>{let E=window.setTimeout(()=>{s.delete(E),f()},w);return s.add(E),E},l=f=>{i!==void 0&&window.clearTimeout(i),i=window.setTimeout(()=>{h();let w=(E=0)=>{var O,N,B,D,C,F,R,z,K;let _=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(_){let c=_.parentElement;if(c){if(!c.querySelector("#asri-enhance-palette")){let m=document.createElement("button");m.className="b3-menu__item asri-enhance",m.id="asri-enhance-palette",m.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((O=e.i18n)==null?void 0:O.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((N=e.i18n)==null?void 0:N.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((B=e.i18n)==null?void 0:B.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((C=e.i18n)==null?void 0:C.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((F=e.i18n)==null?void 0:F.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((R=e.i18n)==null?void 0:R.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.shade)||"Shade"}</span></button></div></div>`,c.insertBefore(m,_)}let Ee=c.querySelector("#asri-enhance-amber");Ee&&(Ee.onclick=m=>Oe(e,m));let Ce=c.querySelector("#asri-enhance-wilderness");Ce&&(Ce.onclick=m=>Be(e,m));let Pe=c.querySelector("#asri-enhance-midnight");Pe&&(Pe.onclick=m=>Fe(e,m));let Me=c.querySelector("#asri-enhance-salt");Me&&(Me.onclick=m=>ze(e,m));let Te=c.querySelector("#asri-enhance-rosepine");Te&&(Te.onclick=m=>je(e,m));let Le=c.querySelector("#asri-enhance-topaz");Le&&(Le.onclick=m=>$e(e,m));let xe=c.querySelector("#asri-enhance-oxygen");xe&&(xe.onclick=m=>Ge(e,m));let _e=c.querySelector("#asri-enhance-shade");_e&&(_e.onclick=m=>We(e,m))}t(f);return}E+1<u?L(()=>w(E+1),d):t(f)};w(),i=void 0},n)},p=()=>{let f=document.querySelector("#barMode");if(f){r=f,f.addEventListener("click",l,!0),o=void 0;return}a+=1,a<u?o=window.setTimeout(p,d):o=void 0};return p(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),h(),r&&(r.removeEventListener("click",l,!0),r=null),i!==void 0&&(window.clearTimeout(i),i=void 0)}}function st(e,t=100){let n,i,o=null,r=0,a=new Set,s=10,u=100,d=()=>{a.forEach(p=>window.clearTimeout(p)),a.clear()},h=(p,f)=>{let w=window.setTimeout(()=>{a.delete(w),p()},f);return a.add(w),w},L=p=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{d();let f=(w=0)=>{var _,O,N,B,D;let E=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(E){let C=E.parentElement;if(C){if(!C.querySelector("#asri-enhance-more")){let c=document.createElement("button");c.className="b3-menu__item asri-enhance",c.id="asri-enhance-more",c.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((_=e.i18n)==null?void 0:_.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-colored-heading"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((O=e.i18n)==null?void 0:O.coloredHeading)||"coloredHeading"}</span></button><button class="b3-menu__item" id="asri-enhance-colored-outline"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((N=e.i18n)==null?void 0:N.coloredOutline)||"coloredOutline"}</span></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((B=e.i18n)==null?void 0:B.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.listBulletLine)||"listBulletLine"}</span></button></div></div>`,E.nextSibling?C.insertBefore(c,E.nextSibling):C.appendChild(c)}let F=C.querySelector("#asri-enhance-colored-heading");F&&(F.onclick=c=>Ye(e,c));let R=C.querySelector("#asri-enhance-colored-outline");R&&(R.onclick=c=>Xe(e,c));let z=C.querySelector("#asri-enhance-typewriter");z&&(z.onclick=c=>Je(e,c));let K=C.querySelector("#asri-enhance-list-bullet-line");K&&(K.onclick=c=>it(e,c))}return}w+1<s&&h(()=>f(w+1),u)};f(),n=void 0},t)},l=()=>{let p=document.querySelector("#barMode");if(p){o=p,p.addEventListener("click",L,!0),i=void 0;return}r+=1,r<s?i=window.setTimeout(l,u):i=void 0};return l(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),d(),o&&(o.removeEventListener("click",L,!0),o=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var ge=!1,T=null,pe=0,P=null,H=null,I=null,S=null;function be(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function x(){if(ge=!1,P=null,T!==null&&(clearInterval(T),T=null),H){try{H.disconnect()}catch(e){}H=null}if(I){try{I.disconnect()}catch(e){}I=null}}function ve(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function we(){if(P){if(!H){H=new MutationObserver(()=>{ve(P)||x()});try{H.observe(P,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!I){I=new MutationObserver(()=>{ve(P)||x()});try{I.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function yt(){let e=be();return e?(P=e,we(),!0):(pe=0,T=setInterval(()=>{pe+=1;let t=be();t?(P=t,clearInterval(T),T=null,we()):pe>=10&&(clearInterval(T),T=null,x())},100),!1)}function Et(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function ut(e){return e?e.querySelector(".b3-list-item--focus"):null}function Ct(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function Pt(e,t,n){if(!t||e.length===0)return null;let i=t.getBoundingClientRect(),o={x:i.left+i.width/2,y:i.top+i.height/2,el:t},r=Ct(e),a=Math.max(i.width/2,10),s;switch(n){case"ArrowUp":s=l=>l.y<o.y-1&&Math.abs(l.x-o.x)<=a;break;case"ArrowDown":s=l=>l.y>o.y+1&&Math.abs(l.x-o.x)<=a;break;case"ArrowLeft":s=l=>l.x<o.x-1;break;case"ArrowRight":s=l=>l.x>o.x+1;break;default:return null}let u=r.filter(l=>l.el!==t&&s(l));if(u.length===0)return null;let d=(l,p)=>{let f=l.x-p.x,w=l.y-p.y;return f*f+w*w},h=u[0],L=d(h,o);for(let l=1;l<u.length;l++){let p=d(u[l],o);p<L&&(h=u[l],L=p)}return h.el}function lt(e){if(!P||!e)return;let t=ut(P);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function Mt(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[0])!=null?i:null:n+1<e.length?e[n+1]:(o=e[0])!=null?o:null}function Tt(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[e.length-1])!=null?i:null:n-1>=0?e[n-1]:(o=e[e.length-1])!=null?o:null}function ct(e,t){let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=[];for(let r of e){if(r===t)continue;let a=r.getBoundingClientRect(),s=a.top+a.height/2,u=Math.min(n.height,a.height)/2;Math.abs(s-i)<=u&&o.push(r)}return o}function Lt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function xt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var _t=e=>{var u,d;if(e.key==="/"){x(),ge=!0,yt();return}if(!ge)return;if(e.key==="Escape"){x();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=P||be();if(!n||!ve(n)){x();return}e.preventDefault(),e.stopPropagation(),P=n,we();let i=Et(n);if(i.length===0)return;let o=ut(n);o||(o=i[0],o.classList.add("b3-list-item--focus"));let r=Pt(i,o,e.key);if(r){lt(r);return}let a=null,s=e.key;if(s==="ArrowDown")a=Mt(i,o);else if(s==="ArrowUp")a=Tt(i,o);else if(s==="ArrowRight"){let h=ct(i,o);h.length>0&&(a=(u=Lt(h)[0])!=null?u:null)}else if(s==="ArrowLeft"){let h=ct(i,o);h.length>0&&(a=(d=xt(h)[0])!=null?d:null)}a&&a!==o&&lt(a)};function mt(){typeof document!="undefined"&&(S||(S=_t,document.addEventListener("keydown",S,{capture:!0})))}function dt(){typeof document!="undefined"&&(S&&(document.removeEventListener("keydown",S,{capture:!0}),S=null),x())}var ye=class extends ht.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null}async onload(){this.unsubscribeBarModeClick=at(this,()=>{}),this.unsubscribeTopbarFusionPlus=st(this),this.asriConfigClickHandler=i=>{let o=i.target;if(!o||o.closest("#asri-enhance-amber")||o.closest("#asri-enhance-wilderness")||o.closest("#asri-enhance-midnight")||o.closest("#asri-enhance-salt")||o.closest("#asri-enhance-rosepine")||o.closest("#asri-enhance-topaz")||o.closest("#asri-enhance-oxygen")||o.closest("#asri-enhance-shade"))return;let r=o.closest(".asri-config");r&&r.id!=="topbarFusionPlus"&&Ae.forEach(a=>{He(this,a,"config.json").catch(()=>{})})},document.addEventListener("click",this.asriConfigClickHandler,!0);let n=document.documentElement;n&&(this.themeModeObserver=new MutationObserver(i=>{for(let o of i)o.type==="attributes"&&o.attributeName==="data-theme-mode"&&(j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),V(this).catch(()=>{}),G(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Y(this).catch(()=>{}))}),this.themeModeObserver.observe(n,{attributes:!0,attributeFilter:["data-theme-mode"]})),j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),V(this).catch(()=>{}),G(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Y(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{}),mt(),setTimeout(()=>{j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),V(this).catch(()=>{}),G(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Y(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{})},500),setTimeout(()=>{j(this).catch(()=>{}),q(this).catch(()=>{}),$(this).catch(()=>{}),V(this).catch(()=>{}),G(this).catch(()=>{}),U(this).catch(()=>{}),W(this).catch(()=>{}),Y(this).catch(()=>{}),J(this).catch(()=>{}),Q(this).catch(()=>{}),te(this).catch(()=>{}),ne(this).catch(()=>{})},1500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),rt(),Z(),dt()}async uninstall(){this.onunload(),await Ie(this,"config.json").catch(()=>{})}};module.exports=ye;
