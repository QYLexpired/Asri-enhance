var Nn=require("siyuan");var xe="asri-enhance-",Ae=["amber","sakura","wilderness","midnight","salt","rosepine","topaz","oxygen","shade","gruvbox","glitch"];async function h(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(i){throw i}}async function m(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function dt(e,t,n="config.json"){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";i.getAttribute("data-asri-palette")===t&&i.removeAttribute("data-asri-palette");let r=await m(e,n);if(!r)return;let a=`${xe}${t}`,l=r[a];l!==void 0&&(typeof l=="boolean"?delete r[a]:l&&typeof l=="object"&&(l[o]=!1,r[a]=l),await h(e,n,r))}async function ft(e,t="config.json"){let n=await m(e,t);if(!n)return;let i=!1;Object.keys(n).forEach(o=>{o.startsWith(xe)&&(delete n[o],i=!0)}),i&&await h(e,t,n)}async function ht(e,t="config.json"){let n=document.documentElement;if(!n)return;let i=n.getAttribute("data-theme-mode")||"light",o=await m(e,t);if(!o)return;let r=!1;Ae.forEach(a=>{let l=`${xe}${a}`,u=o[l];u!==void 0&&(typeof u=="boolean"?(delete o[l],r=!0):u&&typeof u=="object"&&u[i]===!0&&(u[i]=!1,o[l]=u,r=!0))}),r&&await h(e,t,o)}var He="config.json";async function v(e,t,n){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";if(i.getAttribute("data-asri-palette")===t.name)return;let a=await m(e,He)||{},l=a[t.configKey]||{light:!1,dark:!1},u=()=>{i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",t.name),l[o]=!0;for(let b of t.otherConfigKeys)if(a[b]){let p=a[b];typeof p=="object"&&(p[o]=!1,a[b]=p)}a[t.configKey]=l};document.startViewTransition?await document.startViewTransition(()=>{u()}).finished.catch(()=>{}):u(),await h(e,He,a).catch(()=>{})}async function y(e,t,n){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light",r=n!==void 0?n:await m(e,He);if(r&&r[t.configKey]){let a=r[t.configKey];(typeof a=="boolean"?a:a[o]===!0)?(i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",t.name)):i.getAttribute("data-asri-palette")===t.name&&i.removeAttribute("data-asri-palette")}}var pt={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-sakura","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function bt(e,t){return v(e,pt,t)}async function gt(e,t){return y(e,pt,t)}var vt={name:"sakura",configKey:"asri-enhance-sakura",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function yt(e,t){return v(e,vt,t)}async function Et(e,t){return y(e,vt,t)}var Ct={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Tt(e,t){return v(e,Ct,t)}async function Pt(e,t){return y(e,Ct,t)}var Lt={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function _t(e,t){return v(e,Lt,t)}async function wt(e,t){return y(e,Lt,t)}var Mt={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function kt(e,t){return v(e,Mt,t)}async function xt(e,t){return y(e,Mt,t)}var At={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Ht(e,t){return v(e,At,t)}async function It(e,t){return y(e,At,t)}var St={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Dt(e,t){return v(e,St,t)}async function Nt(e,t){return y(e,St,t)}var Ot={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Ft(e,t){return v(e,Ot,t)}async function Rt(e,t){return y(e,Ot,t)}var Bt={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-gruvbox","asri-enhance-glitch"]};async function qt(e,t){return v(e,Bt,t)}async function $t(e,t){return y(e,Bt,t)}var Kt={name:"gruvbox",configKey:"asri-enhance-gruvbox",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-glitch"]};async function zt(e,t){return v(e,Kt,t)}async function Gt(e,t){return y(e,Kt,t)}var jt={name:"glitch",configKey:"asri-enhance-glitch",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Ut(e,t){return v(e,jt,t)}async function Wt(e,t){return y(e,jt,t)}var Ie="config.json",Se="asri-enhance-coloredheading";async function Vt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredheading"),o=await m(e,Ie)||{};i?(n.removeAttribute("data-asri-enhance-coloredheading"),o[Se]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),o[Se]=!0),await h(e,Ie,o).catch(()=>{})}async function Yt(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,Ie);i&&i[Se]===!0?n.setAttribute("data-asri-enhance-coloredheading","true"):n.removeAttribute("data-asri-enhance-coloredheading")}var De="config.json",Ne="asri-enhance-headinglevelhint",ge="data-asri-enhance-headinglevelhint";async function Xt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute(ge),o=await m(e,De)||{};i?(n.removeAttribute(ge),o[Ne]=!1):(n.setAttribute(ge,"true"),o[Ne]=!0),await h(e,De,o).catch(()=>{})}async function Zt(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,De);i&&i[Ne]===!0?n.setAttribute(ge,"true"):n.removeAttribute(ge)}var Oe="config.json",Fe="asri-enhance-colored-tree";async function Jt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-colored-tree"),o=await m(e,Oe)||{};i?(n.removeAttribute("data-asri-enhance-colored-tree"),o[Fe]=!1):(n.setAttribute("data-asri-enhance-colored-tree","true"),o[Fe]=!0),await h(e,Oe,o).catch(()=>{})}async function Qt(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,Oe);i&&i[Fe]===!0?n.setAttribute("data-asri-enhance-colored-tree","true"):n.removeAttribute("data-asri-enhance-colored-tree")}var Re="config.json",Be="asri-enhance-typewriter",ve=null,qe=!1,Pe=!1,k=null,K=!1,Fn=500;function Rn(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,i;if(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n.nodeType===Node.ELEMENT_NODE?n:null,i){let o=i;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return i;o=o.parentElement}}return null}function Bn(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,i=window.innerWidth,o=t.top+t.height/2,r=t.left+t.width/2,a=n/2,l=i/2,u=Math.abs(o-a),b=Math.abs(r-l);return u>5||b>5}function qn(e){e&&Bn(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function $n(){let e=null,t=()=>{if(!qe||Pe||K)return;let r=Rn();r!==e&&(e=r,r&&setTimeout(()=>{qn(r)},50))},n=()=>{Pe=!0,K=!1,k=window.setTimeout(()=>{K=!0},Fn)},i=()=>{Pe=!1,k&&(clearTimeout(k),k=null),K?setTimeout(()=>{K=!1},200):setTimeout(t,10)},o=()=>{Pe=!1,K=!1,k&&(clearTimeout(k),k=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",o),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",o),k&&(clearTimeout(k),k=null)}}}function en(){ve&&ye(),qe=!0,ve=$n()}function ye(){qe=!1,ve&&(ve.destroy(),ve=null)}async function tn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-typewriter"),o=await m(e,Re)||{};i?(n.removeAttribute("data-asri-enhance-typewriter"),o[Be]=!1,ye()):(n.setAttribute("data-asri-enhance-typewriter","true"),o[Be]=!0,en()),await h(e,Re,o).catch(()=>{})}async function nn(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,Re);i&&i[Be]===!0?(n.setAttribute("data-asri-enhance-typewriter","true"),en()):(n.removeAttribute("data-asri-enhance-typewriter"),ye())}var $e="config.json",Ke="asri-enhance-listbulletline",Kn=".asri-bullet-highlight,.asri-bullet-line",ze="asri-bullet-highlight",O="asri-bullet-line",z="--asri-bullet-line-height",G=null,F=null,Le=new Set,on=()=>{document.querySelectorAll(Kn).forEach(e=>{e.classList.remove(ze,O),e.style.removeProperty(z)}),Le.clear()},zn=e=>{e.classList.remove(ze,O),e.style.removeProperty(z)},Gn=(e,t,n)=>{if(e.classList.add(ze),t&&n){let i=e.getBoundingClientRect(),o=n.getBoundingClientRect();e.style.setProperty(z,`${i.top-o.top}px`),e.classList.add(O)}},rn=()=>{var i,o;let e=window.getSelection(),t=[];if(e&&e.rangeCount){let r=e.getRangeAt(0).startContainer;for(;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.parentElement;for(;r;){let a=r;if(((i=a.dataset)==null?void 0:i.type)==="NodeListItem"&&t.push(a),(o=a.classList)!=null&&o.contains("protyle-wysiwyg"))break;r=a.parentElement}}let n=new Set(t);Le.forEach(r=>{n.has(r)||zn(r)}),t.forEach((r,a)=>{let l=a<t.length-1,u=l?t[a+1]:void 0;if(!Le.has(r))Gn(r,l,u);else if(l&&u){let b=r.getBoundingClientRect(),p=u.getBoundingClientRect(),E=`${b.top-p.top}px`;r.style.getPropertyValue(z)!==E&&r.style.setProperty(z,E),r.classList.contains(O)||r.classList.add(O)}else r.classList.contains(O)&&(r.classList.remove(O),r.style.removeProperty(z))}),Le=n},an=()=>{G||(G=()=>{F&&clearTimeout(F),F=setTimeout(()=>{rn(),F=null},50)},document.addEventListener("selectionchange",G),rn())},Ge=()=>{if(!G){on();return}F&&(clearTimeout(F),F=null),document.removeEventListener("selectionchange",G),G=null,on()};async function sn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-listbulletline"),o=await m(e,$e)||{};i?(n.removeAttribute("data-asri-enhance-listbulletline"),o[Ke]=!1,Ge()):(n.setAttribute("data-asri-enhance-listbulletline","true"),o[Ke]=!0,an()),await h(e,$e,o).catch(()=>{})}async function ln(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,$e);i&&i[Ke]===!0?(n.setAttribute("data-asri-enhance-listbulletline","true"),an()):(n.removeAttribute("data-asri-enhance-listbulletline"),Ge())}var cn=()=>{Ge()};var je="config.json",Ue="asri-enhance-vertical-tab",we=150,H=null,I=null,R=null,Ee=!1,un=0,mn=0,fn=null,S=null,D=null,Ce=!1,x=null,A=null,_e=null,Ve=null,j=null,B=null;function jn(e=10,t=100){return new Promise(n=>{let i=0,o=()=>{let r=document.querySelector(".layout__center");if(r){n(r);return}if(i++,i>=e){n(null);return}setTimeout(o,t)};o()})}function Un(e=10,t=100){return new Promise(n=>{let i=0,o=()=>{let r=document.querySelector(".layout__center");if(r){let a=r.nextElementSibling;if(a&&a.classList.contains("layout__resize")){n({center:r,resize:a});return}}if(i++,i>=e){n(null);return}setTimeout(o,t)};o()})}function Wn(e=10,t=100){return new Promise(n=>{let i=0,o=()=>{let r=document.querySelector("#toolbar");if(r){n(r);return}if(i++,i>=e){n(null);return}setTimeout(o,t)};o()})}function Vn(){let e=document.documentElement,t=getComputedStyle(e).getPropertyValue("--asri-enhance-vertical-tab-width");if(t){let n=parseFloat(t);return isNaN(n)?we:n}return we}function Me(e){document.documentElement.style.setProperty("--asri-enhance-vertical-tab-width",`${e}px`)}function Yn(){Me(we)}function Xn(){x!==null&&(cancelAnimationFrame(x),x=null),A=null,S&&(document.removeEventListener("mousemove",S),S=null),D&&(document.removeEventListener("mouseup",D),D=null)}function Zn(e){let t=r=>{r.preventDefault(),r.stopPropagation(),Ee=!0,un=r.clientX,mn=Vn(),document.body.style.userSelect="none",document.body.style.cursor="col-resize",S=a=>{if(!Ee)return;a.preventDefault();let l=a.clientX-un;A=Math.max(100,Math.min(300,mn+l)),x!==null&&cancelAnimationFrame(x),x=requestAnimationFrame(()=>{A!==null&&(Me(A),A=null),x=null})},D=()=>{Ee&&(Ee=!1,document.body.style.userSelect="",document.body.style.cursor="",x!==null&&(cancelAnimationFrame(x),x=null),A!==null&&(Me(A),A=null),S&&(document.removeEventListener("mousemove",S),S=null),D&&(document.removeEventListener("mouseup",D),D=null))},document.addEventListener("mousemove",S),document.addEventListener("mouseup",D)},n=r=>{r.preventDefault(),r.stopPropagation(),Yn()},i=e.__asriMousedownHandler,o=e.__asriDblclickHandler;i&&e.removeEventListener("mousedown",i),o&&e.removeEventListener("dblclick",o),e.__asriMousedownHandler=t,e.__asriDblclickHandler=n,e.addEventListener("mousedown",t),e.addEventListener("dblclick",n)}function dn(e){if(Ce)return;let t=e.querySelectorAll('[data-type="wnd"]');if(t.length===0)return;let n=null,i=1/0,o=1/0;if(t.forEach(r=>{let a=r.getBoundingClientRect(),l=a.top,u=a.left;(l<i||l===i&&u<o)&&(i=l,o=u,n=r)}),Ce=!0,t.forEach(r=>{if(r!==n){r.classList.remove("asri-enhance-verticaltab"),r.classList.remove("asri-enhance-verticaltab-toponly"),r.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing");let a=r.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");a&&a.remove()}}),n){!n.classList.contains("asri-enhance-verticaltab")&&n.classList.add("asri-enhance-verticaltab"),Ve=n;let l=n.getBoundingClientRect().top,u=1,b=!1;t.forEach(E=>{if(E!==n){let d=E.getBoundingClientRect();Math.abs(d.top-l)<=u&&(b=!0)}}),b?n.classList.remove("asri-enhance-verticaltab-toponly"):n.classList.add("asri-enhance-verticaltab-toponly");let p=Array.from(n.children).find(E=>E.classList.contains("fn__flex"));if(p&&p.parentElement){let E=p.parentElement.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");E||(E=document.createElement("div"),E.className="layout__resize layout__resize--lr asri-enhance-verticaltab-resize",p.parentElement.insertBefore(E,p.nextSibling)),Zn(E)}We(n)}Ce=!1}function Jn(){let e=j!=null?j:document.querySelector("#toolbar");if(!e)return 0;j=e;let t=getComputedStyle(e).getPropertyValue("--topbar-right-spacing");if(!t)return 0;let n=parseFloat(t);return isNaN(n)?0:n}function We(e){let t=e!=null?e:Ve;if(!t)return;Jn()>0?t.classList.add("asri-enhance-verticaltab-dockr-expand-spacing"):t.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing")}async function Qn(){hn();let e=await Wn();if(!e)return;j=e;let t=new MutationObserver(n=>{for(let i of n)if(i.type==="attributes"&&i.attributeName==="style"){B!==null&&clearTimeout(B),B=window.setTimeout(()=>{We(),B=null},500);break}});t.observe(e,{attributes:!0,attributeFilter:["style"]}),_e=t,We()}function hn(){_e&&(_e.disconnect(),_e=null),B!==null&&(clearTimeout(B),B=null),j=null}async function ei(){I&&(I.disconnect(),I=null);let e=await Un();if(!e)return;let{center:t,resize:n}=e,i=()=>{n.classList.contains("fn__none")?t.classList.add("asri-enhance-dockr-fold"):t.classList.remove("asri-enhance-dockr-fold")};i(),I=new MutationObserver(o=>{for(let r of o)if(r.type==="attributes"&&r.attributeName==="class"){i();break}}),I.observe(n,{attributes:!0,attributeFilter:["class"]})}function ti(){I&&(I.disconnect(),I=null);let e=document.querySelector(".layout__center");e&&e.classList.remove("asri-enhance-dockr-fold")}async function pn(){H&&(H.disconnect(),H=null);let e=await jn();if(!e)return;Me(we),dn(e),ei().catch(()=>{}),Qn();let t=()=>{Ce||(R!==null&&clearTimeout(R),R=window.setTimeout(()=>{dn(e),R=null},500))};H=new MutationObserver(()=>{t()}),H.observe(e,{childList:!0,subtree:!0})}function ke(){H&&(H.disconnect(),H=null),ti(),hn(),R!==null&&(clearTimeout(R),R=null),Xn(),document.querySelectorAll('[data-type="wnd"]').forEach(n=>{n.classList.remove("asri-enhance-verticaltab"),n.classList.remove("asri-enhance-verticaltab-toponly"),n.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing");let i=n.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");if(i){let o=i.__asriMousedownHandler,r=i.__asriDblclickHandler;o&&(i.removeEventListener("mousedown",o),delete i.__asriMousedownHandler),r&&(i.removeEventListener("dblclick",r),delete i.__asriDblclickHandler),i.remove()}});let t=document.documentElement;t&&t.style.removeProperty("--asri-enhance-vertical-tab-width"),Ce=!1,Ee=!1,Ve=null}async function bn(e,t){t&&(t.preventDefault(),t.stopPropagation()),fn=e;let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-vertical-tab"),o=await m(e,je)||{};i?(n.removeAttribute("data-asri-enhance-vertical-tab"),o[Ue]=!1,ke()):(n.setAttribute("data-asri-enhance-vertical-tab","true"),o[Ue]=!0,pn().catch(()=>{})),await h(e,je,o).catch(()=>{})}async function gn(e,t){fn=e;let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,je);i&&i[Ue]===!0?(n.setAttribute("data-asri-enhance-vertical-tab","true"),pn().catch(()=>{})):(n.removeAttribute("data-asri-enhance-vertical-tab"),ke())}var Ye="config.json",Xe="asri-enhance-sidebar-top-sticky";async function vn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-sidebar-top-sticky"),o=await m(e,Ye)||{};i?(n.removeAttribute("data-asri-enhance-sidebar-top-sticky"),o[Xe]=!1):(n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"),o[Xe]=!0),await h(e,Ye,o).catch(()=>{})}async function yn(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,Ye);i&&i[Xe]===!0?n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"):n.removeAttribute("data-asri-enhance-sidebar-top-sticky")}var Ze="config.json",Je="asri-enhance-cover-image-fade";async function En(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-cover-image-fade"),o=await m(e,Ze)||{};i?(n.removeAttribute("data-asri-enhance-cover-image-fade"),o[Je]=!1):(n.setAttribute("data-asri-enhance-cover-image-fade","true"),o[Je]=!0),await h(e,Ze,o).catch(()=>{})}async function Cn(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,Ze);i&&i[Je]===!0?n.setAttribute("data-asri-enhance-cover-image-fade","true"):n.removeAttribute("data-asri-enhance-cover-image-fade")}var Qe="config.json",et="asri-enhance-hide-tab-breadcrumb";async function Tn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-hide-tab-breadcrumb"),o=await m(e,Qe)||{};i?(n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb"),o[et]=!1):(n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"),o[et]=!0),await h(e,Qe,o).catch(()=>{})}async function Pn(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,Qe);i&&i[et]===!0?n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"):n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb")}var tt="config.json",nt="asri-enhance-paper-texture",Te="data-asri-enhance-paper-texture";async function Ln(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute(Te),o=await m(e,tt)||{};i?(n.removeAttribute(Te),o[nt]=!1):(n.setAttribute(Te,"true"),o[nt]=!0),await h(e,tt,o).catch(()=>{})}async function _n(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,tt);i&&i[nt]===!0?n.setAttribute(Te,"true"):n.removeAttribute(Te)}var it="config.json",ot="asri-enhance-moreanimations";async function wn(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-moreanimations"),o=await m(e,it)||{};i?(n.removeAttribute("data-asri-enhance-moreanimations"),o[ot]=!1):(n.setAttribute("data-asri-enhance-moreanimations","true"),o[ot]=!0),await h(e,it,o).catch(()=>{})}async function Mn(e,t){let n=document.documentElement;if(!n)return;let i=t!==void 0?t:await m(e,it);i&&i[ot]===!0?n.setAttribute("data-asri-enhance-moreanimations","true"):n.removeAttribute("data-asri-enhance-moreanimations")}var _='<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg>',L='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>';function kn(e,t,n=100){let i,o,r=null,a=0,l=new Set,u=10,b=100,p=()=>{l.forEach(C=>window.clearTimeout(C)),l.clear()},E=(C,P)=>{let w=window.setTimeout(()=>{l.delete(w),C()},P);return l.add(w),w},d=C=>{i!==void 0&&window.clearTimeout(i),i=window.setTimeout(()=>{p();let P=(w=0)=>{var Y,X,Z,J,Q,ee,te,ne,ie,oe,re,ae;let $=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if($){let g=$.parentElement;if(g){if(!g.querySelector("#asri-enhance-palette")){let f=document.createElement("button");f.className="b3-menu__item asri-enhance",f.id="asri-enhance-palette",f.innerHTML=`${_}<span class="b3-menu__label">${((Y=e.i18n)==null?void 0:Y.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-sakura">${_}<span class="b3-menu__label">${((X=e.i18n)==null?void 0:X.sakura)||"Sakura"}</span></button><button class="b3-menu__item" id="asri-enhance-amber">${_}<span class="b3-menu__label">${((Z=e.i18n)==null?void 0:Z.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness">${_}<span class="b3-menu__label">${((J=e.i18n)==null?void 0:J.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight">${_}<span class="b3-menu__label">${((Q=e.i18n)==null?void 0:Q.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt">${_}<span class="b3-menu__label">${((ee=e.i18n)==null?void 0:ee.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine">${_}<span class="b3-menu__label">${((te=e.i18n)==null?void 0:te.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz">${_}<span class="b3-menu__label">${((ne=e.i18n)==null?void 0:ne.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen">${_}<span class="b3-menu__label">${((ie=e.i18n)==null?void 0:ie.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade">${_}<span class="b3-menu__label">${((oe=e.i18n)==null?void 0:oe.shade)||"Shade"}</span></button><button class="b3-menu__item" id="asri-enhance-gruvbox">${_}<span class="b3-menu__label">${((re=e.i18n)==null?void 0:re.gruvbox)||"Gruvbox"}</span></button><button class="b3-menu__item" id="asri-enhance-glitch">${_}<span class="b3-menu__label">${((ae=e.i18n)==null?void 0:ae.glitch)||"glitch"}</span></button></div></div>`,g.insertBefore(f,$)}let se=g.querySelector("#asri-enhance-amber");se&&(se.onclick=f=>bt(e,f));let le=g.querySelector("#asri-enhance-sakura");le&&(le.onclick=f=>yt(e,f));let ce=g.querySelector("#asri-enhance-wilderness");ce&&(ce.onclick=f=>Tt(e,f));let ue=g.querySelector("#asri-enhance-midnight");ue&&(ue.onclick=f=>_t(e,f));let s=g.querySelector("#asri-enhance-salt");s&&(s.onclick=f=>kt(e,f));let me=g.querySelector("#asri-enhance-rosepine");me&&(me.onclick=f=>Ht(e,f));let de=g.querySelector("#asri-enhance-topaz");de&&(de.onclick=f=>Dt(e,f));let fe=g.querySelector("#asri-enhance-oxygen");fe&&(fe.onclick=f=>Ft(e,f));let he=g.querySelector("#asri-enhance-shade");he&&(he.onclick=f=>qt(e,f));let pe=g.querySelector("#asri-enhance-gruvbox");pe&&(pe.onclick=f=>zt(e,f));let be=g.querySelector("#asri-enhance-glitch");be&&(be.onclick=f=>Ut(e,f))}t(C);return}w+1<u?E(()=>P(w+1),b):t(C)};P(),i=void 0},n)},T=()=>{let C=document.querySelector("#barMode");if(C){r=C,C.addEventListener("click",d,!0),o=void 0;return}a+=1,a<u?o=window.setTimeout(T,b):o=void 0};return T(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),p(),r&&(r.removeEventListener("click",d,!0),r=null),i!==void 0&&(window.clearTimeout(i),i=void 0)}}function xn(e,t=100){let n,i,o=null,r=0,a=new Set,l=10,u=100,b=()=>{a.forEach(T=>window.clearTimeout(T)),a.clear()},p=(T,C)=>{let P=window.setTimeout(()=>{a.delete(P),T()},C);return a.add(P),P},E=T=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{b();let C=(P=0)=>{var $,Y,X,Z,J,Q,ee,te,ne,ie,oe,re,ae;let w=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(w){let g=w.parentElement;if(g){if(!g.querySelector("#asri-enhance-more")){let s=document.createElement("button");s.className="b3-menu__item asri-enhance",s.id="asri-enhance-more",s.innerHTML=`${L}<span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-detail-adjustment">${L}<span class="b3-menu__label">${((Y=e.i18n)==null?void 0:Y.detailAdjustment)||"detailAdjustment"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"></div></div></button><button class="b3-menu__item" id="asri-enhance-typewriter">${L}<span class="b3-menu__label">${((X=e.i18n)==null?void 0:X.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line">${L}<span class="b3-menu__label">${((Z=e.i18n)==null?void 0:Z.listBulletLine)||"listBulletLine"}</span></button><button class="b3-menu__item" id="asri-enhance-vertical-tab">${L}<span class="b3-menu__label">${((J=e.i18n)==null?void 0:J.verticalTab)||"verticalTab"}</span></button></div></div>`,w.nextSibling?g.insertBefore(s,w.nextSibling):g.appendChild(s)}let se=g.querySelector("#asri-enhance-typewriter");se&&(se.onclick=s=>tn(e,s));let le=g.querySelector("#asri-enhance-list-bullet-line");le&&(le.onclick=s=>sn(e,s));let ce=g.querySelector("#asri-enhance-vertical-tab");ce&&(ce.onclick=s=>bn(e,s));let ue=g.querySelector("#asri-enhance-detail-adjustment");if(ue){let s=ue.querySelector(".b3-menu__submenu .b3-menu__items");if(s&&!s.querySelector("#asri-enhance-sidebar-top-sticky")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-sidebar-top-sticky",c.innerHTML=`${L}<span class="b3-menu__label">${((Q=e.i18n)==null?void 0:Q.sidebarTopSticky)||"sidebarTopSticky"}</span>`,s.appendChild(c)}let me=s==null?void 0:s.querySelector("#asri-enhance-sidebar-top-sticky");if(me&&(me.onclick=c=>vn(e,c)),s&&!s.querySelector("#asri-enhance-cover-image-fade")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-cover-image-fade",c.innerHTML=`${L}<span class="b3-menu__label">${((ee=e.i18n)==null?void 0:ee.coverImageFade)||"coverImageFade"}</span>`,s.appendChild(c)}let de=s==null?void 0:s.querySelector("#asri-enhance-cover-image-fade");if(de&&(de.onclick=c=>En(e,c)),s&&!s.querySelector("#asri-enhance-paper-texture")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-paper-texture",c.innerHTML=`${L}<span class="b3-menu__label">${((te=e.i18n)==null?void 0:te.paperTexture)||"paperTexture"}</span>`,s.appendChild(c)}let fe=s==null?void 0:s.querySelector("#asri-enhance-paper-texture");if(fe&&(fe.onclick=c=>Ln(e,c)),s&&!s.querySelector("#asri-enhance-colored-heading")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-colored-heading",c.innerHTML=`${L}<span class="b3-menu__label">${((ne=e.i18n)==null?void 0:ne.coloredHeading)||"coloredHeading"}</span>`,s.appendChild(c)}let he=s==null?void 0:s.querySelector("#asri-enhance-colored-heading");if(he&&(he.onclick=c=>Vt(e,c)),s&&!s.querySelector("#asri-enhance-heading-level-hint")){let c=document.createElement("button");if(c.className="b3-menu__item",c.id="asri-enhance-heading-level-hint",c.innerHTML=`${L}<span class="b3-menu__label">${((ie=e.i18n)==null?void 0:ie.headingLevelHint)||"headingLevelHint"}</span>`,s.querySelector("#asri-enhance-colored-tree")){let On=s.querySelector("#asri-enhance-colored-tree");s.insertBefore(c,On)}else s.appendChild(c)}let pe=s==null?void 0:s.querySelector("#asri-enhance-heading-level-hint");if(pe&&(pe.onclick=c=>Xt(e,c)),s&&!s.querySelector("#asri-enhance-colored-tree")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-colored-tree",c.innerHTML=`${L}<span class="b3-menu__label">${((oe=e.i18n)==null?void 0:oe.coloredTree)||"coloredTree"}</span>`,s.appendChild(c)}let be=s==null?void 0:s.querySelector("#asri-enhance-colored-tree");if(be&&(be.onclick=c=>Jt(e,c)),s&&!s.querySelector("#asri-enhance-hide-tab-breadcrumb")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-hide-tab-breadcrumb",c.innerHTML=`${L}<span class="b3-menu__label">${((re=e.i18n)==null?void 0:re.hideTabBreadcrumb)||"hideTabBreadcrumb"}</span>`,s.appendChild(c)}let f=s==null?void 0:s.querySelector("#asri-enhance-hide-tab-breadcrumb");if(f&&(f.onclick=c=>Tn(e,c)),s&&!s.querySelector("#asri-enhance-moreanimations")){let c=document.createElement("button");c.className="b3-menu__item",c.id="asri-enhance-moreanimations",c.innerHTML=`${L}<span class="b3-menu__label">${((ae=e.i18n)==null?void 0:ae.moreAnimations)||"moreAnimations"}</span>`,s.appendChild(c)}let mt=s==null?void 0:s.querySelector("#asri-enhance-moreanimations");mt&&(mt.onclick=c=>wn(e,c))}}return}P+1<l&&p(()=>C(P+1),u)};C(),n=void 0},t)},d=()=>{let T=document.querySelector("#barMode");if(T){o=T,T.addEventListener("click",E,!0),i=void 0;return}r+=1,r<l?i=window.setTimeout(d,u):i=void 0};return d(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),b(),o&&(o.removeEventListener("click",E,!0),o=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var at=!1,N=null,rt=0,M=null,U=null,W=null,V=null;function st(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function q(){if(at=!1,M=null,N!==null&&(clearInterval(N),N=null),U){try{U.disconnect()}catch(e){}U=null}if(W){try{W.disconnect()}catch(e){}W=null}}function lt(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function ct(){if(M){if(!U){U=new MutationObserver(()=>{lt(M)||q()});try{U.observe(M,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!W){W=new MutationObserver(()=>{lt(M)||q()});try{W.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function ni(){let e=st();return e?(M=e,ct(),!0):(rt=0,N=setInterval(()=>{rt+=1;let t=st();t?(M=t,clearInterval(N),N=null,ct()):rt>=10&&(clearInterval(N),N=null,q())},100),!1)}function ii(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function In(e){return e?e.querySelector(".b3-list-item--focus"):null}function oi(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function ri(e,t,n){if(!t||e.length===0)return null;let i=t.getBoundingClientRect(),o={x:i.left+i.width/2,y:i.top+i.height/2,el:t},r=oi(e),a=Math.max(i.width/2,10),l;switch(n){case"ArrowUp":l=d=>d.y<o.y-1&&Math.abs(d.x-o.x)<=a;break;case"ArrowDown":l=d=>d.y>o.y+1&&Math.abs(d.x-o.x)<=a;break;case"ArrowLeft":l=d=>d.x<o.x-1;break;case"ArrowRight":l=d=>d.x>o.x+1;break;default:return null}let u=r.filter(d=>d.el!==t&&l(d));if(u.length===0)return null;let b=(d,T)=>{let C=d.x-T.x,P=d.y-T.y;return C*C+P*P},p=u[0],E=b(p,o);for(let d=1;d<u.length;d++){let T=b(u[d],o);T<E&&(p=u[d],E=T)}return p.el}function An(e){if(!M||!e)return;let t=In(M);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function ai(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[0])!=null?i:null:n+1<e.length?e[n+1]:(o=e[0])!=null?o:null}function si(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[e.length-1])!=null?i:null:n-1>=0?e[n-1]:(o=e[e.length-1])!=null?o:null}function Hn(e,t){let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=[];for(let r of e){if(r===t)continue;let a=r.getBoundingClientRect(),l=a.top+a.height/2,u=Math.min(n.height,a.height)/2;Math.abs(l-i)<=u&&o.push(r)}return o}function li(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function ci(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var ui=e=>{var u,b;if(e.key==="/"){q(),at=!0,ni();return}if(!at)return;if(e.key==="Escape"){q();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=M||st();if(!n||!lt(n)){q();return}e.preventDefault(),e.stopPropagation(),M=n,ct();let i=ii(n);if(i.length===0)return;let o=In(n);o||(o=i[0],o.classList.add("b3-list-item--focus"));let r=ri(i,o,e.key);if(r){An(r);return}let a=null,l=e.key;if(l==="ArrowDown")a=ai(i,o);else if(l==="ArrowUp")a=si(i,o);else if(l==="ArrowRight"){let p=Hn(i,o);p.length>0&&(a=(u=li(p)[0])!=null?u:null)}else if(l==="ArrowLeft"){let p=Hn(i,o);p.length>0&&(a=(b=ci(p)[0])!=null?b:null)}a&&a!==o&&An(a)};function Sn(){typeof document!="undefined"&&(V||(V=ui,document.addEventListener("keydown",V,{capture:!0})))}function Dn(){typeof document!="undefined"&&(V&&(document.removeEventListener("keydown",V,{capture:!0}),V=null),q())}var ut=class extends Nn.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null;this.themeModeChangeTimers=[];this.paletteDisableMouseUpHandler=null;this.paletteDisableDebounceTimer=null}async applyAllConfigs(n){await Promise.all([gt(this,n).catch(()=>{}),Et(this,n).catch(()=>{}),Pt(this,n).catch(()=>{}),wt(this,n).catch(()=>{}),xt(this,n).catch(()=>{}),It(this,n).catch(()=>{}),Nt(this,n).catch(()=>{}),Rt(this,n).catch(()=>{}),$t(this,n).catch(()=>{}),Gt(this,n).catch(()=>{}),Wt(this,n).catch(()=>{}),Yt(this,n).catch(()=>{}),Qt(this,n).catch(()=>{}),Zt(this,n).catch(()=>{}),nn(this,n).catch(()=>{}),ln(this,n).catch(()=>{}),gn(this,n).catch(()=>{}),yn(this,n).catch(()=>{}),Cn(this,n).catch(()=>{}),Pn(this,n).catch(()=>{}),_n(this,n).catch(()=>{}),Mn(this,n).catch(()=>{})])}async onload(){this.unsubscribeBarModeClick=kn(this,()=>{}),this.unsubscribeTopbarFusionPlus=xn(this),this.asriConfigClickHandler=o=>{queueMicrotask(()=>{let r=o.target;if(!r||r.closest("#asri-enhance-amber")||r.closest("#asri-enhance-sakura")||r.closest("#asri-enhance-wilderness")||r.closest("#asri-enhance-midnight")||r.closest("#asri-enhance-salt")||r.closest("#asri-enhance-rosepine")||r.closest("#asri-enhance-topaz")||r.closest("#asri-enhance-oxygen")||r.closest("#asri-enhance-shade")||r.closest("#asri-enhance-gruvbox")||r.closest("#asri-enhance-glitch"))return;let a=r.closest(".asri-config");a&&a.id!=="topbarFusionPlus"&&Ae.forEach(l=>{dt(this,l,"config.json").catch(()=>{})})})},document.addEventListener("click",this.asriConfigClickHandler,!0),this.paletteDisableMouseUpHandler=o=>{queueMicrotask(()=>{var l;let r=o.target;if(!r)return;(((l=r.id)==null?void 0:l.startsWith("prst-palette"))||r.closest("[id^='prst-palette']")!==null||r.id==="pickColor"||r.closest("#pickColor")!==null||r.id==="followSysAccent"||r.closest("#followSysAccent")!==null||r.id==="followCoverImgColor"||r.closest("#followCoverImgColor")!==null)&&(this.paletteDisableDebounceTimer!==null&&clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=window.setTimeout(()=>{ht(this,"config.json").then(()=>{m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{})}).catch(()=>{}),this.paletteDisableDebounceTimer=null},200))})},document.addEventListener("mouseup",this.paletteDisableMouseUpHandler,!1);let n=await m(this,"config.json"),i=document.documentElement;i&&(this.themeModeObserver=new MutationObserver(o=>{queueMicrotask(()=>{for(let r of o)if(r.type==="attributes"&&r.attributeName==="data-theme-mode"){this.themeModeChangeTimers.forEach(u=>{clearTimeout(u)}),this.themeModeChangeTimers=[],m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{});let a=window.setTimeout(()=>{m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{})},100);this.themeModeChangeTimers.push(a);let l=window.setTimeout(()=>{m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{})},500);this.themeModeChangeTimers.push(l)}})}),this.themeModeObserver.observe(i,{attributes:!0,attributeFilter:["data-theme-mode"]})),await this.applyAllConfigs(n),Sn(),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},100),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),this.themeModeChangeTimers.forEach(n=>{clearTimeout(n)}),this.themeModeChangeTimers=[],this.paletteDisableMouseUpHandler&&(document.removeEventListener("mouseup",this.paletteDisableMouseUpHandler,!0),this.paletteDisableMouseUpHandler=null),this.paletteDisableDebounceTimer!==null&&(clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=null),cn(),ye(),Dn(),ke()}async uninstall(){this.onunload(),await ft(this,"config.json").catch(()=>{})}};module.exports=ut;
