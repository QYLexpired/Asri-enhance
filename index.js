var Ur=Object.defineProperty;var jr=(t,e,n)=>e in t?Ur(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var C=(t,e,n)=>jr(t,typeof e!="symbol"?e+"":e,n);var Gr=require("siyuan");var Je="asri-enhance-",et=["amber","sakura","wilderness","midnight","salt","rosepine","topaz","oxygen","shade","gruvbox","glitch"];async function _(t,e,n){if(!t.saveData)throw new Error("Plugin saveData method is not available");try{await t.saveData(e,n)}catch(i){throw i}}async function k(t,e){if(!t.loadData)return null;try{return await t.loadData(e)||null}catch(n){return null}}async function Qt(t,e,n="config.json"){let i=document.documentElement;if(!i)return;let r=i.getAttribute("data-theme-mode")||"light";i.getAttribute("data-asri-palette")===e&&i.removeAttribute("data-asri-palette");let s=await k(t,n);if(!s)return;let o=`${Je}${e}`,a=s[o];a!==void 0&&(typeof a=="boolean"?delete s[o]:a&&typeof a=="object"&&(a[r]=!1,s[o]=a),await _(t,n,s))}async function Jt(t,e="config.json"){let n=await k(t,e);if(!n)return;let i=!1;Object.keys(n).forEach(r=>{r.startsWith(Je)&&(delete n[r],i=!0)}),i&&await _(t,e,n)}async function en(t,e="config.json"){let n=document.documentElement;if(!n)return;let i=n.getAttribute("data-theme-mode")||"light",r=await k(t,e);if(!r)return;let s=!1;et.forEach(o=>{let a=`${Je}${o}`,l=r[a];l!==void 0&&(typeof l=="boolean"?(delete r[a],s=!0):l&&typeof l=="object"&&l[i]===!0&&(l[i]=!1,r[a]=l,s=!0))}),s&&await _(t,e,r)}var tt="config.json";async function H(t,e,n){let i=document.documentElement;if(!i)return;let r=i.getAttribute("data-theme-mode")||"light";if(i.getAttribute("data-asri-palette")===e.name)return;let o=await k(t,tt)||{},a=o[e.configKey]||{light:!1,dark:!1},l=()=>{i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",e.name),a[r]=!0;for(let c of e.otherConfigKeys)if(o[c]){let u=o[c];typeof u=="object"&&(u[r]=!1,o[c]=u)}o[e.configKey]=a};document.startViewTransition?await document.startViewTransition(()=>{l()}).finished.catch(()=>{}):l(),await _(t,tt,o).catch(()=>{})}async function R(t,e,n){let i=document.documentElement;if(!i)return;let r=i.getAttribute("data-theme-mode")||"light",s=n!==void 0?n:await k(t,tt);if(s&&s[e.configKey]){let o=s[e.configKey];(typeof o=="boolean"?o:o[r]===!0)?(i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",e.name)):i.getAttribute("data-asri-palette")===e.name&&i.removeAttribute("data-asri-palette")}}var tn={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-sakura","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function nn(t,e){return H(t,tn,e)}async function rn(t,e){return R(t,tn,e)}var sn={name:"sakura",configKey:"asri-enhance-sakura",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function an(t,e){return H(t,sn,e)}async function on(t,e){return R(t,sn,e)}var ln={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function cn(t,e){return H(t,ln,e)}async function un(t,e){return R(t,ln,e)}var hn={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function mn(t,e){return H(t,hn,e)}async function dn(t,e){return R(t,hn,e)}var pn={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function fn(t,e){return H(t,pn,e)}async function gn(t,e){return R(t,pn,e)}var bn={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function yn(t,e){return H(t,bn,e)}async function kn(t,e){return R(t,bn,e)}var vn={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function xn(t,e){return H(t,vn,e)}async function wn(t,e){return R(t,vn,e)}var En={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Tn(t,e){return H(t,En,e)}async function _n(t,e){return R(t,En,e)}var Cn={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-gruvbox","asri-enhance-glitch"]};async function Ln(t,e){return H(t,Cn,e)}async function Pn(t,e){return R(t,Cn,e)}var Mn={name:"gruvbox",configKey:"asri-enhance-gruvbox",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-glitch"]};async function Sn(t,e){return H(t,Mn,e)}async function An(t,e){return R(t,Mn,e)}var Hn={name:"glitch",configKey:"asri-enhance-glitch",otherConfigKeys:["asri-enhance-sakura","asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Rn(t,e){return H(t,Hn,e)}async function In(t,e){return R(t,Hn,e)}var nt="config.json",rt="asri-enhance-coloredheading";async function $n(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredheading"),r=await k(t,nt)||{};i?(n.removeAttribute("data-asri-enhance-coloredheading"),r[rt]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),r[rt]=!0),await _(t,nt,r).catch(()=>{})}async function Dn(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,nt);i&&i[rt]===!0?n.setAttribute("data-asri-enhance-coloredheading","true"):n.removeAttribute("data-asri-enhance-coloredheading")}var it="config.json",st="asri-enhance-headinglevelhint",we="data-asri-enhance-headinglevelhint";async function Bn(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute(we),r=await k(t,it)||{};i?(n.removeAttribute(we),r[st]=!1):(n.setAttribute(we,"true"),r[st]=!0),await _(t,it,r).catch(()=>{})}async function zn(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,it);i&&i[st]===!0?n.setAttribute(we,"true"):n.removeAttribute(we)}var at="config.json",ot="asri-enhance-colored-tree";async function Nn(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-colored-tree"),r=await k(t,at)||{};i?(n.removeAttribute("data-asri-enhance-colored-tree"),r[ot]=!1):(n.setAttribute("data-asri-enhance-colored-tree","true"),r[ot]=!0),await _(t,at,r).catch(()=>{})}async function On(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,at);i&&i[ot]===!0?n.setAttribute("data-asri-enhance-colored-tree","true"):n.removeAttribute("data-asri-enhance-colored-tree")}var lt="config.json",ct="asri-enhance-typewriter",Ee=null,ut=!1,Ie=!1,X=null,se=!1,Xr=500;function Wr(){let t=window.getSelection();if(!t||t.rangeCount===0)return null;let n=t.getRangeAt(0).commonAncestorContainer,i;if(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n.nodeType===Node.ELEMENT_NODE?n:null,i){let r=i;for(;r&&r!==document.body;){if(r.hasAttribute&&r.hasAttribute("contenteditable"))return i;r=r.parentElement}}return null}function Zr(t){if(!t)return!1;let e=t.getBoundingClientRect(),n=window.innerHeight,i=window.innerWidth,r=e.top+e.height/2,s=e.left+e.width/2,o=n/2,a=i/2,l=Math.abs(r-o),c=Math.abs(s-a);return l>5||c>5}function Yr(t){t&&Zr(t)&&t.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function Vr(){let t=null,e=()=>{if(!ut||Ie||se)return;let s=Wr();s!==t&&(t=s,s&&setTimeout(()=>{Yr(s)},50))},n=()=>{Ie=!0,se=!1,X=window.setTimeout(()=>{se=!0},Xr)},i=()=>{Ie=!1,X&&(clearTimeout(X),X=null),se?setTimeout(()=>{se=!1},200):setTimeout(e,10)},r=()=>{Ie=!1,se=!1,X&&(clearTimeout(X),X=null)};return document.addEventListener("selectionchange",e),document.addEventListener("keydown",e),document.addEventListener("keyup",e),document.addEventListener("click",e),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",r),{destroy:()=>{document.removeEventListener("selectionchange",e),document.removeEventListener("keydown",e),document.removeEventListener("keyup",e),document.removeEventListener("click",e),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",r),X&&(clearTimeout(X),X=null)}}}function qn(){Ee&&Te(),ut=!0,Ee=Vr()}function Te(){ut=!1,Ee&&(Ee.destroy(),Ee=null)}async function Fn(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-typewriter"),r=await k(t,lt)||{};i?(n.removeAttribute("data-asri-enhance-typewriter"),r[ct]=!1,Te()):(n.setAttribute("data-asri-enhance-typewriter","true"),r[ct]=!0,qn()),await _(t,lt,r).catch(()=>{})}async function Gn(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,lt);i&&i[ct]===!0?(n.setAttribute("data-asri-enhance-typewriter","true"),qn()):(n.removeAttribute("data-asri-enhance-typewriter"),Te())}var ht="config.json",mt="asri-enhance-listbulletline",Qr=".asri-bullet-highlight,.asri-bullet-line",dt="asri-bullet-highlight",Q="asri-bullet-line",ae="--asri-bullet-line-height",oe=null,J=null,$e=new Set,Kn=()=>{document.querySelectorAll(Qr).forEach(t=>{t.classList.remove(dt,Q),t.style.removeProperty(ae)}),$e.clear()},Jr=t=>{t.classList.remove(dt,Q),t.style.removeProperty(ae)},ei=(t,e,n)=>{if(t.classList.add(dt),e&&n){let i=t.getBoundingClientRect(),r=n.getBoundingClientRect();t.style.setProperty(ae,`${i.top-r.top}px`),t.classList.add(Q)}},Un=()=>{var i,r;let t=window.getSelection(),e=[];if(t&&t.rangeCount){let s=t.getRangeAt(0).startContainer;for(;s&&s.nodeType!==Node.ELEMENT_NODE;)s=s.parentElement;for(;s;){let o=s;if(((i=o.dataset)==null?void 0:i.type)==="NodeListItem"&&e.push(o),(r=o.classList)!=null&&r.contains("protyle-wysiwyg"))break;s=o.parentElement}}let n=new Set(e);$e.forEach(s=>{n.has(s)||Jr(s)}),e.forEach((s,o)=>{let a=o<e.length-1,l=a?e[o+1]:void 0;if(!$e.has(s))ei(s,a,l);else if(a&&l){let c=s.getBoundingClientRect(),u=l.getBoundingClientRect(),d=`${c.top-u.top}px`;s.style.getPropertyValue(ae)!==d&&s.style.setProperty(ae,d),s.classList.contains(Q)||s.classList.add(Q)}else s.classList.contains(Q)&&(s.classList.remove(Q),s.style.removeProperty(ae))}),$e=n},jn=()=>{oe||(oe=()=>{J&&clearTimeout(J),J=setTimeout(()=>{Un(),J=null},50)},document.addEventListener("selectionchange",oe),Un())},pt=()=>{if(!oe){Kn();return}J&&(clearTimeout(J),J=null),document.removeEventListener("selectionchange",oe),oe=null,Kn()};async function Xn(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-listbulletline"),r=await k(t,ht)||{};i?(n.removeAttribute("data-asri-enhance-listbulletline"),r[mt]=!1,pt()):(n.setAttribute("data-asri-enhance-listbulletline","true"),r[mt]=!0,jn()),await _(t,ht,r).catch(()=>{})}async function Wn(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,ht);i&&i[mt]===!0?(n.setAttribute("data-asri-enhance-listbulletline","true"),jn()):(n.removeAttribute("data-asri-enhance-listbulletline"),pt())}var Zn=()=>{pt()};var le=[],Yn=window.fetch,De=!1;function ti(){if(De)return;let t=Yn,e=new Proxy(t,{apply(n,i,r){try{let[s,o]=r,a=s instanceof URL?s.href:String(s),l=null;try{if(o&&typeof o=="object"){let c=o.body;if(typeof c=="string")l=c;else if(c instanceof URLSearchParams)l=c.toString();else if(c&&typeof c=="object")try{l=JSON.stringify(c)}catch(u){l=null}}}catch(c){l=null}le.forEach(c=>{try{let u=c.pattern.test(a),d=l?c.pattern.test(l):!1;(u||d)&&queueMicrotask(()=>{try{c.callback(a,o)}catch(m){}})}catch(u){}})}catch(s){}return Reflect.apply(t,i,r)}});try{window.fetch=e,De=!0}catch(n){}try{let n=XMLHttpRequest.prototype.open,i=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.open=function(r,s,o,a,l){try{this.__asri_intercept_url=s instanceof URL?s.href:String(s)}catch(c){}return n.apply(this,arguments)},XMLHttpRequest.prototype.send=function(r){try{let s=this.__asri_intercept_url||"",o=null;try{if(typeof r=="string")o=r;else if(r instanceof URLSearchParams)o=r.toString();else if(r&&typeof r=="object")try{o=JSON.stringify(r)}catch(a){o=null}}catch(a){o=null}(s||o)&&le.forEach(a=>{try{let l=s?a.pattern.test(s):!1,c=o?a.pattern.test(o):!1;(l||c)&&queueMicrotask(()=>{try{a.callback(s,r)}catch(u){}})}catch(l){}})}catch(s){}return i.apply(this,arguments)}}catch(n){}}function Be(t,e){let i={pattern:t instanceof RegExp?t:new RegExp(String(t)),callback:e};return le.push(i),ti(),{disconnect:()=>{let s=le.indexOf(i);if(s!==-1&&le.splice(s,1),le.length===0&&De){try{window.fetch=Yn}catch(o){}De=!1}}}}var ft="config.json",gt="asri-enhance-vertical-tab",qe=150,er=null,Oe=!1,ze=!1,Vn=0,Qn=0,_e=null,Ce=null,ee=null,te=null,bt=null,Ne=null,ce=null;function ni(t=10,e=100){return new Promise(n=>{let i=0,r=()=>{let s=document.querySelector(".layout__center");if(s){n(s);return}if(i++,i>=t){n(null);return}setTimeout(r,e)};r()})}function ri(){let t=document.documentElement,e=getComputedStyle(t).getPropertyValue("--asri-enhance-vertical-tab-width");if(e){let n=parseFloat(e);return isNaN(n)?qe:n}return qe}function Fe(t){document.documentElement.style.setProperty("--asri-enhance-vertical-tab-width",`${t}px`)}function ii(){Fe(qe)}function si(t){let e=s=>{s.preventDefault(),s.stopPropagation(),ze=!0,Vn=s.clientX,Qn=ri(),document.body.style.userSelect="none",document.body.style.cursor="col-resize",_e=o=>{if(!ze)return;o.preventDefault();let a=o.clientX-Vn;te=Math.max(100,Math.min(300,Qn+a)),ee!==null&&cancelAnimationFrame(ee),ee=requestAnimationFrame(()=>{te!==null&&(Fe(te),te=null),ee=null})},Ce=()=>{ze&&(ze=!1,document.body.style.userSelect="",document.body.style.cursor="",ee!==null&&(cancelAnimationFrame(ee),ee=null),te!==null&&(Fe(te),te=null),_e&&(document.removeEventListener("mousemove",_e),_e=null),Ce&&(document.removeEventListener("mouseup",Ce),Ce=null))},document.addEventListener("mousemove",_e),document.addEventListener("mouseup",Ce)},n=s=>{s.preventDefault(),s.stopPropagation(),ii()},i=t.__asriMousedownHandler,r=t.__asriDblclickHandler;i&&t.removeEventListener("mousedown",i),r&&t.removeEventListener("dblclick",r),t.__asriMousedownHandler=e,t.__asriDblclickHandler=n,t.addEventListener("mousedown",e),t.addEventListener("dblclick",n)}function Jn(t){if(Oe)return;let e=t.querySelectorAll('[data-type="wnd"]');if(e.length===0)return;let n=null,i=1/0,r=1/0;if(e.forEach(s=>{let o=s.getBoundingClientRect(),a=o.top,l=o.left;(a<i||a===i&&l<r)&&(i=a,r=l,n=s)}),Oe=!0,e.forEach(s=>{if(s!==n){s.classList.remove("asri-enhance-verticaltab"),s.classList.remove("asri-enhance-verticaltab-toponly"),s.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing");let o=s.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");o&&o.remove()}}),n){!n.classList.contains("asri-enhance-verticaltab")&&n.classList.add("asri-enhance-verticaltab"),bt=n;let a=n.getBoundingClientRect().top,l=1,c=!1;e.forEach(d=>{if(d!==n){let m=d.getBoundingClientRect();Math.abs(m.top-a)<=l&&(c=!0)}}),c?n.classList.remove("asri-enhance-verticaltab-toponly"):n.classList.add("asri-enhance-verticaltab-toponly");let u=Array.from(n.children).find(d=>d.classList.contains("fn__flex"));if(u&&u.parentElement){let d=u.parentElement.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");d||(d=document.createElement("div"),d.className="layout__resize layout__resize--lr asri-enhance-verticaltab-resize",u.parentElement.insertBefore(d,u.nextSibling)),si(d)}tr(n)}Oe=!1}function ai(){let t=Ne!=null?Ne:document.querySelector("#toolbar");if(!t)return 0;Ne=t;let e=getComputedStyle(t).getPropertyValue("--topbar-right-spacing");if(!e)return 0;let n=parseFloat(e);return isNaN(n)?0:n}function tr(t){let e=t!=null?t:bt;if(!e)return;ai()>0?e.classList.add("asri-enhance-verticaltab-dockr-expand-spacing"):e.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing")}async function nr(){let t=await ni();if(t&&(Fe(qe),Jn(t),!ce))try{let e=Be("setUILayout",()=>{let n=document.querySelector(".layout__center");n&&queueMicrotask(()=>{try{Jn(n),tr()}catch(i){}})});ce=()=>{try{e.disconnect()}catch(n){}ce=null}}catch(e){}}function Ge(){if(ce){try{ce()}catch(n){}ce=null}document.querySelectorAll('[data-type="wnd"]').forEach(n=>{n.classList.remove("asri-enhance-verticaltab"),n.classList.remove("asri-enhance-verticaltab-toponly"),n.classList.remove("asri-enhance-verticaltab-dockr-expand-spacing");let i=n.querySelector(".layout__resize.layout__resize--lr.asri-enhance-verticaltab-resize");if(i){let r=i.__asriMousedownHandler,s=i.__asriDblclickHandler;r&&(i.removeEventListener("mousedown",r),delete i.__asriMousedownHandler),s&&(i.removeEventListener("dblclick",s),delete i.__asriDblclickHandler),i.remove()}});let e=document.documentElement;e&&e.style.removeProperty("--asri-enhance-vertical-tab-width"),Oe=!1,bt=null}async function rr(t,e){e&&(e.preventDefault(),e.stopPropagation()),er=t;let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-vertical-tab"),r=await k(t,ft)||{};i?(n.removeAttribute("data-asri-enhance-vertical-tab"),r[gt]=!1,Ge()):(n.setAttribute("data-asri-enhance-vertical-tab","true"),r[gt]=!0,nr().catch(()=>{})),await _(t,ft,r).catch(()=>{})}async function ir(t,e){er=t;let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,ft);i&&i[gt]===!0?(n.setAttribute("data-asri-enhance-vertical-tab","true"),nr().catch(()=>{})):(n.removeAttribute("data-asri-enhance-vertical-tab"),Ge())}function xt(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var re=xt();function hr(t){re=t}var Se={exec:()=>null};function E(t,e=""){let n=typeof t=="string"?t:t.source,i={replace:(r,s)=>{let o=typeof s=="string"?s:s.source;return o=o.replace(D.caret,"$1"),n=n.replace(r,o),i},getRegex:()=>new RegExp(n,e)};return i}var oi=(()=>{try{return!!new RegExp("(?<=1)(?<!1)")}catch(t){return!1}})(),D={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] +\S/,listReplaceTask:/^\[[ xX]\] +/,listTaskCheckbox:/\[[ xX]\]/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:t=>new RegExp(`^( {0,3}${t})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}#`),htmlBeginRegex:t=>new RegExp(`^ {0,${Math.min(3,t-1)}}<(?:[a-z].*>|!--)`,"i")},li=/^(?:[ \t]*(?:\n|$))+/,ci=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,ui=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Ae=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,hi=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,wt=/(?:[*+-]|\d{1,9}[.)])/,mr=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,dr=E(mr).replace(/bull/g,wt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),mi=E(mr).replace(/bull/g,wt).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),Et=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,di=/^[^\n]+/,Tt=/(?!\s*\])(?:\\[\s\S]|[^\[\]\\])+/,pi=E(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",Tt).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),fi=E(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,wt).getRegex(),Ze="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",_t=/<!--(?:-?>|[\s\S]*?(?:-->|$))/,gi=E("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",_t).replace("tag",Ze).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),pr=E(Et).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ze).getRegex(),bi=E(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",pr).getRegex(),Ct={blockquote:bi,code:ci,def:pi,fences:ui,heading:hi,hr:Ae,html:gi,lheading:dr,list:fi,newline:li,paragraph:pr,table:Se,text:di},sr=E("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ze).getRegex(),yi={...Ct,lheading:mi,table:sr,paragraph:E(Et).replace("hr",Ae).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",sr).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Ze).getRegex()},ki={...Ct,html:E(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",_t).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:Se,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:E(Et).replace("hr",Ae).replace("heading",` *#{1,6} *[^
]`).replace("lheading",dr).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},vi=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,xi=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,fr=/^( {2,}|\\)\n(?!\s*$)/,wi=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,Ye=/[\p{P}\p{S}]/u,Lt=/[\s\p{P}\p{S}]/u,gr=/[^\s\p{P}\p{S}]/u,Ei=E(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,Lt).getRegex(),br=/(?!~)[\p{P}\p{S}]/u,Ti=/(?!~)[\s\p{P}\p{S}]/u,_i=/(?:[^\s\p{P}\p{S}]|~)/u,Ci=E(/link|precode-code|html/,"g").replace("link",/\[(?:[^\[\]`]|(?<a>`+)[^`]+\k<a>(?!`))*?\]\((?:\\[\s\S]|[^\\\(\)]|\((?:\\[\s\S]|[^\\\(\)])*\))*\)/).replace("precode-",oi?"(?<!`)()":"(^^|[^`])").replace("code",/(?<b>`+)[^`]+\k<b>(?!`)/).replace("html",/<(?! )[^<>]*?>/).getRegex(),yr=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,Li=E(yr,"u").replace(/punct/g,Ye).getRegex(),Pi=E(yr,"u").replace(/punct/g,br).getRegex(),kr="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",Mi=E(kr,"gu").replace(/notPunctSpace/g,gr).replace(/punctSpace/g,Lt).replace(/punct/g,Ye).getRegex(),Si=E(kr,"gu").replace(/notPunctSpace/g,_i).replace(/punctSpace/g,Ti).replace(/punct/g,br).getRegex(),Ai=E("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,gr).replace(/punctSpace/g,Lt).replace(/punct/g,Ye).getRegex(),Hi=E(/\\(punct)/,"gu").replace(/punct/g,Ye).getRegex(),Ri=E(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),Ii=E(_t).replace("(?:-->|$)","-->").getRegex(),$i=E("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",Ii).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),je=/(?:\[(?:\\[\s\S]|[^\[\]\\])*\]|\\[\s\S]|`+[^`]*?`+(?!`)|[^\[\]\\`])*?/,Di=E(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",je).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),vr=E(/^!?\[(label)\]\[(ref)\]/).replace("label",je).replace("ref",Tt).getRegex(),xr=E(/^!?\[(ref)\](?:\[\])?/).replace("ref",Tt).getRegex(),Bi=E("reflink|nolink(?!\\()","g").replace("reflink",vr).replace("nolink",xr).getRegex(),ar=/[hH][tT][tT][pP][sS]?|[fF][tT][pP]/,Pt={_backpedal:Se,anyPunctuation:Hi,autolink:Ri,blockSkip:Ci,br:fr,code:xi,del:Se,emStrongLDelim:Li,emStrongRDelimAst:Mi,emStrongRDelimUnd:Ai,escape:vi,link:Di,nolink:xr,punctuation:Ei,reflink:vr,reflinkSearch:Bi,tag:$i,text:wi,url:Se},zi={...Pt,link:E(/^!?\[(label)\]\((.*?)\)/).replace("label",je).getRegex(),reflink:E(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",je).getRegex()},yt={...Pt,emStrongRDelimAst:Si,emStrongLDelim:Pi,url:E(/^((?:protocol):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("protocol",ar).replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\[\s\S]|[^\\])*?(?:\\[\s\S]|[^\s~\\]))\1(?=[^~]|$)/,text:E(/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|protocol:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/).replace("protocol",ar).getRegex()},Ni={...yt,br:E(fr).replace("{2,}","*").getRegex(),text:E(yt.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Ke={normal:Ct,gfm:yi,pedantic:ki},Le={normal:Pt,gfm:yt,breaks:Ni,pedantic:zi},Oi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},or=t=>Oi[t];function Z(t,e){if(e){if(D.escapeTest.test(t))return t.replace(D.escapeReplace,or)}else if(D.escapeTestNoEncode.test(t))return t.replace(D.escapeReplaceNoEncode,or);return t}function lr(t){try{t=encodeURI(t).replace(D.percentDecode,"%")}catch(e){return null}return t}function cr(t,e){var s;let n=t.replace(D.findPipe,(o,a,l)=>{let c=!1,u=a;for(;--u>=0&&l[u]==="\\";)c=!c;return c?"|":" |"}),i=n.split(D.splitPipe),r=0;if(i[0].trim()||i.shift(),i.length>0&&!((s=i.at(-1))!=null&&s.trim())&&i.pop(),e)if(i.length>e)i.splice(e);else for(;i.length<e;)i.push("");for(;r<i.length;r++)i[r]=i[r].trim().replace(D.slashPipe,"|");return i}function Pe(t,e,n){let i=t.length;if(i===0)return"";let r=0;for(;r<i;){let s=t.charAt(i-r-1);if(s===e&&!n)r++;else if(s!==e&&n)r++;else break}return t.slice(0,i-r)}function qi(t,e){if(t.indexOf(e[1])===-1)return-1;let n=0;for(let i=0;i<t.length;i++)if(t[i]==="\\")i++;else if(t[i]===e[0])n++;else if(t[i]===e[1]&&(n--,n<0))return i;return n>0?-2:-1}function ur(t,e,n,i,r){let s=e.href,o=e.title||null,a=t[1].replace(r.other.outputLinkReplace,"$1");i.state.inLink=!0;let l={type:t[0].charAt(0)==="!"?"image":"link",raw:n,href:s,title:o,text:a,tokens:i.inlineTokens(a)};return i.state.inLink=!1,l}function Fi(t,e,n){let i=t.match(n.other.indentCodeCompensation);if(i===null)return e;let r=i[1];return e.split(`
`).map(s=>{let o=s.match(n.other.beginningSpace);if(o===null)return s;let[a]=o;return a.length>=r.length?s.slice(r.length):s}).join(`
`)}var Xe=class{constructor(t){C(this,"options");C(this,"rules");C(this,"lexer");this.options=t||re}space(t){let e=this.rules.block.newline.exec(t);if(e&&e[0].length>0)return{type:"space",raw:e[0]}}code(t){let e=this.rules.block.code.exec(t);if(e){let n=e[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:e[0],codeBlockStyle:"indented",text:this.options.pedantic?n:Pe(n,`
`)}}}fences(t){let e=this.rules.block.fences.exec(t);if(e){let n=e[0],i=Fi(n,e[3]||"",this.rules);return{type:"code",raw:n,lang:e[2]?e[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):e[2],text:i}}}heading(t){let e=this.rules.block.heading.exec(t);if(e){let n=e[2].trim();if(this.rules.other.endingHash.test(n)){let i=Pe(n,"#");(this.options.pedantic||!i||this.rules.other.endingSpaceChar.test(i))&&(n=i.trim())}return{type:"heading",raw:e[0],depth:e[1].length,text:n,tokens:this.lexer.inline(n)}}}hr(t){let e=this.rules.block.hr.exec(t);if(e)return{type:"hr",raw:Pe(e[0],`
`)}}blockquote(t){let e=this.rules.block.blockquote.exec(t);if(e){let n=Pe(e[0],`
`).split(`
`),i="",r="",s=[];for(;n.length>0;){let o=!1,a=[],l;for(l=0;l<n.length;l++)if(this.rules.other.blockquoteStart.test(n[l]))a.push(n[l]),o=!0;else if(!o)a.push(n[l]);else break;n=n.slice(l);let c=a.join(`
`),u=c.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");i=i?`${i}
${c}`:c,r=r?`${r}
${u}`:u;let d=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(u,s,!0),this.lexer.state.top=d,n.length===0)break;let m=s.at(-1);if((m==null?void 0:m.type)==="code")break;if((m==null?void 0:m.type)==="blockquote"){let g=m,h=g.raw+`
`+n.join(`
`),y=this.blockquote(h);s[s.length-1]=y,i=i.substring(0,i.length-g.raw.length)+y.raw,r=r.substring(0,r.length-g.text.length)+y.text;break}else if((m==null?void 0:m.type)==="list"){let g=m,h=g.raw+`
`+n.join(`
`),y=this.list(h);s[s.length-1]=y,i=i.substring(0,i.length-m.raw.length)+y.raw,r=r.substring(0,r.length-g.raw.length)+y.raw,n=h.substring(s.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:i,tokens:s,text:r}}}list(t){var n,i;let e=this.rules.block.list.exec(t);if(e){let r=e[1].trim(),s=r.length>1,o={type:"list",raw:"",ordered:s,start:s?+r.slice(0,-1):"",loose:!1,items:[]};r=s?`\\d{1,9}\\${r.slice(-1)}`:`\\${r}`,this.options.pedantic&&(r=s?r:"[*+-]");let a=this.rules.other.listItemRegex(r),l=!1;for(;t;){let u=!1,d="",m="";if(!(e=a.exec(t))||this.rules.block.hr.test(t))break;d=e[0],t=t.substring(d.length);let g=e[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,w=>" ".repeat(3*w.length)),h=t.split(`
`,1)[0],y=!g.trim(),p=0;if(this.options.pedantic?(p=2,m=g.trimStart()):y?p=e[1].length+1:(p=e[2].search(this.rules.other.nonSpaceChar),p=p>4?1:p,m=g.slice(p),p+=e[1].length),y&&this.rules.other.blankLine.test(h)&&(d+=h+`
`,t=t.substring(h.length+1),u=!0),!u){let w=this.rules.other.nextBulletRegex(p),x=this.rules.other.hrRegex(p),P=this.rules.other.fencesBeginRegex(p),I=this.rules.other.headingBeginRegex(p),M=this.rules.other.htmlBeginRegex(p);for(;t;){let $=t.split(`
`,1)[0],A;if(h=$,this.options.pedantic?(h=h.replace(this.rules.other.listReplaceNesting,"  "),A=h):A=h.replace(this.rules.other.tabCharGlobal,"    "),P.test(h)||I.test(h)||M.test(h)||w.test(h)||x.test(h))break;if(A.search(this.rules.other.nonSpaceChar)>=p||!h.trim())m+=`
`+A.slice(p);else{if(y||g.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||P.test(g)||I.test(g)||x.test(g))break;m+=`
`+h}!y&&!h.trim()&&(y=!0),d+=$+`
`,t=t.substring($.length+1),g=A.slice(p)}}o.loose||(l?o.loose=!0:this.rules.other.doubleBlankLine.test(d)&&(l=!0)),o.items.push({type:"list_item",raw:d,task:!!this.options.gfm&&this.rules.other.listIsTask.test(m),loose:!1,text:m,tokens:[]}),o.raw+=d}let c=o.items.at(-1);if(c)c.raw=c.raw.trimEnd(),c.text=c.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let u of o.items){if(this.lexer.state.top=!1,u.tokens=this.lexer.blockTokens(u.text,[]),u.task){if(u.text=u.text.replace(this.rules.other.listReplaceTask,""),((n=u.tokens[0])==null?void 0:n.type)==="text"||((i=u.tokens[0])==null?void 0:i.type)==="paragraph"){u.tokens[0].raw=u.tokens[0].raw.replace(this.rules.other.listReplaceTask,""),u.tokens[0].text=u.tokens[0].text.replace(this.rules.other.listReplaceTask,"");for(let m=this.lexer.inlineQueue.length-1;m>=0;m--)if(this.rules.other.listIsTask.test(this.lexer.inlineQueue[m].src)){this.lexer.inlineQueue[m].src=this.lexer.inlineQueue[m].src.replace(this.rules.other.listReplaceTask,"");break}}let d=this.rules.other.listTaskCheckbox.exec(u.raw);if(d){let m={type:"checkbox",raw:d[0]+" ",checked:d[0]!=="[ ]"};u.checked=m.checked,o.loose?u.tokens[0]&&["paragraph","text"].includes(u.tokens[0].type)&&"tokens"in u.tokens[0]&&u.tokens[0].tokens?(u.tokens[0].raw=m.raw+u.tokens[0].raw,u.tokens[0].text=m.raw+u.tokens[0].text,u.tokens[0].tokens.unshift(m)):u.tokens.unshift({type:"paragraph",raw:m.raw,text:m.raw,tokens:[m]}):u.tokens.unshift(m)}}if(!o.loose){let d=u.tokens.filter(g=>g.type==="space"),m=d.length>0&&d.some(g=>this.rules.other.anyLine.test(g.raw));o.loose=m}}if(o.loose)for(let u of o.items){u.loose=!0;for(let d of u.tokens)d.type==="text"&&(d.type="paragraph")}return o}}html(t){let e=this.rules.block.html.exec(t);if(e)return{type:"html",block:!0,raw:e[0],pre:e[1]==="pre"||e[1]==="script"||e[1]==="style",text:e[0]}}def(t){let e=this.rules.block.def.exec(t);if(e){let n=e[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),i=e[2]?e[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",r=e[3]?e[3].substring(1,e[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):e[3];return{type:"def",tag:n,raw:e[0],href:i,title:r}}}table(t){var o;let e=this.rules.block.table.exec(t);if(!e||!this.rules.other.tableDelimiter.test(e[2]))return;let n=cr(e[1]),i=e[2].replace(this.rules.other.tableAlignChars,"").split("|"),r=(o=e[3])!=null&&o.trim()?e[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],s={type:"table",raw:e[0],header:[],align:[],rows:[]};if(n.length===i.length){for(let a of i)this.rules.other.tableAlignRight.test(a)?s.align.push("right"):this.rules.other.tableAlignCenter.test(a)?s.align.push("center"):this.rules.other.tableAlignLeft.test(a)?s.align.push("left"):s.align.push(null);for(let a=0;a<n.length;a++)s.header.push({text:n[a],tokens:this.lexer.inline(n[a]),header:!0,align:s.align[a]});for(let a of r)s.rows.push(cr(a,s.header.length).map((l,c)=>({text:l,tokens:this.lexer.inline(l),header:!1,align:s.align[c]})));return s}}lheading(t){let e=this.rules.block.lheading.exec(t);if(e)return{type:"heading",raw:e[0],depth:e[2].charAt(0)==="="?1:2,text:e[1],tokens:this.lexer.inline(e[1])}}paragraph(t){let e=this.rules.block.paragraph.exec(t);if(e){let n=e[1].charAt(e[1].length-1)===`
`?e[1].slice(0,-1):e[1];return{type:"paragraph",raw:e[0],text:n,tokens:this.lexer.inline(n)}}}text(t){let e=this.rules.block.text.exec(t);if(e)return{type:"text",raw:e[0],text:e[0],tokens:this.lexer.inline(e[0])}}escape(t){let e=this.rules.inline.escape.exec(t);if(e)return{type:"escape",raw:e[0],text:e[1]}}tag(t){let e=this.rules.inline.tag.exec(t);if(e)return!this.lexer.state.inLink&&this.rules.other.startATag.test(e[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(e[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(e[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(e[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:e[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:e[0]}}link(t){let e=this.rules.inline.link.exec(t);if(e){let n=e[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(n)){if(!this.rules.other.endAngleBracket.test(n))return;let s=Pe(n.slice(0,-1),"\\");if((n.length-s.length)%2===0)return}else{let s=qi(e[2],"()");if(s===-2)return;if(s>-1){let o=(e[0].indexOf("!")===0?5:4)+e[1].length+s;e[2]=e[2].substring(0,s),e[0]=e[0].substring(0,o).trim(),e[3]=""}}let i=e[2],r="";if(this.options.pedantic){let s=this.rules.other.pedanticHrefTitle.exec(i);s&&(i=s[1],r=s[3])}else r=e[3]?e[3].slice(1,-1):"";return i=i.trim(),this.rules.other.startAngleBracket.test(i)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(n)?i=i.slice(1):i=i.slice(1,-1)),ur(e,{href:i&&i.replace(this.rules.inline.anyPunctuation,"$1"),title:r&&r.replace(this.rules.inline.anyPunctuation,"$1")},e[0],this.lexer,this.rules)}}reflink(t,e){let n;if((n=this.rules.inline.reflink.exec(t))||(n=this.rules.inline.nolink.exec(t))){let i=(n[2]||n[1]).replace(this.rules.other.multipleSpaceGlobal," "),r=e[i.toLowerCase()];if(!r){let s=n[0].charAt(0);return{type:"text",raw:s,text:s}}return ur(n,r,n[0],this.lexer,this.rules)}}emStrong(t,e,n=""){let i=this.rules.inline.emStrongLDelim.exec(t);if(!(!i||i[3]&&n.match(this.rules.other.unicodeAlphaNumeric))&&(!(i[1]||i[2])||!n||this.rules.inline.punctuation.exec(n))){let r=[...i[0]].length-1,s,o,a=r,l=0,c=i[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(c.lastIndex=0,e=e.slice(-1*t.length+r);(i=c.exec(e))!=null;){if(s=i[1]||i[2]||i[3]||i[4]||i[5]||i[6],!s)continue;if(o=[...s].length,i[3]||i[4]){a+=o;continue}else if((i[5]||i[6])&&r%3&&!((r+o)%3)){l+=o;continue}if(a-=o,a>0)continue;o=Math.min(o,o+a+l);let u=[...i[0]][0].length,d=t.slice(0,r+i.index+u+o);if(Math.min(r,o)%2){let g=d.slice(1,-1);return{type:"em",raw:d,text:g,tokens:this.lexer.inlineTokens(g)}}let m=d.slice(2,-2);return{type:"strong",raw:d,text:m,tokens:this.lexer.inlineTokens(m)}}}}codespan(t){let e=this.rules.inline.code.exec(t);if(e){let n=e[2].replace(this.rules.other.newLineCharGlobal," "),i=this.rules.other.nonSpaceChar.test(n),r=this.rules.other.startingSpaceChar.test(n)&&this.rules.other.endingSpaceChar.test(n);return i&&r&&(n=n.substring(1,n.length-1)),{type:"codespan",raw:e[0],text:n}}}br(t){let e=this.rules.inline.br.exec(t);if(e)return{type:"br",raw:e[0]}}del(t){let e=this.rules.inline.del.exec(t);if(e)return{type:"del",raw:e[0],text:e[2],tokens:this.lexer.inlineTokens(e[2])}}autolink(t){let e=this.rules.inline.autolink.exec(t);if(e){let n,i;return e[2]==="@"?(n=e[1],i="mailto:"+n):(n=e[1],i=n),{type:"link",raw:e[0],text:n,href:i,tokens:[{type:"text",raw:n,text:n}]}}}url(t){var n,i;let e;if(e=this.rules.inline.url.exec(t)){let r,s;if(e[2]==="@")r=e[0],s="mailto:"+r;else{let o;do o=e[0],e[0]=(i=(n=this.rules.inline._backpedal.exec(e[0]))==null?void 0:n[0])!=null?i:"";while(o!==e[0]);r=e[0],e[1]==="www."?s="http://"+e[0]:s=e[0]}return{type:"link",raw:e[0],text:r,href:s,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(t){let e=this.rules.inline.text.exec(t);if(e){let n=this.lexer.state.inRawBlock;return{type:"text",raw:e[0],text:e[0],escaped:n}}}},G=class kt{constructor(e){C(this,"tokens");C(this,"options");C(this,"state");C(this,"inlineQueue");C(this,"tokenizer");this.tokens=[],this.tokens.links=Object.create(null),this.options=e||re,this.options.tokenizer=this.options.tokenizer||new Xe,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let n={other:D,block:Ke.normal,inline:Le.normal};this.options.pedantic?(n.block=Ke.pedantic,n.inline=Le.pedantic):this.options.gfm&&(n.block=Ke.gfm,this.options.breaks?n.inline=Le.breaks:n.inline=Le.gfm),this.tokenizer.rules=n}static get rules(){return{block:Ke,inline:Le}}static lex(e,n){return new kt(n).lex(e)}static lexInline(e,n){return new kt(n).inlineTokens(e)}lex(e){e=e.replace(D.carriageReturn,`
`),this.blockTokens(e,this.tokens);for(let n=0;n<this.inlineQueue.length;n++){let i=this.inlineQueue[n];this.inlineTokens(i.src,i.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(e,n=[],i=!1){var r,s,o;for(this.options.pedantic&&(e=e.replace(D.tabCharGlobal,"    ").replace(D.spaceLine,""));e;){let a;if((s=(r=this.options.extensions)==null?void 0:r.block)!=null&&s.some(c=>(a=c.call({lexer:this},e,n))?(e=e.substring(a.raw.length),n.push(a),!0):!1))continue;if(a=this.tokenizer.space(e)){e=e.substring(a.raw.length);let c=n.at(-1);a.raw.length===1&&c!==void 0?c.raw+=`
`:n.push(a);continue}if(a=this.tokenizer.code(e)){e=e.substring(a.raw.length);let c=n.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+a.raw,c.text+=`
`+a.text,this.inlineQueue.at(-1).src=c.text):n.push(a);continue}if(a=this.tokenizer.fences(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.heading(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.hr(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.blockquote(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.list(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.html(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.def(e)){e=e.substring(a.raw.length);let c=n.at(-1);(c==null?void 0:c.type)==="paragraph"||(c==null?void 0:c.type)==="text"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+a.raw,c.text+=`
`+a.raw,this.inlineQueue.at(-1).src=c.text):this.tokens.links[a.tag]||(this.tokens.links[a.tag]={href:a.href,title:a.title},n.push(a));continue}if(a=this.tokenizer.table(e)){e=e.substring(a.raw.length),n.push(a);continue}if(a=this.tokenizer.lheading(e)){e=e.substring(a.raw.length),n.push(a);continue}let l=e;if((o=this.options.extensions)!=null&&o.startBlock){let c=1/0,u=e.slice(1),d;this.options.extensions.startBlock.forEach(m=>{d=m.call({lexer:this},u),typeof d=="number"&&d>=0&&(c=Math.min(c,d))}),c<1/0&&c>=0&&(l=e.substring(0,c+1))}if(this.state.top&&(a=this.tokenizer.paragraph(l))){let c=n.at(-1);i&&(c==null?void 0:c.type)==="paragraph"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+a.raw,c.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):n.push(a),i=l.length!==e.length,e=e.substring(a.raw.length);continue}if(a=this.tokenizer.text(e)){e=e.substring(a.raw.length);let c=n.at(-1);(c==null?void 0:c.type)==="text"?(c.raw+=(c.raw.endsWith(`
`)?"":`
`)+a.raw,c.text+=`
`+a.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=c.text):n.push(a);continue}if(e){let c="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(c);break}else throw new Error(c)}}return this.state.top=!0,n}inline(e,n=[]){return this.inlineQueue.push({src:e,tokens:n}),n}inlineTokens(e,n=[]){var l,c,u,d,m,g;let i=e,r=null;if(this.tokens.links){let h=Object.keys(this.tokens.links);if(h.length>0)for(;(r=this.tokenizer.rules.inline.reflinkSearch.exec(i))!=null;)h.includes(r[0].slice(r[0].lastIndexOf("[")+1,-1))&&(i=i.slice(0,r.index)+"["+"a".repeat(r[0].length-2)+"]"+i.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(r=this.tokenizer.rules.inline.anyPunctuation.exec(i))!=null;)i=i.slice(0,r.index)+"++"+i.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);let s;for(;(r=this.tokenizer.rules.inline.blockSkip.exec(i))!=null;)s=r[2]?r[2].length:0,i=i.slice(0,r.index+s)+"["+"a".repeat(r[0].length-s-2)+"]"+i.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);i=(u=(c=(l=this.options.hooks)==null?void 0:l.emStrongMask)==null?void 0:c.call({lexer:this},i))!=null?u:i;let o=!1,a="";for(;e;){o||(a=""),o=!1;let h;if((m=(d=this.options.extensions)==null?void 0:d.inline)!=null&&m.some(p=>(h=p.call({lexer:this},e,n))?(e=e.substring(h.raw.length),n.push(h),!0):!1))continue;if(h=this.tokenizer.escape(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.tag(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.link(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.reflink(e,this.tokens.links)){e=e.substring(h.raw.length);let p=n.at(-1);h.type==="text"&&(p==null?void 0:p.type)==="text"?(p.raw+=h.raw,p.text+=h.text):n.push(h);continue}if(h=this.tokenizer.emStrong(e,i,a)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.codespan(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.br(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.del(e)){e=e.substring(h.raw.length),n.push(h);continue}if(h=this.tokenizer.autolink(e)){e=e.substring(h.raw.length),n.push(h);continue}if(!this.state.inLink&&(h=this.tokenizer.url(e))){e=e.substring(h.raw.length),n.push(h);continue}let y=e;if((g=this.options.extensions)!=null&&g.startInline){let p=1/0,w=e.slice(1),x;this.options.extensions.startInline.forEach(P=>{x=P.call({lexer:this},w),typeof x=="number"&&x>=0&&(p=Math.min(p,x))}),p<1/0&&p>=0&&(y=e.substring(0,p+1))}if(h=this.tokenizer.inlineText(y)){e=e.substring(h.raw.length),h.raw.slice(-1)!=="_"&&(a=h.raw.slice(-1)),o=!0;let p=n.at(-1);(p==null?void 0:p.type)==="text"?(p.raw+=h.raw,p.text+=h.text):n.push(h);continue}if(e){let p="Infinite loop on byte: "+e.charCodeAt(0);if(this.options.silent){console.error(p);break}else throw new Error(p)}}return n}},We=class{constructor(t){C(this,"options");C(this,"parser");this.options=t||re}space(t){return""}code({text:t,lang:e,escaped:n}){var s;let i=(s=(e||"").match(D.notSpaceStart))==null?void 0:s[0],r=t.replace(D.endingNewline,"")+`
`;return i?'<pre><code class="language-'+Z(i)+'">'+(n?r:Z(r,!0))+`</code></pre>
`:"<pre><code>"+(n?r:Z(r,!0))+`</code></pre>
`}blockquote({tokens:t}){return`<blockquote>
${this.parser.parse(t)}</blockquote>
`}html({text:t}){return t}def(t){return""}heading({tokens:t,depth:e}){return`<h${e}>${this.parser.parseInline(t)}</h${e}>
`}hr(t){return`<hr>
`}list(t){let e=t.ordered,n=t.start,i="";for(let o=0;o<t.items.length;o++){let a=t.items[o];i+=this.listitem(a)}let r=e?"ol":"ul",s=e&&n!==1?' start="'+n+'"':"";return"<"+r+s+`>
`+i+"</"+r+`>
`}listitem(t){return`<li>${this.parser.parse(t.tokens)}</li>
`}checkbox({checked:t}){return"<input "+(t?'checked="" ':"")+'disabled="" type="checkbox"> '}paragraph({tokens:t}){return`<p>${this.parser.parseInline(t)}</p>
`}table(t){let e="",n="";for(let r=0;r<t.header.length;r++)n+=this.tablecell(t.header[r]);e+=this.tablerow({text:n});let i="";for(let r=0;r<t.rows.length;r++){let s=t.rows[r];n="";for(let o=0;o<s.length;o++)n+=this.tablecell(s[o]);i+=this.tablerow({text:n})}return i&&(i=`<tbody>${i}</tbody>`),`<table>
<thead>
`+e+`</thead>
`+i+`</table>
`}tablerow({text:t}){return`<tr>
${t}</tr>
`}tablecell(t){let e=this.parser.parseInline(t.tokens),n=t.header?"th":"td";return(t.align?`<${n} align="${t.align}">`:`<${n}>`)+e+`</${n}>
`}strong({tokens:t}){return`<strong>${this.parser.parseInline(t)}</strong>`}em({tokens:t}){return`<em>${this.parser.parseInline(t)}</em>`}codespan({text:t}){return`<code>${Z(t,!0)}</code>`}br(t){return"<br>"}del({tokens:t}){return`<del>${this.parser.parseInline(t)}</del>`}link({href:t,title:e,tokens:n}){let i=this.parser.parseInline(n),r=lr(t);if(r===null)return i;t=r;let s='<a href="'+t+'"';return e&&(s+=' title="'+Z(e)+'"'),s+=">"+i+"</a>",s}image({href:t,title:e,text:n,tokens:i}){i&&(n=this.parser.parseInline(i,this.parser.textRenderer));let r=lr(t);if(r===null)return Z(n);t=r;let s=`<img src="${t}" alt="${n}"`;return e&&(s+=` title="${Z(e)}"`),s+=">",s}text(t){return"tokens"in t&&t.tokens?this.parser.parseInline(t.tokens):"escaped"in t&&t.escaped?t.text:Z(t.text)}},Mt=class{strong({text:t}){return t}em({text:t}){return t}codespan({text:t}){return t}del({text:t}){return t}html({text:t}){return t}text({text:t}){return t}link({text:t}){return""+t}image({text:t}){return""+t}br(){return""}checkbox({raw:t}){return t}},K=class vt{constructor(e){C(this,"options");C(this,"renderer");C(this,"textRenderer");this.options=e||re,this.options.renderer=this.options.renderer||new We,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new Mt}static parse(e,n){return new vt(n).parse(e)}static parseInline(e,n){return new vt(n).parseInline(e)}parse(e){var i,r;let n="";for(let s=0;s<e.length;s++){let o=e[s];if((r=(i=this.options.extensions)==null?void 0:i.renderers)!=null&&r[o.type]){let l=o,c=this.options.extensions.renderers[l.type].call({parser:this},l);if(c!==!1||!["space","hr","heading","code","table","blockquote","list","html","def","paragraph","text"].includes(l.type)){n+=c||"";continue}}let a=o;switch(a.type){case"space":{n+=this.renderer.space(a);break}case"hr":{n+=this.renderer.hr(a);break}case"heading":{n+=this.renderer.heading(a);break}case"code":{n+=this.renderer.code(a);break}case"table":{n+=this.renderer.table(a);break}case"blockquote":{n+=this.renderer.blockquote(a);break}case"list":{n+=this.renderer.list(a);break}case"checkbox":{n+=this.renderer.checkbox(a);break}case"html":{n+=this.renderer.html(a);break}case"def":{n+=this.renderer.def(a);break}case"paragraph":{n+=this.renderer.paragraph(a);break}case"text":{n+=this.renderer.text(a);break}default:{let l='Token with "'+a.type+'" type was not found.';if(this.options.silent)return console.error(l),"";throw new Error(l)}}}return n}parseInline(e,n=this.renderer){var r,s;let i="";for(let o=0;o<e.length;o++){let a=e[o];if((s=(r=this.options.extensions)==null?void 0:r.renderers)!=null&&s[a.type]){let c=this.options.extensions.renderers[a.type].call({parser:this},a);if(c!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(a.type)){i+=c||"";continue}}let l=a;switch(l.type){case"escape":{i+=n.text(l);break}case"html":{i+=n.html(l);break}case"link":{i+=n.link(l);break}case"image":{i+=n.image(l);break}case"checkbox":{i+=n.checkbox(l);break}case"strong":{i+=n.strong(l);break}case"em":{i+=n.em(l);break}case"codespan":{i+=n.codespan(l);break}case"br":{i+=n.br(l);break}case"del":{i+=n.del(l);break}case"text":{i+=n.text(l);break}default:{let c='Token with "'+l.type+'" type was not found.';if(this.options.silent)return console.error(c),"";throw new Error(c)}}}return i}},Ue,Me=(Ue=class{constructor(t){C(this,"options");C(this,"block");this.options=t||re}preprocess(t){return t}postprocess(t){return t}processAllTokens(t){return t}emStrongMask(t){return t}provideLexer(){return this.block?G.lex:G.lexInline}provideParser(){return this.block?K.parse:K.parseInline}},C(Ue,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens","emStrongMask"])),C(Ue,"passThroughHooksRespectAsync",new Set(["preprocess","postprocess","processAllTokens"])),Ue),Gi=class{constructor(...t){C(this,"defaults",xt());C(this,"options",this.setOptions);C(this,"parse",this.parseMarkdown(!0));C(this,"parseInline",this.parseMarkdown(!1));C(this,"Parser",K);C(this,"Renderer",We);C(this,"TextRenderer",Mt);C(this,"Lexer",G);C(this,"Tokenizer",Xe);C(this,"Hooks",Me);this.use(...t)}walkTokens(t,e){var i,r;let n=[];for(let s of t)switch(n=n.concat(e.call(this,s)),s.type){case"table":{let o=s;for(let a of o.header)n=n.concat(this.walkTokens(a.tokens,e));for(let a of o.rows)for(let l of a)n=n.concat(this.walkTokens(l.tokens,e));break}case"list":{let o=s;n=n.concat(this.walkTokens(o.items,e));break}default:{let o=s;(r=(i=this.defaults.extensions)==null?void 0:i.childTokens)!=null&&r[o.type]?this.defaults.extensions.childTokens[o.type].forEach(a=>{let l=o[a].flat(1/0);n=n.concat(this.walkTokens(l,e))}):o.tokens&&(n=n.concat(this.walkTokens(o.tokens,e)))}}return n}use(...t){let e=this.defaults.extensions||{renderers:{},childTokens:{}};return t.forEach(n=>{let i={...n};if(i.async=this.defaults.async||i.async||!1,n.extensions&&(n.extensions.forEach(r=>{if(!r.name)throw new Error("extension name required");if("renderer"in r){let s=e.renderers[r.name];s?e.renderers[r.name]=function(...o){let a=r.renderer.apply(this,o);return a===!1&&(a=s.apply(this,o)),a}:e.renderers[r.name]=r.renderer}if("tokenizer"in r){if(!r.level||r.level!=="block"&&r.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let s=e[r.level];s?s.unshift(r.tokenizer):e[r.level]=[r.tokenizer],r.start&&(r.level==="block"?e.startBlock?e.startBlock.push(r.start):e.startBlock=[r.start]:r.level==="inline"&&(e.startInline?e.startInline.push(r.start):e.startInline=[r.start]))}"childTokens"in r&&r.childTokens&&(e.childTokens[r.name]=r.childTokens)}),i.extensions=e),n.renderer){let r=this.defaults.renderer||new We(this.defaults);for(let s in n.renderer){if(!(s in r))throw new Error(`renderer '${s}' does not exist`);if(["options","parser"].includes(s))continue;let o=s,a=n.renderer[o],l=r[o];r[o]=(...c)=>{let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u||""}}i.renderer=r}if(n.tokenizer){let r=this.defaults.tokenizer||new Xe(this.defaults);for(let s in n.tokenizer){if(!(s in r))throw new Error(`tokenizer '${s}' does not exist`);if(["options","rules","lexer"].includes(s))continue;let o=s,a=n.tokenizer[o],l=r[o];r[o]=(...c)=>{let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u}}i.tokenizer=r}if(n.hooks){let r=this.defaults.hooks||new Me;for(let s in n.hooks){if(!(s in r))throw new Error(`hook '${s}' does not exist`);if(["options","block"].includes(s))continue;let o=s,a=n.hooks[o],l=r[o];Me.passThroughHooks.has(s)?r[o]=c=>{if(this.defaults.async&&Me.passThroughHooksRespectAsync.has(s))return(async()=>{let d=await a.call(r,c);return l.call(r,d)})();let u=a.call(r,c);return l.call(r,u)}:r[o]=(...c)=>{if(this.defaults.async)return(async()=>{let d=await a.apply(r,c);return d===!1&&(d=await l.apply(r,c)),d})();let u=a.apply(r,c);return u===!1&&(u=l.apply(r,c)),u}}i.hooks=r}if(n.walkTokens){let r=this.defaults.walkTokens,s=n.walkTokens;i.walkTokens=function(o){let a=[];return a.push(s.call(this,o)),r&&(a=a.concat(r.call(this,o))),a}}this.defaults={...this.defaults,...i}}),this}setOptions(t){return this.defaults={...this.defaults,...t},this}lexer(t,e){return G.lex(t,e!=null?e:this.defaults)}parser(t,e){return K.parse(t,e!=null?e:this.defaults)}parseMarkdown(t){return(e,n)=>{let i={...n},r={...this.defaults,...i},s=this.onError(!!r.silent,!!r.async);if(this.defaults.async===!0&&i.async===!1)return s(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof e>"u"||e===null)return s(new Error("marked(): input parameter is undefined or null"));if(typeof e!="string")return s(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected"));if(r.hooks&&(r.hooks.options=r,r.hooks.block=t),r.async)return(async()=>{let o=r.hooks?await r.hooks.preprocess(e):e,a=await(r.hooks?await r.hooks.provideLexer():t?G.lex:G.lexInline)(o,r),l=r.hooks?await r.hooks.processAllTokens(a):a;r.walkTokens&&await Promise.all(this.walkTokens(l,r.walkTokens));let c=await(r.hooks?await r.hooks.provideParser():t?K.parse:K.parseInline)(l,r);return r.hooks?await r.hooks.postprocess(c):c})().catch(s);try{r.hooks&&(e=r.hooks.preprocess(e));let o=(r.hooks?r.hooks.provideLexer():t?G.lex:G.lexInline)(e,r);r.hooks&&(o=r.hooks.processAllTokens(o)),r.walkTokens&&this.walkTokens(o,r.walkTokens);let a=(r.hooks?r.hooks.provideParser():t?K.parse:K.parseInline)(o,r);return r.hooks&&(a=r.hooks.postprocess(a)),a}catch(o){return s(o)}}}onError(t,e){return n=>{if(n.message+=`
Please report this to https://github.com/markedjs/marked.`,t){let i="<p>An error occurred:</p><pre>"+Z(n.message+"",!0)+"</pre>";return e?Promise.resolve(i):i}if(e)return Promise.reject(n);throw n}}},ne=new Gi;function v(t,e){return ne.parse(t,e)}v.options=v.setOptions=function(t){return ne.setOptions(t),v.defaults=ne.defaults,hr(v.defaults),v};v.getDefaults=xt;v.defaults=re;v.use=function(...t){return ne.use(...t),v.defaults=ne.defaults,hr(v.defaults),v};v.walkTokens=function(t,e){return ne.walkTokens(t,e)};v.parseInline=ne.parseInline;v.Parser=K;v.parser=K.parse;v.Renderer=We;v.TextRenderer=Mt;v.Lexer=G;v.lexer=G.lex;v.Tokenizer=Xe;v.Hooks=Me;v.parse=v;var la=v.options,ca=v.setOptions,ua=v.use,ha=v.walkTokens,ma=v.parseInline;var da=K.parse,pa=G.lex;var At="config.json",Ht="asri-enhance-side-memo";function St(t){try{if(!t||t.__asriNoRightClickAttached)return;t.__asriNoRightClickAttached=!0;let e=n=>{try{if(n.type==="contextmenu"){n.preventDefault(),n.stopPropagation();return}let i=n;if(typeof i.button=="number"&&i.button===2){try{i.preventDefault()}catch(r){}try{i.stopPropagation()}catch(r){}}}catch(i){}};try{t.addEventListener("contextmenu",e,{capture:!0,passive:!1}),t.addEventListener("mousedown",e,{capture:!0,passive:!1}),t.addEventListener("mouseup",e,{capture:!0,passive:!1})}catch(n){}}catch(e){}}function He(){let t=document.documentElement,e=!!(t&&t.hasAttribute("data-asri-enhance-side-memo"));if(Array.from(document.querySelectorAll(".protyle-content")).forEach(i=>{try{let r=i.querySelector('[data-type="inline-memo"], [memo]')!==null;e&&r?(i.classList.add("asri-enhance-sidememo"),i.classList.remove("asri-enhance-sidememo-none")):(i.classList.remove("asri-enhance-sidememo"),i.classList.add("asri-enhance-sidememo-none"))}catch(r){}}),e)wr();else try{Array.from(document.querySelectorAll(".asri-enhance-sidememo-container")).forEach(r=>{try{r.remove()}catch(s){}})}catch(i){}}function wr(){Array.from(document.querySelectorAll(".asri-enhance-sidememo .protyle-top .protyle-title")).forEach(n=>{try{let i=n.querySelector(".asri-enhance-sidememo-container");i||(i=document.createElement("div"),i.className="asri-enhance-sidememo-container protyle-custom",n.appendChild(i));try{St(i)}catch(s){}try{let s=getComputedStyle(n).position;(!s||s==="static")&&(n.style.position="relative")}catch(s){}let r=n.closest(".protyle-content");if(r){Ki(i,r);try{St(i)}catch(s){}}}catch(i){}}),Array.from(document.querySelectorAll(".protyle-top .protyle-title > .asri-enhance-sidememo-container")).forEach(n=>{let i=n.parentElement;if(i)if(i.closest(".asri-enhance-sidememo"))try{St(n)}catch(r){}else try{n.remove()}catch(r){}})}function Ki(t,e){for(Array.from(e.querySelectorAll('[data-type="inline-memo"], [memo]')).forEach(l=>{try{let c=l.__asriSidememoHandlers;c&&(c.enter&&l.removeEventListener("mouseenter",c.enter),c.leave&&l.removeEventListener("mouseleave",c.leave),delete l.__asriSidememoHandlers)}catch(c){}});t.firstChild;){let l=t.firstChild;try{let c=l.__asriSidememoHandlers;if(c){c.enter&&l.removeEventListener("mouseenter",c.enter),c.leave&&l.removeEventListener("mouseleave",c.leave),c.click&&l.removeEventListener("click",c.click),c.mousedown&&l.removeEventListener("mousedown",c.mousedown),c._preMove&&document.removeEventListener("mousemove",c._preMove),c._preUp&&document.removeEventListener("mouseup",c._preUp),c._dragMove&&document.removeEventListener("mousemove",c._dragMove),c._dragUp&&document.removeEventListener("mouseup",c._dragUp),c._timer&&clearTimeout(c._timer);try{c._asriContainer&&c._asriContainer.classList.remove("asri-enhance-sidememo-container-resize"),c._asriParent&&c._asriParent.classList.remove("asri-enhance-sidememo-container-resize")}catch(u){}delete l.__asriSidememoHandlers}}catch(c){}t.removeChild(l)}let i=Array.from(e.querySelectorAll('[data-type="inline-memo"], [memo]')),r=[];i.forEach(l=>{var c,u;try{if(l.hasAttribute("data-type")&&l.getAttribute("data-type")==="inline-memo"){let d=(l.textContent||"").trim(),m=l.getAttribute("data-inline-memo-content")||"",g=document.createElement("div");g.className="asri-enhance-sidememo-inlinememo-item",g.style.position="absolute";let h=document.createElement("div");h.className="asri-enhance-sidememo-inlinememo-item-title",h.textContent=d;let y=document.createElement("div");y.className="asri-enhance-sidememo-inlinememo-item-content";try{let x=typeof v=="function"?v(m):v&&(v.parse||v.default)?v.parse?v.parse(m):v.default?v.default(m):m:m;y.innerHTML=x}catch(x){y.textContent=m}g.appendChild(h),g.appendChild(y);let p=0;try{let x=l.getBoundingClientRect(),P=(c=t.parentElement)==null?void 0:c.getBoundingClientRect();if(P)p=Math.max(0,x.top-P.bottom+4);else{let I=e.getBoundingClientRect();p=Math.max(0,x.top-I.top)}}catch(x){}let w=l.getAttribute("asri-enhance-sidememo-uid");if(!w){w=`asri-enhance-sidememo-${Math.random().toString(36).slice(2,10)}${Date.now().toString(36)}`;try{l.setAttribute("asri-enhance-sidememo-uid",w)}catch(x){}}g.setAttribute("asri-enhance-sidememo-uid",w),g.style.top=`${p}px`,r.push({el:g,top:p,height:0,uid:w,sourceEl:l})}else if(l.hasAttribute("memo")){let d=(l.textContent||"").trim(),m=l.getAttribute("memo")||"",g=document.createElement("div");g.className="asri-enhance-sidememo-blockmemo-item",g.style.position="absolute";let h=document.createElement("div");h.className="asri-enhance-sidememo-blockmemo-item-title",h.textContent=d;let y=document.createElement("div");y.className="asri-enhance-sidememo-blockmemo-item-content";try{let x=typeof v=="function"?v(m):v&&(v.parse||v.default)?v.parse?v.parse(m):v.default?v.default(m):m:m;y.innerHTML=x}catch(x){y.textContent=m}g.appendChild(h),g.appendChild(y);let p=0;try{let x=l.getBoundingClientRect(),P=(u=t.parentElement)==null?void 0:u.getBoundingClientRect();if(P)p=Math.max(0,x.top-P.bottom+4);else{let I=e.getBoundingClientRect();p=Math.max(0,x.top-I.top)}}catch(x){}let w=l.getAttribute("asri-enhance-sidememo-uid");if(!w){w=`asri-enhance-sidememo-${Math.random().toString(36).slice(2,10)}${Date.now().toString(36)}`;try{l.setAttribute("asri-enhance-sidememo-uid",w)}catch(x){}}g.setAttribute("asri-enhance-sidememo-uid",w),g.style.top=`${p}px`,r.push({el:g,top:p,height:0,uid:w,sourceEl:l})}}catch(d){}});let s=document.createDocumentFragment();r.forEach(l=>s.appendChild(l.el)),t.appendChild(s),r.forEach(l=>{try{l.height=Math.ceil(l.el.getBoundingClientRect().height)}catch(c){l.height=0}});let o=8;r.sort((l,c)=>l.top-c.top);let a=0;r.forEach(l=>{let c=Math.max(0,l.top),u=Math.max(c,a);l.el.style.top=`${u}px`,a=u+l.height+o}),r.forEach(l=>{var c;try{let u=(c=l.sourceEl)!=null?c:null;if(!u)return;let d=()=>u.classList.add("asri-enhance-sidememo-highlight"),m=()=>u.classList.remove("asri-enhance-sidememo-highlight"),g=()=>l.el.classList.add("asri-enhance-sidememo-highlight"),h=()=>l.el.classList.remove("asri-enhance-sidememo-highlight");l.el.addEventListener("mouseenter",d),l.el.addEventListener("mouseleave",m),u.addEventListener("mouseenter",g),u.addEventListener("mouseleave",h);let y=p=>{if(p.button!==0)return;let w=p.clientX,x=p.clientY,P=A=>{w=A.clientX,x=A.clientY,(Math.abs(A.clientX-p.clientX)>6||Math.abs(A.clientY-p.clientY)>6)&&(l.el.__asriSidememoHandlers&&l.el.__asriSidememoHandlers._timer&&(clearTimeout(l.el.__asriSidememoHandlers._timer),l.el.__asriSidememoHandlers._timer=null),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",I))},I=()=>{l.el.__asriSidememoHandlers&&l.el.__asriSidememoHandlers._timer&&(clearTimeout(l.el.__asriSidememoHandlers._timer),l.el.__asriSidememoHandlers._timer=null),document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",I)};document.addEventListener("mousemove",P),document.addEventListener("mouseup",I);let M=window.setTimeout(()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",I);let A=w,B=u.closest(".asri-enhance-sidememo");if(!B)return;let N=t;try{N.classList.add("asri-enhance-sidememo-container-resize")}catch(L){}let W=getComputedStyle(B).getPropertyValue("--asri-enhance-sidememo-container-width")||"",V=Math.max(100,Math.min(500,Math.round(parseFloat(W)||200))),q=null,F=null;q=L=>{try{let j=Math.max(100,Math.min(500,Math.round(V+(A-L.clientX))));B.style.setProperty("--asri-enhance-sidememo-container-width",`${j}px`)}catch(j){}},F=()=>{try{q&&document.removeEventListener("mousemove",q),F&&document.removeEventListener("mouseup",F)}catch(j){}let L=l.el.__asriSidememoHandlers;if(L){try{L._asriContainer&&L._asriContainer.classList.remove("asri-enhance-sidememo-container-resize"),L._asriParent&&L._asriParent.classList.remove("asri-enhance-sidememo-container-resize")}catch(j){}L._dragMove=null,L._dragUp=null,L._asriParent=null,L._asriContainer=null}};let S=l.el.__asriSidememoHandlers||{};S._dragMove=q,S._dragUp=F,S._asriParent=B,S._asriContainer=N,l.el.__asriSidememoHandlers=S,document.addEventListener("mousemove",q),document.addEventListener("mouseup",F)},300),$=l.el.__asriSidememoHandlers||{};$._preMove=P,$._preUp=I,$._timer=M,l.el.__asriSidememoHandlers=$};try{let p=l.el.querySelector(".asri-enhance-sidememo-inlinememo-item-title, .asri-enhance-sidememo-blockmemo-item-title");if(p){let w=I=>{try{I.preventDefault(),I.stopPropagation()}catch(M){}try{if(u.hasAttribute&&u.hasAttribute("memo")){let M=null;try{M=u.querySelector(".protyle-attr .protyle-attr--memo")}catch(W){M=null}let $=(M!=null?M:u).getBoundingClientRect(),A=Math.round($.left+$.width/2),B=Math.round($.top+$.height/2),N=new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window,button:0,clientX:A,clientY:B});try{M?M.dispatchEvent(N):u.dispatchEvent(N)}catch(W){}}else{let M=u.getBoundingClientRect(),$=Math.round(M.left+M.width/2),A=Math.round(M.top+M.height/2),B=new MouseEvent("contextmenu",{bubbles:!0,cancelable:!0,view:window,button:2,clientX:$,clientY:A});try{u.dispatchEvent(B)}catch(N){}}}catch(M){}};p.addEventListener("click",w);let x=l.el.__asriSidememoHandlers||{},P=Object.assign(x,{enter:d,leave:m,click:w,mousedown:y});l.el.__asriSidememoHandlers=P,l.el.addEventListener("mousedown",y)}else{let w=l.el.__asriSidememoHandlers||{},x=Object.assign(w,{enter:d,leave:m,mousedown:y});l.el.__asriSidememoHandlers=x,l.el.addEventListener("mousedown",y)}}catch(p){let w=l.el.__asriSidememoHandlers||{},x=Object.assign(w,{enter:d,leave:m,mousedown:y});l.el.__asriSidememoHandlers=x,l.el.addEventListener("mousedown",y)}try{u.__asriSidememoHandlers={enter:g,leave:h}}catch(p){}}catch(u){}})}var ue=null;function Ve(){try{Array.from(document.querySelectorAll(".asri-enhance-sidememo-container")).forEach(i=>{try{Array.from(i.children).forEach(r=>{try{let s=r.__asriSidememoHandlers;if(s){if(s.enter&&r.removeEventListener("mouseenter",s.enter),s.leave&&r.removeEventListener("mouseleave",s.leave),s.click&&r.removeEventListener("click",s.click),s.mousedown&&r.removeEventListener("mousedown",s.mousedown),s._preMove&&document.removeEventListener("mousemove",s._preMove),s._preUp&&document.removeEventListener("mouseup",s._preUp),s._dragMove&&document.removeEventListener("mousemove",s._dragMove),s._dragUp&&document.removeEventListener("mouseup",s._dragUp),s._timer&&clearTimeout(s._timer),s._asriContainer)try{s._asriContainer.classList.remove("asri-enhance-sidememo-container-resize")}catch(o){}if(s._asriParent)try{s._asriParent.classList.remove("asri-enhance-sidememo-container-resize")}catch(o){}delete r.__asriSidememoHandlers}}catch(s){}});try{i.remove()}catch(r){}}catch(r){}}),Array.from(document.querySelectorAll(".protyle-content")).forEach(i=>{try{i.classList.remove("asri-enhance-sidememo"),i.classList.remove("asri-enhance-sidememo-none"),Array.from(i.querySelectorAll('[data-type="inline-memo"], [memo]')).forEach(s=>{try{let o=s.__asriSidememoHandlers;o&&(o.enter&&s.removeEventListener("mouseenter",o.enter),o.leave&&s.removeEventListener("mouseleave",o.leave),delete s.__asriSidememoHandlers);try{s.removeAttribute("asri-enhance-sidememo-uid")}catch(a){}try{s.classList.remove("asri-enhance-sidememo-highlight")}catch(a){}}catch(o){}})}catch(r){}}),Array.from(document.querySelectorAll(".asri-enhance-sidememo-container-resize")).forEach(i=>{try{i.classList.remove("asri-enhance-sidememo-container-resize")}catch(r){}})}catch(t){}}async function Er(){if(!ue)try{let t=Be(/setUILayout|transactions|setBlockAttrs/,e=>{try{setTimeout(()=>{try{He(),wr()}catch(n){}},200)}catch(n){}});ue=()=>{try{t.disconnect()}catch(e){}ue=null}}catch(t){}}function Qe(){if(ue){try{ue()}catch(t){}ue=null}}async function Tr(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-side-memo"),r=await k(t,At)||{};i?(n.removeAttribute("data-asri-enhance-side-memo"),r[Ht]=!1,Ve(),He(),Qe()):(n.setAttribute("data-asri-enhance-side-memo","true"),r[Ht]=!0,He(),Er().catch(()=>{})),await _(t,At,r).catch(()=>{})}async function _r(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,At);i&&i[Ht]===!0?(n.setAttribute("data-asri-enhance-side-memo","true"),He(),Er().catch(()=>{})):(n.removeAttribute("data-asri-enhance-side-memo"),Ve(),He(),Qe())}var Rt="config.json",It="asri-enhance-sidebar-top-sticky";async function Cr(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-sidebar-top-sticky"),r=await k(t,Rt)||{};i?(n.removeAttribute("data-asri-enhance-sidebar-top-sticky"),r[It]=!1):(n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"),r[It]=!0),await _(t,Rt,r).catch(()=>{})}async function Lr(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,Rt);i&&i[It]===!0?n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"):n.removeAttribute("data-asri-enhance-sidebar-top-sticky")}var $t="config.json",Dt="asri-enhance-cover-image-fade";async function Pr(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-cover-image-fade"),r=await k(t,$t)||{};i?(n.removeAttribute("data-asri-enhance-cover-image-fade"),r[Dt]=!1):(n.setAttribute("data-asri-enhance-cover-image-fade","true"),r[Dt]=!0),await _(t,$t,r).catch(()=>{})}async function Mr(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,$t);i&&i[Dt]===!0?n.setAttribute("data-asri-enhance-cover-image-fade","true"):n.removeAttribute("data-asri-enhance-cover-image-fade")}var Bt="config.json",zt="asri-enhance-hide-tab-breadcrumb";async function Sr(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-hide-tab-breadcrumb"),r=await k(t,Bt)||{};i?(n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb"),r[zt]=!1):(n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"),r[zt]=!0),await _(t,Bt,r).catch(()=>{})}async function Ar(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,Bt);i&&i[zt]===!0?n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"):n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb")}var Nt="config.json",Ot="asri-enhance-paper-texture",Re="data-asri-enhance-paper-texture";async function Hr(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute(Re),r=await k(t,Nt)||{};i?(n.removeAttribute(Re),r[Ot]=!1):(n.setAttribute(Re,"true"),r[Ot]=!0),await _(t,Nt,r).catch(()=>{})}async function Rr(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,Nt);i&&i[Ot]===!0?n.setAttribute(Re,"true"):n.removeAttribute(Re)}var qt="config.json",Ft="asri-enhance-moreanimations";async function Ir(t,e){e&&(e.preventDefault(),e.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-moreanimations"),r=await k(t,qt)||{};i?(n.removeAttribute("data-asri-enhance-moreanimations"),r[Ft]=!1):(n.setAttribute("data-asri-enhance-moreanimations","true"),r[Ft]=!0),await _(t,qt,r).catch(()=>{})}async function $r(t,e){let n=document.documentElement;if(!n)return;let i=e!==void 0?e:await k(t,qt);i&&i[Ft]===!0?n.setAttribute("data-asri-enhance-moreanimations","true"):n.removeAttribute("data-asri-enhance-moreanimations")}var O='<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg>',z='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>';function Dr(t,e,n=100){let i,r,s=null,o=0,a=new Set,l=10,c=100,u=()=>{a.forEach(h=>window.clearTimeout(h)),a.clear()},d=(h,y)=>{let p=window.setTimeout(()=>{a.delete(p),h()},y);return a.add(p),p},m=h=>{i!==void 0&&window.clearTimeout(i),i=window.setTimeout(()=>{u();let y=(p=0)=>{var x,P,I,M,$,A,B,N,W,V,q,F;let w=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(w){let S=w.parentElement;if(S){if(!S.querySelector("#asri-enhance-palette")){let T=document.createElement("button");T.className="b3-menu__item asri-enhance",T.id="asri-enhance-palette",T.innerHTML=`${O}<span class="b3-menu__label">${((x=t.i18n)==null?void 0:x.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-sakura">${O}<span class="b3-menu__label">${((P=t.i18n)==null?void 0:P.sakura)||"Sakura"}</span></button><button class="b3-menu__item" id="asri-enhance-amber">${O}<span class="b3-menu__label">${((I=t.i18n)==null?void 0:I.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness">${O}<span class="b3-menu__label">${((M=t.i18n)==null?void 0:M.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight">${O}<span class="b3-menu__label">${(($=t.i18n)==null?void 0:$.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt">${O}<span class="b3-menu__label">${((A=t.i18n)==null?void 0:A.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine">${O}<span class="b3-menu__label">${((B=t.i18n)==null?void 0:B.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz">${O}<span class="b3-menu__label">${((N=t.i18n)==null?void 0:N.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen">${O}<span class="b3-menu__label">${((W=t.i18n)==null?void 0:W.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade">${O}<span class="b3-menu__label">${((V=t.i18n)==null?void 0:V.shade)||"Shade"}</span></button><button class="b3-menu__item" id="asri-enhance-gruvbox">${O}<span class="b3-menu__label">${((q=t.i18n)==null?void 0:q.gruvbox)||"Gruvbox"}</span></button><button class="b3-menu__item" id="asri-enhance-glitch">${O}<span class="b3-menu__label">${((F=t.i18n)==null?void 0:F.glitch)||"glitch"}</span></button></div></div>`,S.insertBefore(T,w)}let L=S.querySelector("#asri-enhance-amber");L&&(L.onclick=T=>nn(t,T));let j=S.querySelector("#asri-enhance-sakura");j&&(j.onclick=T=>an(t,T));let pe=S.querySelector("#asri-enhance-wilderness");pe&&(pe.onclick=T=>cn(t,T));let fe=S.querySelector("#asri-enhance-midnight");fe&&(fe.onclick=T=>mn(t,T));let ge=S.querySelector("#asri-enhance-salt");ge&&(ge.onclick=T=>fn(t,T));let be=S.querySelector("#asri-enhance-rosepine");be&&(be.onclick=T=>yn(t,T));let f=S.querySelector("#asri-enhance-topaz");f&&(f.onclick=T=>xn(t,T));let ye=S.querySelector("#asri-enhance-oxygen");ye&&(ye.onclick=T=>Tn(t,T));let ke=S.querySelector("#asri-enhance-shade");ke&&(ke.onclick=T=>Ln(t,T));let ve=S.querySelector("#asri-enhance-gruvbox");ve&&(ve.onclick=T=>Sn(t,T));let xe=S.querySelector("#asri-enhance-glitch");xe&&(xe.onclick=T=>Rn(t,T))}e(h);return}p+1<l?d(()=>y(p+1),c):e(h)};y(),i=void 0},n)},g=()=>{let h=document.querySelector("#barMode");if(h){s=h,h.addEventListener("click",m,!0),r=void 0;return}o+=1,o<l?r=window.setTimeout(g,c):r=void 0};return g(),()=>{r!==void 0&&(window.clearTimeout(r),r=void 0),u(),s&&(s.removeEventListener("click",m,!0),s=null),i!==void 0&&(window.clearTimeout(i),i=void 0)}}function Br(t,e=100){let n,i,r=null,s=0,o=new Set,a=10,l=100,c=()=>{o.forEach(g=>window.clearTimeout(g)),o.clear()},u=(g,h)=>{let y=window.setTimeout(()=>{o.delete(y),g()},h);return o.add(y),y},d=g=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{c();let h=(y=0)=>{var w,x,P,I,M,$,A,B,N,W,V,q,F,S;let p=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(p){let L=p.parentElement;if(L){if(!L.querySelector("#asri-enhance-more")){let f=document.createElement("button");f.className="b3-menu__item asri-enhance",f.id="asri-enhance-more",f.innerHTML=`${z}<span class="b3-menu__label">${((w=t.i18n)==null?void 0:w.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-detail-adjustment">${z}<span class="b3-menu__label">${((x=t.i18n)==null?void 0:x.detailAdjustment)||"detailAdjustment"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"></div></div></button><button class="b3-menu__item" id="asri-enhance-typewriter">${z}<span class="b3-menu__label">${((P=t.i18n)==null?void 0:P.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line">${z}<span class="b3-menu__label">${((I=t.i18n)==null?void 0:I.listBulletLine)||"listBulletLine"}</span></button><button class="b3-menu__item" id="asri-enhance-vertical-tab">${z}<span class="b3-menu__label">${((M=t.i18n)==null?void 0:M.verticalTab)||"verticalTab"}</span></button><button class="b3-menu__item" id="asri-enhance-sidememo">${z}<span class="b3-menu__label">${(($=t.i18n)==null?void 0:$.sidememo)||"sidememo"}</span></button></div></div>`,p.nextSibling?L.insertBefore(f,p.nextSibling):L.appendChild(f)}let j=L.querySelector("#asri-enhance-typewriter");j&&(j.onclick=f=>Fn(t,f));let pe=L.querySelector("#asri-enhance-list-bullet-line");pe&&(pe.onclick=f=>Xn(t,f));let fe=L.querySelector("#asri-enhance-vertical-tab");fe&&(fe.onclick=f=>rr(t,f));let ge=L.querySelector("#asri-enhance-sidememo");ge&&(ge.onclick=f=>Tr(t,f));let be=L.querySelector("#asri-enhance-detail-adjustment");if(be){let f=be.querySelector(".b3-menu__submenu .b3-menu__items");if(f&&!f.querySelector("#asri-enhance-sidebar-top-sticky")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-sidebar-top-sticky",b.innerHTML=`${z}<span class="b3-menu__label">${((A=t.i18n)==null?void 0:A.sidebarTopSticky)||"sidebarTopSticky"}</span>`,f.appendChild(b)}let ye=f==null?void 0:f.querySelector("#asri-enhance-sidebar-top-sticky");if(ye&&(ye.onclick=b=>Cr(t,b)),f&&!f.querySelector("#asri-enhance-cover-image-fade")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-cover-image-fade",b.innerHTML=`${z}<span class="b3-menu__label">${((B=t.i18n)==null?void 0:B.coverImageFade)||"coverImageFade"}</span>`,f.appendChild(b)}let ke=f==null?void 0:f.querySelector("#asri-enhance-cover-image-fade");if(ke&&(ke.onclick=b=>Pr(t,b)),f&&!f.querySelector("#asri-enhance-paper-texture")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-paper-texture",b.innerHTML=`${z}<span class="b3-menu__label">${((N=t.i18n)==null?void 0:N.paperTexture)||"paperTexture"}</span>`,f.appendChild(b)}let ve=f==null?void 0:f.querySelector("#asri-enhance-paper-texture");if(ve&&(ve.onclick=b=>Hr(t,b)),f&&!f.querySelector("#asri-enhance-colored-heading")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-colored-heading",b.innerHTML=`${z}<span class="b3-menu__label">${((W=t.i18n)==null?void 0:W.coloredHeading)||"coloredHeading"}</span>`,f.appendChild(b)}let xe=f==null?void 0:f.querySelector("#asri-enhance-colored-heading");if(xe&&(xe.onclick=b=>$n(t,b)),f&&!f.querySelector("#asri-enhance-heading-level-hint")){let b=document.createElement("button");if(b.className="b3-menu__item",b.id="asri-enhance-heading-level-hint",b.innerHTML=`${z}<span class="b3-menu__label">${((V=t.i18n)==null?void 0:V.headingLevelHint)||"headingLevelHint"}</span>`,f.querySelector("#asri-enhance-colored-tree")){let Kr=f.querySelector("#asri-enhance-colored-tree");f.insertBefore(b,Kr)}else f.appendChild(b)}let T=f==null?void 0:f.querySelector("#asri-enhance-heading-level-hint");if(T&&(T.onclick=b=>Bn(t,b)),f&&!f.querySelector("#asri-enhance-colored-tree")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-colored-tree",b.innerHTML=`${z}<span class="b3-menu__label">${((q=t.i18n)==null?void 0:q.coloredTree)||"coloredTree"}</span>`,f.appendChild(b)}let Zt=f==null?void 0:f.querySelector("#asri-enhance-colored-tree");if(Zt&&(Zt.onclick=b=>Nn(t,b)),f&&!f.querySelector("#asri-enhance-hide-tab-breadcrumb")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-hide-tab-breadcrumb",b.innerHTML=`${z}<span class="b3-menu__label">${((F=t.i18n)==null?void 0:F.hideTabBreadcrumb)||"hideTabBreadcrumb"}</span>`,f.appendChild(b)}let Yt=f==null?void 0:f.querySelector("#asri-enhance-hide-tab-breadcrumb");if(Yt&&(Yt.onclick=b=>Sr(t,b)),f&&!f.querySelector("#asri-enhance-moreanimations")){let b=document.createElement("button");b.className="b3-menu__item",b.id="asri-enhance-moreanimations",b.innerHTML=`${z}<span class="b3-menu__label">${((S=t.i18n)==null?void 0:S.moreAnimations)||"moreAnimations"}</span>`,f.appendChild(b)}let Vt=f==null?void 0:f.querySelector("#asri-enhance-moreanimations");Vt&&(Vt.onclick=b=>Ir(t,b))}}return}y+1<a&&u(()=>h(y+1),l)};h(),n=void 0},e)},m=()=>{let g=document.querySelector("#barMode");if(g){r=g,g.addEventListener("click",d,!0),i=void 0;return}s+=1,s<a?i=window.setTimeout(m,l):i=void 0};return m(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),c(),r&&(r.removeEventListener("click",d,!0),r=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var Kt=!1,Y=null,Gt=0,U=null,he=null,me=null,de=null;function Ut(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function ie(){if(Kt=!1,U=null,Y!==null&&(clearInterval(Y),Y=null),he){try{he.disconnect()}catch(t){}he=null}if(me){try{me.disconnect()}catch(t){}me=null}}function jt(t){return!!(t&&document.body.contains(t)&&!t.classList.contains("fn__none"))}function Xt(){if(U){if(!he){he=new MutationObserver(()=>{jt(U)||ie()});try{he.observe(U,{attributes:!0,attributeFilter:["class","style"]})}catch(t){}}if(!me){me=new MutationObserver(()=>{jt(U)||ie()});try{me.observe(document.body,{childList:!0,subtree:!0})}catch(t){}}}}function Ui(){let t=Ut();return t?(U=t,Xt(),!0):(Gt=0,Y=setInterval(()=>{Gt+=1;let e=Ut();e?(U=e,clearInterval(Y),Y=null,Xt()):Gt>=10&&(clearInterval(Y),Y=null,ie())},100),!1)}function ji(t){return t?Array.from(t.querySelectorAll(".b3-list-item")):[]}function Or(t){return t?t.querySelector(".b3-list-item--focus"):null}function Xi(t){return t.map(e=>{let n=e.getBoundingClientRect();return{el:e,x:n.left+n.width/2,y:n.top+n.height/2}})}function Wi(t,e,n){if(!e||t.length===0)return null;let i=e.getBoundingClientRect(),r={x:i.left+i.width/2,y:i.top+i.height/2,el:e},s=Xi(t),o=Math.max(i.width/2,10),a;switch(n){case"ArrowUp":a=m=>m.y<r.y-1&&Math.abs(m.x-r.x)<=o;break;case"ArrowDown":a=m=>m.y>r.y+1&&Math.abs(m.x-r.x)<=o;break;case"ArrowLeft":a=m=>m.x<r.x-1;break;case"ArrowRight":a=m=>m.x>r.x+1;break;default:return null}let l=s.filter(m=>m.el!==e&&a(m));if(l.length===0)return null;let c=(m,g)=>{let h=m.x-g.x,y=m.y-g.y;return h*h+y*y},u=l[0],d=c(u,r);for(let m=1;m<l.length;m++){let g=c(l[m],r);g<d&&(u=l[m],d=g)}return u.el}function zr(t){if(!U||!t)return;let e=Or(U);if(e!==t){e&&e.classList.remove("b3-list-item--focus"),t.classList.add("b3-list-item--focus");try{t.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function Zi(t,e){var i,r;let n=t.indexOf(e);return n===-1?(i=t[0])!=null?i:null:n+1<t.length?t[n+1]:(r=t[0])!=null?r:null}function Yi(t,e){var i,r;let n=t.indexOf(e);return n===-1?(i=t[t.length-1])!=null?i:null:n-1>=0?t[n-1]:(r=t[t.length-1])!=null?r:null}function Nr(t,e){let n=e.getBoundingClientRect(),i=n.top+n.height/2,r=[];for(let s of t){if(s===e)continue;let o=s.getBoundingClientRect(),a=o.top+o.height/2,l=Math.min(n.height,o.height)/2;Math.abs(a-i)<=l&&r.push(s)}return r}function Vi(t){return t.map(e=>({el:e,x:e.getBoundingClientRect().left})).sort((e,n)=>e.x-n.x).map(e=>e.el)}function Qi(t){return t.map(e=>({el:e,x:e.getBoundingClientRect().left})).sort((e,n)=>n.x-e.x).map(e=>e.el)}var Ji=t=>{var l,c;if(t.key==="/"){ie(),Kt=!0,Ui();return}if(!Kt)return;if(t.key==="Escape"){ie();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key))return;let n=U||Ut();if(!n||!jt(n)){ie();return}t.preventDefault(),t.stopPropagation(),U=n,Xt();let i=ji(n);if(i.length===0)return;let r=Or(n);r||(r=i[0],r.classList.add("b3-list-item--focus"));let s=Wi(i,r,t.key);if(s){zr(s);return}let o=null,a=t.key;if(a==="ArrowDown")o=Zi(i,r);else if(a==="ArrowUp")o=Yi(i,r);else if(a==="ArrowRight"){let u=Nr(i,r);u.length>0&&(o=(l=Vi(u)[0])!=null?l:null)}else if(a==="ArrowLeft"){let u=Nr(i,r);u.length>0&&(o=(c=Qi(u)[0])!=null?c:null)}o&&o!==r&&zr(o)};function qr(){typeof document!="undefined"&&(de||(de=Ji,document.addEventListener("keydown",de,{capture:!0})))}function Fr(){typeof document!="undefined"&&(de&&(document.removeEventListener("keydown",de,{capture:!0}),de=null),ie())}var Wt=class extends Gr.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null;this.themeModeChangeTimers=[];this.paletteDisableMouseUpHandler=null;this.paletteDisableDebounceTimer=null}async applyAllConfigs(n){await Promise.all([rn(this,n).catch(()=>{}),on(this,n).catch(()=>{}),un(this,n).catch(()=>{}),dn(this,n).catch(()=>{}),gn(this,n).catch(()=>{}),kn(this,n).catch(()=>{}),wn(this,n).catch(()=>{}),_n(this,n).catch(()=>{}),Pn(this,n).catch(()=>{}),An(this,n).catch(()=>{}),In(this,n).catch(()=>{}),Dn(this,n).catch(()=>{}),On(this,n).catch(()=>{}),zn(this,n).catch(()=>{}),Gn(this,n).catch(()=>{}),Wn(this,n).catch(()=>{}),ir(this,n).catch(()=>{}),_r(this,n).catch(()=>{}),Lr(this,n).catch(()=>{}),Mr(this,n).catch(()=>{}),Ar(this,n).catch(()=>{}),Rr(this,n).catch(()=>{}),$r(this,n).catch(()=>{})])}async onload(){this.unsubscribeBarModeClick=Dr(this,()=>{}),this.unsubscribeTopbarFusionPlus=Br(this),this.asriConfigClickHandler=r=>{queueMicrotask(()=>{let s=r.target;if(!s||s.closest("#asri-enhance-amber")||s.closest("#asri-enhance-sakura")||s.closest("#asri-enhance-wilderness")||s.closest("#asri-enhance-midnight")||s.closest("#asri-enhance-salt")||s.closest("#asri-enhance-rosepine")||s.closest("#asri-enhance-topaz")||s.closest("#asri-enhance-oxygen")||s.closest("#asri-enhance-shade")||s.closest("#asri-enhance-gruvbox")||s.closest("#asri-enhance-glitch"))return;let o=s.closest(".asri-config");o&&o.id!=="topbarFusionPlus"&&et.forEach(a=>{Qt(this,a,"config.json").catch(()=>{})})})},document.addEventListener("click",this.asriConfigClickHandler,!0),this.paletteDisableMouseUpHandler=r=>{queueMicrotask(()=>{var a;let s=r.target;if(!s)return;(((a=s.id)==null?void 0:a.startsWith("prst-palette"))||s.closest("[id^='prst-palette']")!==null||s.id==="pickColor"||s.closest("#pickColor")!==null||s.id==="followSysAccent"||s.closest("#followSysAccent")!==null||s.id==="followCoverImgColor"||s.closest("#followCoverImgColor")!==null)&&(this.paletteDisableDebounceTimer!==null&&clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=window.setTimeout(()=>{en(this,"config.json").then(()=>{k(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{})}).catch(()=>{}),this.paletteDisableDebounceTimer=null},200))})},document.addEventListener("mouseup",this.paletteDisableMouseUpHandler,!1);let n=await k(this,"config.json"),i=document.documentElement;i&&(this.themeModeObserver=new MutationObserver(r=>{queueMicrotask(()=>{for(let s of r)if(s.type==="attributes"&&s.attributeName==="data-theme-mode"){this.themeModeChangeTimers.forEach(l=>{clearTimeout(l)}),this.themeModeChangeTimers=[],k(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{});let o=window.setTimeout(()=>{k(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{})},100);this.themeModeChangeTimers.push(o);let a=window.setTimeout(()=>{k(this,"config.json").then(l=>{this.applyAllConfigs(l).catch(()=>{})}).catch(()=>{})},500);this.themeModeChangeTimers.push(a)}})}),this.themeModeObserver.observe(i,{attributes:!0,attributeFilter:["data-theme-mode"]})),await this.applyAllConfigs(n),qr(),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},100),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),this.themeModeChangeTimers.forEach(n=>{clearTimeout(n)}),this.themeModeChangeTimers=[],this.paletteDisableMouseUpHandler&&(document.removeEventListener("mouseup",this.paletteDisableMouseUpHandler,!0),this.paletteDisableMouseUpHandler=null),this.paletteDisableDebounceTimer!==null&&(clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=null),Zn(),Te(),Fr(),Ge(),Ve(),Qe()}async uninstall(){this.onunload(),await Jt(this,"config.json").catch(()=>{})}};module.exports=Wt;
