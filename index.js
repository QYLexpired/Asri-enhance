var Wt=require("siyuan");var ue="asri-enhance-",me=["amber","wilderness","midnight","salt","rosepine","topaz","oxygen","shade","gruvbox","glitch"];async function f(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(o){throw o}}async function m(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function ze(e,t,n="config.json"){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";o.getAttribute("data-asri-palette")===t&&o.removeAttribute("data-asri-palette");let r=await m(e,n);if(!r)return;let l=`${ue}${t}`,c=r[l];c!==void 0&&(typeof c=="boolean"?delete r[l]:c&&typeof c=="object"&&(c[i]=!1,r[l]=c),await f(e,n,r))}async function qe(e,t="config.json"){let n=await m(e,t);if(!n)return;let o=!1;Object.keys(n).forEach(i=>{i.startsWith(ue)&&(delete n[i],o=!0)}),o&&await f(e,t,n)}async function Ke(e,t="config.json"){let n=document.documentElement;if(!n)return;let o=n.getAttribute("data-theme-mode")||"light",i=await m(e,t);if(!i)return;let r=!1;me.forEach(l=>{let c=`${ue}${l}`,u=i[c];u!==void 0&&(typeof u=="boolean"?(delete i[c],r=!0):u&&typeof u=="object"&&u[o]===!0&&(u[o]=!1,i[c]=u,r=!0))}),r&&await f(e,t,i)}var de="config.json";async function b(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light";if(o.getAttribute("data-asri-palette")===t.name)return;let l=await m(e,de)||{},c=l[t.configKey]||{light:!1,dark:!1},u=()=>{o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name),c[i]=!0;for(let p of t.otherConfigKeys)if(l[p]){let g=l[p];typeof g=="object"&&(g[i]=!1,l[p]=g)}l[t.configKey]=c};document.startViewTransition?await document.startViewTransition(()=>{u()}).finished.catch(()=>{}):u(),await f(e,de,l).catch(()=>{})}async function v(e,t,n){let o=document.documentElement;if(!o)return;let i=o.getAttribute("data-theme-mode")||"light",r=n!==void 0?n:await m(e,de);if(r&&r[t.configKey]){let l=r[t.configKey];(typeof l=="boolean"?l:l[i]===!0)?(o.removeAttribute("data-asri-palette"),o.setAttribute("data-asri-palette",t.name)):o.getAttribute("data-asri-palette")===t.name&&o.removeAttribute("data-asri-palette")}}var Ge={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function je(e,t){return b(e,Ge,t)}async function $e(e,t){return v(e,Ge,t)}var Ue={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Ve(e,t){return b(e,Ue,t)}async function Ye(e,t){return v(e,Ue,t)}var We={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Xe(e,t){return b(e,We,t)}async function Ze(e,t){return v(e,We,t)}var Je={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function Qe(e,t){return b(e,Je,t)}async function et(e,t){return v(e,Je,t)}var tt={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function nt(e,t){return b(e,tt,t)}async function ot(e,t){return v(e,tt,t)}var it={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function rt(e,t){return b(e,it,t)}async function at(e,t){return v(e,it,t)}var st={name:"oxygen",configKey:"asri-enhance-oxygen",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-shade","asri-enhance-gruvbox"]};async function lt(e,t){return b(e,st,t)}async function ct(e,t){return v(e,st,t)}var ut={name:"shade",configKey:"asri-enhance-shade",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-gruvbox"]};async function mt(e,t){return b(e,ut,t)}async function dt(e,t){return v(e,ut,t)}var ht={name:"gruvbox",configKey:"asri-enhance-gruvbox",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade"]};async function ft(e,t){return b(e,ht,t)}async function pt(e,t){return v(e,ht,t)}var gt={name:"glitch",configKey:"asri-enhance-glitch",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz","asri-enhance-oxygen","asri-enhance-shade","asri-enhance-gruvbox"]};async function bt(e,t){return b(e,gt,t)}async function vt(e,t){return v(e,gt,t)}var he="config.json",fe="asri-enhance-coloredheading";async function yt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-coloredheading"),i=await m(e,he)||{};o?(n.removeAttribute("data-asri-enhance-coloredheading"),i[fe]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),i[fe]=!0),await f(e,he,i).catch(()=>{})}async function wt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,he);o&&o[fe]===!0?n.setAttribute("data-asri-enhance-coloredheading","true"):n.removeAttribute("data-asri-enhance-coloredheading")}var pe="config.json",ge="asri-enhance-headinglevelhint",ie="data-asri-enhance-headinglevelhint";async function Ct(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute(ie),i=await m(e,pe)||{};o?(n.removeAttribute(ie),i[ge]=!1):(n.setAttribute(ie,"true"),i[ge]=!0),await f(e,pe,i).catch(()=>{})}async function Et(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,pe);o&&o[ge]===!0?n.setAttribute(ie,"true"):n.removeAttribute(ie)}var be="config.json",ve="asri-enhance-colored-tree";async function Pt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-colored-tree"),i=await m(e,be)||{};o?(n.removeAttribute("data-asri-enhance-colored-tree"),i[ve]=!1):(n.setAttribute("data-asri-enhance-colored-tree","true"),i[ve]=!0),await f(e,be,i).catch(()=>{})}async function Tt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,be);o&&o[ve]===!0?n.setAttribute("data-asri-enhance-colored-tree","true"):n.removeAttribute("data-asri-enhance-colored-tree")}var ye="config.json",we="asri-enhance-typewriter",re=null,Ce=!1,le=!1,M=null,B=!1,Zt=500;function Jt(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,o;if(n.nodeType===Node.TEXT_NODE?o=n.parentElement:o=n.nodeType===Node.ELEMENT_NODE?n:null,o){let i=o;for(;i&&i!==document.body;){if(i.hasAttribute&&i.hasAttribute("contenteditable"))return o;i=i.parentElement}}return null}function Qt(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,o=window.innerWidth,i=t.top+t.height/2,r=t.left+t.width/2,l=n/2,c=o/2,u=Math.abs(i-l),p=Math.abs(r-c);return u>5||p>5}function en(e){e&&Qt(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function tn(){let e=null,t=()=>{if(!Ce||le||B)return;let r=Jt();r!==e&&(e=r,r&&setTimeout(()=>{en(r)},50))},n=()=>{le=!0,B=!1,M=window.setTimeout(()=>{B=!0},Zt)},o=()=>{le=!1,M&&(clearTimeout(M),M=null),B?setTimeout(()=>{B=!1},200):setTimeout(t,10)},i=()=>{le=!1,B=!1,M&&(clearTimeout(M),M=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",o),document.addEventListener("mouseleave",i),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",o),document.removeEventListener("mouseleave",i),M&&(clearTimeout(M),M=null)}}}function xt(){re&&ae(),Ce=!0,re=tn()}function ae(){Ce=!1,re&&(re.destroy(),re=null)}async function _t(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-typewriter"),i=await m(e,ye)||{};o?(n.removeAttribute("data-asri-enhance-typewriter"),i[we]=!1,ae()):(n.setAttribute("data-asri-enhance-typewriter","true"),i[we]=!0,xt()),await f(e,ye,i).catch(()=>{})}async function Mt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,ye);o&&o[we]===!0?(n.setAttribute("data-asri-enhance-typewriter","true"),xt()):(n.removeAttribute("data-asri-enhance-typewriter"),ae())}var Ee="config.json",Pe="asri-enhance-listbulletline",nn=".asri-bullet-highlight,.asri-bullet-line",Te="asri-bullet-highlight",k="asri-bullet-line",S="--asri-bullet-line-height",N=null,A=null,ce=new Set,Lt=()=>{document.querySelectorAll(nn).forEach(e=>{e.classList.remove(Te,k),e.style.removeProperty(S)}),ce.clear()},on=e=>{e.classList.remove(Te,k),e.style.removeProperty(S)},rn=(e,t,n)=>{if(e.classList.add(Te),t&&n){let o=e.getBoundingClientRect(),i=n.getBoundingClientRect();e.style.setProperty(S,`${o.top-i.top}px`),e.classList.add(k)}},kt=()=>{var o,i;let e=window.getSelection(),t=[];if(e&&e.rangeCount){let r=e.getRangeAt(0).startContainer;for(;r&&r.nodeType!==Node.ELEMENT_NODE;)r=r.parentElement;for(;r;){let l=r;if(((o=l.dataset)==null?void 0:o.type)==="NodeListItem"&&t.push(l),(i=l.classList)!=null&&i.contains("protyle-wysiwyg"))break;r=l.parentElement}}let n=new Set(t);ce.forEach(r=>{n.has(r)||on(r)}),t.forEach((r,l)=>{let c=l<t.length-1,u=c?t[l+1]:void 0;if(!ce.has(r))rn(r,c,u);else if(c&&u){let p=r.getBoundingClientRect(),g=u.getBoundingClientRect(),x=`${p.top-g.top}px`;r.style.getPropertyValue(S)!==x&&r.style.setProperty(S,x),r.classList.contains(k)||r.classList.add(k)}else r.classList.contains(k)&&(r.classList.remove(k),r.style.removeProperty(S))}),ce=n},At=()=>{N||(N=()=>{A&&clearTimeout(A),A=setTimeout(()=>{kt(),A=null},50)},document.addEventListener("selectionchange",N),kt())},xe=()=>{if(!N){Lt();return}A&&(clearTimeout(A),A=null),document.removeEventListener("selectionchange",N),N=null,Lt()};async function Ht(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-listbulletline"),i=await m(e,Ee)||{};o?(n.removeAttribute("data-asri-enhance-listbulletline"),i[Pe]=!1,xe()):(n.setAttribute("data-asri-enhance-listbulletline","true"),i[Pe]=!0,At()),await f(e,Ee,i).catch(()=>{})}async function It(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,Ee);o&&o[Pe]===!0?(n.setAttribute("data-asri-enhance-listbulletline","true"),At()):(n.removeAttribute("data-asri-enhance-listbulletline"),xe())}var Dt=()=>{xe()};var _e="config.json",Me="asri-enhance-sidebar-top-sticky";async function Bt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-sidebar-top-sticky"),i=await m(e,_e)||{};o?(n.removeAttribute("data-asri-enhance-sidebar-top-sticky"),i[Me]=!1):(n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"),i[Me]=!0),await f(e,_e,i).catch(()=>{})}async function St(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,_e);o&&o[Me]===!0?n.setAttribute("data-asri-enhance-sidebar-top-sticky","true"):n.removeAttribute("data-asri-enhance-sidebar-top-sticky")}var Le="config.json",ke="asri-enhance-cover-image-fade";async function Nt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-cover-image-fade"),i=await m(e,Le)||{};o?(n.removeAttribute("data-asri-enhance-cover-image-fade"),i[ke]=!1):(n.setAttribute("data-asri-enhance-cover-image-fade","true"),i[ke]=!0),await f(e,Le,i).catch(()=>{})}async function Ft(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,Le);o&&o[ke]===!0?n.setAttribute("data-asri-enhance-cover-image-fade","true"):n.removeAttribute("data-asri-enhance-cover-image-fade")}var Ae="config.json",He="asri-enhance-hide-tab-breadcrumb";async function Rt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute("data-asri-enhance-hide-tab-breadcrumb"),i=await m(e,Ae)||{};o?(n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb"),i[He]=!1):(n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"),i[He]=!0),await f(e,Ae,i).catch(()=>{})}async function Ot(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,Ae);o&&o[He]===!0?n.setAttribute("data-asri-enhance-hide-tab-breadcrumb","true"):n.removeAttribute("data-asri-enhance-hide-tab-breadcrumb")}var Ie="config.json",De="asri-enhance-paper-texture",se="data-asri-enhance-paper-texture";async function zt(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let o=n.hasAttribute(se),i=await m(e,Ie)||{};o?(n.removeAttribute(se),i[De]=!1):(n.setAttribute(se,"true"),i[De]=!0),await f(e,Ie,i).catch(()=>{})}async function qt(e,t){let n=document.documentElement;if(!n)return;let o=t!==void 0?t:await m(e,Ie);o&&o[De]===!0?n.setAttribute(se,"true"):n.removeAttribute(se)}function Kt(e,t,n=100){let o,i,r=null,l=0,c=new Set,u=10,p=100,g=()=>{c.forEach(y=>window.clearTimeout(y)),c.clear()},x=(y,E)=>{let P=window.setTimeout(()=>{c.delete(P),y()},E);return c.add(P),P},h=y=>{o!==void 0&&window.clearTimeout(o),o=window.setTimeout(()=>{g();let E=(P=0)=>{var z,q,K,G,j,$,U,V,Y,W,_;let I=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(I){let C=I.parentElement;if(C){if(!C.querySelector("#asri-enhance-palette")){let a=document.createElement("button");a.className="b3-menu__item asri-enhance",a.id="asri-enhance-palette",a.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((G=e.i18n)==null?void 0:G.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((j=e.i18n)==null?void 0:j.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((U=e.i18n)==null?void 0:U.goldenTopaz)||"Golden Topaz"}</span></button><button class="b3-menu__item" id="asri-enhance-oxygen"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((V=e.i18n)==null?void 0:V.oxygen)||"Oxygen"}</span></button><button class="b3-menu__item" id="asri-enhance-shade"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((Y=e.i18n)==null?void 0:Y.shade)||"Shade"}</span></button><button class="b3-menu__item" id="asri-enhance-gruvbox"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((W=e.i18n)==null?void 0:W.gruvbox)||"Gruvbox"}</span></button></div></div>`,C.insertBefore(a,I)}let X=C.querySelector("#asri-enhance-amber");X&&(X.onclick=a=>je(e,a));let Z=C.querySelector("#asri-enhance-wilderness");Z&&(Z.onclick=a=>Ve(e,a));let s=C.querySelector("#asri-enhance-midnight");s&&(s.onclick=a=>Xe(e,a));let J=C.querySelector("#asri-enhance-salt");J&&(J.onclick=a=>Qe(e,a));let Q=C.querySelector("#asri-enhance-rosepine");Q&&(Q.onclick=a=>nt(e,a));let ee=C.querySelector("#asri-enhance-topaz");ee&&(ee.onclick=a=>rt(e,a));let te=C.querySelector("#asri-enhance-oxygen");te&&(te.onclick=a=>lt(e,a));let ne=C.querySelector("#asri-enhance-shade");ne&&(ne.onclick=a=>mt(e,a));let oe=C.querySelector("#asri-enhance-gruvbox");oe&&(oe.onclick=a=>ft(e,a));let D=C.querySelector("#asri-enhance-palette .b3-menu__submenu .b3-menu__items");if(D&&!D.querySelector("#asri-enhance-glitch")){let a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-glitch",a.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((_=e.i18n)==null?void 0:_.glitch)||"glitch"}</span>`,D.appendChild(a)}let d=C.querySelector("#asri-enhance-glitch");d&&(d.onclick=a=>bt(e,a))}t(y);return}P+1<u?x(()=>E(P+1),p):t(y)};E(),o=void 0},n)},w=()=>{let y=document.querySelector("#barMode");if(y){r=y,y.addEventListener("click",h,!0),i=void 0;return}l+=1,l<u?i=window.setTimeout(w,p):i=void 0};return w(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),g(),r&&(r.removeEventListener("click",h,!0),r=null),o!==void 0&&(window.clearTimeout(o),o=void 0)}}function Gt(e,t=100){let n,o,i=null,r=0,l=new Set,c=10,u=100,p=()=>{l.forEach(w=>window.clearTimeout(w)),l.clear()},g=(w,y)=>{let E=window.setTimeout(()=>{l.delete(E),w()},y);return l.add(E),E},x=w=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{p();let y=(E=0)=>{var I,z,q,K,G,j,$,U,V,Y,W;let P=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(P){let _=P.parentElement;if(_){if(!_.querySelector("#asri-enhance-more")){let s=document.createElement("button");s.className="b3-menu__item asri-enhance",s.id="asri-enhance-more",s.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((I=e.i18n)==null?void 0:I.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-detail-adjustment"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((z=e.i18n)==null?void 0:z.detailAdjustment)||"detailAdjustment"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"></div></div></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((q=e.i18n)==null?void 0:q.typewriterMode)||"typewriterMode"}</span></button><button class="b3-menu__item" id="asri-enhance-list-bullet-line"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((K=e.i18n)==null?void 0:K.listBulletLine)||"listBulletLine"}</span></button></div></div>`,P.nextSibling?_.insertBefore(s,P.nextSibling):_.appendChild(s)}let C=_.querySelector("#asri-enhance-typewriter");C&&(C.onclick=s=>_t(e,s));let X=_.querySelector("#asri-enhance-list-bullet-line");X&&(X.onclick=s=>Ht(e,s));let Z=_.querySelector("#asri-enhance-detail-adjustment");if(Z){let s=Z.querySelector(".b3-menu__submenu .b3-menu__items");if(s&&!s.querySelector("#asri-enhance-sidebar-top-sticky")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-sidebar-top-sticky",a.innerHTML=`${d}<span class="b3-menu__label">${((G=e.i18n)==null?void 0:G.sidebarTopSticky)||"sidebarTopSticky"}</span>`,s.appendChild(a)}let J=s==null?void 0:s.querySelector("#asri-enhance-sidebar-top-sticky");if(J&&(J.onclick=d=>Bt(e,d)),s&&!s.querySelector("#asri-enhance-cover-image-fade")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-cover-image-fade",a.innerHTML=`${d}<span class="b3-menu__label">${((j=e.i18n)==null?void 0:j.coverImageFade)||"coverImageFade"}</span>`,s.appendChild(a)}let Q=s==null?void 0:s.querySelector("#asri-enhance-cover-image-fade");if(Q&&(Q.onclick=d=>Nt(e,d)),s&&!s.querySelector("#asri-enhance-paper-texture")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-paper-texture",a.innerHTML=`${d}<span class="b3-menu__label">${(($=e.i18n)==null?void 0:$.paperTexture)||"paperTexture"}</span>`,s.appendChild(a)}let ee=s==null?void 0:s.querySelector("#asri-enhance-paper-texture");if(ee&&(ee.onclick=d=>zt(e,d)),s&&!s.querySelector("#asri-enhance-colored-heading")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-colored-heading",a.innerHTML=`${d}<span class="b3-menu__label">${((U=e.i18n)==null?void 0:U.coloredHeading)||"coloredHeading"}</span>`,s.appendChild(a)}let te=s==null?void 0:s.querySelector("#asri-enhance-colored-heading");if(te&&(te.onclick=d=>yt(e,d)),s&&!s.querySelector("#asri-enhance-heading-level-hint")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");if(a.className="b3-menu__item",a.id="asri-enhance-heading-level-hint",a.innerHTML=`${d}<span class="b3-menu__label">${((V=e.i18n)==null?void 0:V.headingLevelHint)||"headingLevelHint"}</span>`,s.querySelector("#asri-enhance-colored-tree")){let Xt=s.querySelector("#asri-enhance-colored-tree");s.insertBefore(a,Xt)}else s.appendChild(a)}let ne=s==null?void 0:s.querySelector("#asri-enhance-heading-level-hint");if(ne&&(ne.onclick=d=>Ct(e,d)),s&&!s.querySelector("#asri-enhance-colored-tree")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-colored-tree",a.innerHTML=`${d}<span class="b3-menu__label">${((Y=e.i18n)==null?void 0:Y.coloredTree)||"coloredTree"}</span>`,s.appendChild(a)}let oe=s==null?void 0:s.querySelector("#asri-enhance-colored-tree");if(oe&&(oe.onclick=d=>Pt(e,d)),s&&!s.querySelector("#asri-enhance-hide-tab-breadcrumb")){let d='<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg>',a=document.createElement("button");a.className="b3-menu__item",a.id="asri-enhance-hide-tab-breadcrumb",a.innerHTML=`${d}<span class="b3-menu__label">${((W=e.i18n)==null?void 0:W.hideTabBreadcrumb)||"hideTabBreadcrumb"}</span>`,s.appendChild(a)}let D=s==null?void 0:s.querySelector("#asri-enhance-hide-tab-breadcrumb");D&&(D.onclick=d=>Rt(e,d))}}return}E+1<c&&g(()=>y(E+1),u)};y(),n=void 0},t)},h=()=>{let w=document.querySelector("#barMode");if(w){i=w,w.addEventListener("click",x,!0),o=void 0;return}r+=1,r<c?o=window.setTimeout(h,u):o=void 0};return h(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),p(),i&&(i.removeEventListener("click",x,!0),i=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var Se=!1,L=null,Be=0,T=null,F=null,R=null,O=null;function Ne(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function H(){if(Se=!1,T=null,L!==null&&(clearInterval(L),L=null),F){try{F.disconnect()}catch(e){}F=null}if(R){try{R.disconnect()}catch(e){}R=null}}function Fe(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function Re(){if(T){if(!F){F=new MutationObserver(()=>{Fe(T)||H()});try{F.observe(T,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!R){R=new MutationObserver(()=>{Fe(T)||H()});try{R.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function an(){let e=Ne();return e?(T=e,Re(),!0):(Be=0,L=setInterval(()=>{Be+=1;let t=Ne();t?(T=t,clearInterval(L),L=null,Re()):Be>=10&&(clearInterval(L),L=null,H())},100),!1)}function sn(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function Ut(e){return e?e.querySelector(".b3-list-item--focus"):null}function ln(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function cn(e,t,n){if(!t||e.length===0)return null;let o=t.getBoundingClientRect(),i={x:o.left+o.width/2,y:o.top+o.height/2,el:t},r=ln(e),l=Math.max(o.width/2,10),c;switch(n){case"ArrowUp":c=h=>h.y<i.y-1&&Math.abs(h.x-i.x)<=l;break;case"ArrowDown":c=h=>h.y>i.y+1&&Math.abs(h.x-i.x)<=l;break;case"ArrowLeft":c=h=>h.x<i.x-1;break;case"ArrowRight":c=h=>h.x>i.x+1;break;default:return null}let u=r.filter(h=>h.el!==t&&c(h));if(u.length===0)return null;let p=(h,w)=>{let y=h.x-w.x,E=h.y-w.y;return y*y+E*E},g=u[0],x=p(g,i);for(let h=1;h<u.length;h++){let w=p(u[h],i);w<x&&(g=u[h],x=w)}return g.el}function jt(e){if(!T||!e)return;let t=Ut(T);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function un(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[0])!=null?o:null:n+1<e.length?e[n+1]:(i=e[0])!=null?i:null}function mn(e,t){var o,i;let n=e.indexOf(t);return n===-1?(o=e[e.length-1])!=null?o:null:n-1>=0?e[n-1]:(i=e[e.length-1])!=null?i:null}function $t(e,t){let n=t.getBoundingClientRect(),o=n.top+n.height/2,i=[];for(let r of e){if(r===t)continue;let l=r.getBoundingClientRect(),c=l.top+l.height/2,u=Math.min(n.height,l.height)/2;Math.abs(c-o)<=u&&i.push(r)}return i}function dn(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function hn(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var fn=e=>{var u,p;if(e.key==="/"){H(),Se=!0,an();return}if(!Se)return;if(e.key==="Escape"){H();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=T||Ne();if(!n||!Fe(n)){H();return}e.preventDefault(),e.stopPropagation(),T=n,Re();let o=sn(n);if(o.length===0)return;let i=Ut(n);i||(i=o[0],i.classList.add("b3-list-item--focus"));let r=cn(o,i,e.key);if(r){jt(r);return}let l=null,c=e.key;if(c==="ArrowDown")l=un(o,i);else if(c==="ArrowUp")l=mn(o,i);else if(c==="ArrowRight"){let g=$t(o,i);g.length>0&&(l=(u=dn(g)[0])!=null?u:null)}else if(c==="ArrowLeft"){let g=$t(o,i);g.length>0&&(l=(p=hn(g)[0])!=null?p:null)}l&&l!==i&&jt(l)};function Vt(){typeof document!="undefined"&&(O||(O=fn,document.addEventListener("keydown",O,{capture:!0})))}function Yt(){typeof document!="undefined"&&(O&&(document.removeEventListener("keydown",O,{capture:!0}),O=null),H())}var Oe=class extends Wt.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null;this.themeModeChangeTimers=[];this.paletteDisableMouseUpHandler=null;this.paletteDisableDebounceTimer=null}async applyAllConfigs(n){await Promise.all([$e(this,n).catch(()=>{}),Ye(this,n).catch(()=>{}),Ze(this,n).catch(()=>{}),et(this,n).catch(()=>{}),ot(this,n).catch(()=>{}),at(this,n).catch(()=>{}),ct(this,n).catch(()=>{}),dt(this,n).catch(()=>{}),pt(this,n).catch(()=>{}),vt(this,n).catch(()=>{}),wt(this,n).catch(()=>{}),Tt(this,n).catch(()=>{}),Et(this,n).catch(()=>{}),Mt(this,n).catch(()=>{}),It(this,n).catch(()=>{}),St(this,n).catch(()=>{}),Ft(this,n).catch(()=>{}),Ot(this,n).catch(()=>{}),qt(this,n).catch(()=>{})])}async onload(){this.unsubscribeBarModeClick=Kt(this,()=>{}),this.unsubscribeTopbarFusionPlus=Gt(this),this.asriConfigClickHandler=i=>{queueMicrotask(()=>{let r=i.target;if(!r||r.closest("#asri-enhance-amber")||r.closest("#asri-enhance-wilderness")||r.closest("#asri-enhance-midnight")||r.closest("#asri-enhance-salt")||r.closest("#asri-enhance-rosepine")||r.closest("#asri-enhance-topaz")||r.closest("#asri-enhance-oxygen")||r.closest("#asri-enhance-shade")||r.closest("#asri-enhance-gruvbox")||r.closest("#asri-enhance-glitch"))return;let l=r.closest(".asri-config");l&&l.id!=="topbarFusionPlus"&&me.forEach(c=>{ze(this,c,"config.json").catch(()=>{})})})},document.addEventListener("click",this.asriConfigClickHandler,!0),this.paletteDisableMouseUpHandler=i=>{queueMicrotask(()=>{var c;let r=i.target;if(!r)return;(((c=r.id)==null?void 0:c.startsWith("prst-palette"))||r.closest("[id^='prst-palette']")!==null||r.id==="pickColor"||r.closest("#pickColor")!==null||r.id==="followSysAccent"||r.closest("#followSysAccent")!==null||r.id==="followCoverImgColor"||r.closest("#followCoverImgColor")!==null)&&(this.paletteDisableDebounceTimer!==null&&clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=window.setTimeout(()=>{Ke(this,"config.json").then(()=>{m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{})}).catch(()=>{}),this.paletteDisableDebounceTimer=null},200))})},document.addEventListener("mouseup",this.paletteDisableMouseUpHandler,!1);let n=await m(this,"config.json"),o=document.documentElement;o&&(this.themeModeObserver=new MutationObserver(i=>{queueMicrotask(()=>{for(let r of i)if(r.type==="attributes"&&r.attributeName==="data-theme-mode"){this.themeModeChangeTimers.forEach(u=>{clearTimeout(u)}),this.themeModeChangeTimers=[],m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{});let l=window.setTimeout(()=>{m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{})},100);this.themeModeChangeTimers.push(l);let c=window.setTimeout(()=>{m(this,"config.json").then(u=>{this.applyAllConfigs(u).catch(()=>{})}).catch(()=>{})},500);this.themeModeChangeTimers.push(c)}})}),this.themeModeObserver.observe(o,{attributes:!0,attributeFilter:["data-theme-mode"]})),await this.applyAllConfigs(n),Vt(),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},100),setTimeout(()=>{this.applyAllConfigs(n).catch(()=>{})},500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),this.themeModeChangeTimers.forEach(n=>{clearTimeout(n)}),this.themeModeChangeTimers=[],this.paletteDisableMouseUpHandler&&(document.removeEventListener("mouseup",this.paletteDisableMouseUpHandler,!0),this.paletteDisableMouseUpHandler=null),this.paletteDisableDebounceTimer!==null&&(clearTimeout(this.paletteDisableDebounceTimer),this.paletteDisableDebounceTimer=null),Dt(),ae(),Yt()}async uninstall(){this.onunload(),await qe(this,"config.json").catch(()=>{})}};module.exports=Oe;
