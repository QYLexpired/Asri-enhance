var $e=require("siyuan");var be="asri-enhance-",ve=["amber","wilderness","midnight","salt","rosepine","topaz"];async function P(e,t,n){if(!e.saveData)throw new Error("Plugin saveData method is not available");try{await e.saveData(t,n)}catch(i){throw i}}async function b(e,t){if(!e.loadData)return null;try{return await e.loadData(t)||null}catch(n){return null}}async function we(e,t,n="config.json"){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";i.getAttribute("data-asri-palette")===t&&i.removeAttribute("data-asri-palette");let s=await b(e,n);if(!s)return;let r=`${be}${t}`,a=s[r];a!==void 0&&(typeof a=="boolean"?delete s[r]:a&&typeof a=="object"&&(a[o]=!1,s[r]=a),await P(e,n,s))}async function ye(e,t="config.json"){let n=await b(e,t);if(!n)return;let i=!1;Object.keys(n).forEach(o=>{o.startsWith(be)&&(delete n[o],i=!0)}),i&&await P(e,t,n)}var Z="config.json";async function v(e,t,n){let i=document.documentElement;if(!i)return;let o=i.getAttribute("data-theme-mode")||"light";if(i.getAttribute("data-asri-palette")===t.name)return;let r=await b(e,Z)||{},a=r[t.configKey]||{light:!1,dark:!1},c=()=>{i.removeAttribute("data-asri-palette"),i.setAttribute("data-asri-palette",t.name),a[o]=!0;for(let m of t.otherConfigKeys)if(r[m]){let d=r[m];typeof d=="object"&&(d[o]=!1,r[m]=d)}r[t.configKey]=a};document.startViewTransition?await document.startViewTransition(()=>{c()}).finished.catch(()=>{}):c(),await P(e,Z,r).catch(()=>{})}async function w(e,t){let n=document.documentElement;if(!n)return;let i=n.getAttribute("data-theme-mode")||"light",o=await b(e,Z);if(o&&o[t.configKey]){let s=o[t.configKey];(typeof s=="boolean"?s:s[i]===!0)?(n.removeAttribute("data-asri-palette"),n.setAttribute("data-asri-palette",t.name)):n.getAttribute("data-asri-palette")===t.name&&n.removeAttribute("data-asri-palette")}}var Ee={name:"amber",configKey:"asri-enhance-amber",otherConfigKeys:["asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz"]};async function Ce(e,t){return v(e,Ee,t)}async function z(e){return w(e,Ee)}var Pe={name:"wilderness",configKey:"asri-enhance-wilderness",otherConfigKeys:["asri-enhance-amber","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz"]};async function Me(e,t){return v(e,Pe,t)}async function R(e){return w(e,Pe)}var Te={name:"midnight",configKey:"asri-enhance-midnight",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-salt","asri-enhance-rosepine","asri-enhance-topaz"]};async function ke(e,t){return v(e,Te,t)}async function K(e){return w(e,Te)}var _e={name:"salt",configKey:"asri-enhance-salt",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-rosepine","asri-enhance-topaz"]};async function Le(e,t){return v(e,_e,t)}async function j(e){return w(e,_e)}var xe={name:"topaz",configKey:"asri-enhance-topaz",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-rosepine"]};async function Ae(e,t){return v(e,xe,t)}async function q(e){return w(e,xe)}var He={name:"rosepine",configKey:"asri-enhance-rosepine",otherConfigKeys:["asri-enhance-amber","asri-enhance-wilderness","asri-enhance-midnight","asri-enhance-salt","asri-enhance-topaz"]};async function Ie(e,t){return v(e,He,t)}async function $(e){return w(e,He)}var J="config.json",Q="asri-enhance-coloredheading";async function Ne(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredheading"),o=await b(e,J)||{};i?(n.removeAttribute("data-asri-enhance-coloredheading"),o[Q]=!1):(n.setAttribute("data-asri-enhance-coloredheading","true"),o[Q]=!0),await P(e,J,o).catch(()=>{})}async function G(e){let t=document.documentElement;if(!t)return;let n=await b(e,J);n&&n[Q]===!0?t.setAttribute("data-asri-enhance-coloredheading","true"):t.removeAttribute("data-asri-enhance-coloredheading")}var ee="config.json",te="asri-enhance-coloredoutline";async function Oe(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-coloredoutline"),o=await b(e,ee)||{};i?(n.removeAttribute("data-asri-enhance-coloredoutline"),o[te]=!1):(n.setAttribute("data-asri-enhance-coloredoutline","true"),o[te]=!0),await P(e,ee,o).catch(()=>{})}async function W(e){let t=document.documentElement;if(!t)return;let n=await b(e,ee);n&&n[te]===!0?t.setAttribute("data-asri-enhance-coloredoutline","true"):t.removeAttribute("data-asri-enhance-coloredoutline")}var ne="config.json",oe="asri-enhance-typewriter",U=null,ie=!1,Y=!1,M=null,x=!1,Ue=500;function Ve(){let e=window.getSelection();if(!e||e.rangeCount===0)return null;let n=e.getRangeAt(0).commonAncestorContainer,i;if(n.nodeType===Node.TEXT_NODE?i=n.parentElement:i=n.nodeType===Node.ELEMENT_NODE?n:null,i){let o=i;for(;o&&o!==document.body;){if(o.hasAttribute&&o.hasAttribute("contenteditable"))return i;o=o.parentElement}}return null}function Ge(e){if(!e)return!1;let t=e.getBoundingClientRect(),n=window.innerHeight,i=window.innerWidth,o=t.top+t.height/2,s=t.left+t.width/2,r=n/2,a=i/2,c=Math.abs(o-r),m=Math.abs(s-a);return c>5||m>5}function We(e){e&&Ge(e)&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}function Ye(){let e=null,t=()=>{if(!ie||Y||x)return;let s=Ve();s!==e&&(e=s,s&&setTimeout(()=>{We(s)},50))},n=()=>{Y=!0,x=!1,M=window.setTimeout(()=>{x=!0},Ue)},i=()=>{Y=!1,M&&(clearTimeout(M),M=null),x?setTimeout(()=>{x=!1},200):setTimeout(t,10)},o=()=>{Y=!1,x=!1,M&&(clearTimeout(M),M=null)};return document.addEventListener("selectionchange",t),document.addEventListener("keydown",t),document.addEventListener("keyup",t),document.addEventListener("click",t),document.addEventListener("mousedown",n),document.addEventListener("mouseup",i),document.addEventListener("mouseleave",o),{destroy:()=>{document.removeEventListener("selectionchange",t),document.removeEventListener("keydown",t),document.removeEventListener("keyup",t),document.removeEventListener("click",t),document.removeEventListener("mousedown",n),document.removeEventListener("mouseup",i),document.removeEventListener("mouseleave",o),M&&(clearTimeout(M),M=null)}}}function Se(){U&&V(),ie=!0,U=Ye()}function V(){ie=!1,U&&(U.destroy(),U=null)}async function De(e,t){t&&(t.preventDefault(),t.stopPropagation());let n=document.documentElement;if(!n)return;let i=n.hasAttribute("data-asri-enhance-typewriter"),o=await b(e,ne)||{};i?(n.removeAttribute("data-asri-enhance-typewriter"),o[oe]=!1,V()):(n.setAttribute("data-asri-enhance-typewriter","true"),o[oe]=!0,Se()),await P(e,ne,o).catch(()=>{})}async function X(e){let t=document.documentElement;if(!t)return;let n=await b(e,ne);n&&n[oe]===!0?(t.setAttribute("data-asri-enhance-typewriter","true"),Se()):(t.removeAttribute("data-asri-enhance-typewriter"),V())}function Be(e,t,n=100){let i,o,s=null,r=0,a=new Set,c=10,m=100,d=()=>{a.forEach(h=>window.clearTimeout(h)),a.clear()},k=(h,g)=>{let y=window.setTimeout(()=>{a.delete(y),h()},g);return a.add(y),y},l=h=>{i!==void 0&&window.clearTimeout(i),i=window.setTimeout(()=>{d();let g=(y=0)=>{var N,O,S,C,D,B,F;let L=document.querySelector('#commonMenu[data-name="barmode"] #pickColor');if(L){let u=L.parentElement;if(u){if(!u.querySelector("#asri-enhance-palette")){let p=document.createElement("button");p.className="b3-menu__item asri-enhance",p.id="asri-enhance-palette",p.innerHTML=`<svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((N=e.i18n)==null?void 0:N.morePresetColors)||"morePresetColors"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-amber"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((O=e.i18n)==null?void 0:O.amber)||"amber"}</span></button><button class="b3-menu__item" id="asri-enhance-wilderness"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.wilderness)||"wilderness"}</span></button><button class="b3-menu__item" id="asri-enhance-midnight"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4 v.01"></path></g></svg><span class="b3-menu__label">${((C=e.i18n)==null?void 0:C.midnight)||"midnight"}</span></button><button class="b3-menu__item" id="asri-enhance-salt"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((D=e.i18n)==null?void 0:D.salt)||"salt"}</span></button><button class="b3-menu__item" id="asri-enhance-rosepine"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((B=e.i18n)==null?void 0:B.rosePine)||"Ros\xE9 Pine"}</span></button><button class="b3-menu__item" id="asri-enhance-topaz"><svg class="b3-menu__icon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M19 3h-4a2 2 0 0 0-2 2v12a4 4 0 0 0 8 0V5a2 2 0 0 0-2-2"></path><path d="m13 7.35l-2-2a2 2 0 0 0-2.828 0L5.344 8.178a2 2 0 0 0 0 2.828l9 9"></path><path d="M7.3 13H5a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h12m0-4v.01"></path></g></svg><span class="b3-menu__label">${((F=e.i18n)==null?void 0:F.goldenTopaz)||"Golden Topaz"}</span></button></div></div>`,u.insertBefore(p,L)}let me=u.querySelector("#asri-enhance-amber");me&&(me.onclick=p=>Ce(e,p));let de=u.querySelector("#asri-enhance-wilderness");de&&(de.onclick=p=>Me(e,p));let he=u.querySelector("#asri-enhance-midnight");he&&(he.onclick=p=>ke(e,p));let fe=u.querySelector("#asri-enhance-salt");fe&&(fe.onclick=p=>Le(e,p));let pe=u.querySelector("#asri-enhance-rosepine");pe&&(pe.onclick=p=>Ie(e,p));let ge=u.querySelector("#asri-enhance-topaz");ge&&(ge.onclick=p=>Ae(e,p))}t(h);return}y+1<c?k(()=>g(y+1),m):t(h)};g(),i=void 0},n)},f=()=>{let h=document.querySelector("#barMode");if(h){s=h,h.addEventListener("click",l,!0),o=void 0;return}r+=1,r<c?o=window.setTimeout(f,m):o=void 0};return f(),()=>{o!==void 0&&(window.clearTimeout(o),o=void 0),d(),s&&(s.removeEventListener("click",l,!0),s=null),i!==void 0&&(window.clearTimeout(i),i=void 0)}}function Fe(e,t=100){let n,i,o=null,s=0,r=new Set,a=10,c=100,m=()=>{r.forEach(f=>window.clearTimeout(f)),r.clear()},d=(f,h)=>{let g=window.setTimeout(()=>{r.delete(g),f()},h);return r.add(g),g},k=f=>{n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>{m();let h=(g=0)=>{var L,N,O,S;let y=document.querySelector('#commonMenu[data-name="barmode"] #topbarFusionPlus');if(y){let C=y.parentElement;if(C){if(!C.querySelector("#asri-enhance-more")){let u=document.createElement("button");u.className="b3-menu__item asri-enhance",u.id="asri-enhance-more",u.innerHTML=`<svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((L=e.i18n)==null?void 0:L.more)||"more"}</span><svg class="b3-menu__icon b3-menu__icon--small"><use xlink:href="#iconRight"></use></svg><div class="b3-menu__submenu"><div class="b3-menu__items"><button class="b3-menu__item" id="asri-enhance-colored-heading"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((N=e.i18n)==null?void 0:N.coloredHeading)||"coloredHeading"}</span></button><button class="b3-menu__item" id="asri-enhance-colored-outline"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((O=e.i18n)==null?void 0:O.coloredOutline)||"coloredOutline"}</span></button><button class="b3-menu__item" id="asri-enhance-typewriter"><svg class="b3-menu__icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em"><path d="M512 443.733333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 443.733333z m0-238.933333a68.266667 68.266667 0 1 1-0.034133 136.567467A68.266667 68.266667 0 0 1 512 204.8z m0 477.866667a68.266667 68.266667 0 1 1-0.034133 136.567466A68.266667 68.266667 0 0 1 512 682.666667z" fill="currentColor"></path></svg><span class="b3-menu__label">${((S=e.i18n)==null?void 0:S.typewriterMode)||"typewriterMode"}</span></button></div></div>`,y.nextSibling?C.insertBefore(u,y.nextSibling):C.appendChild(u)}let D=C.querySelector("#asri-enhance-colored-heading");D&&(D.onclick=u=>Ne(e,u));let B=C.querySelector("#asri-enhance-colored-outline");B&&(B.onclick=u=>Oe(e,u));let F=C.querySelector("#asri-enhance-typewriter");F&&(F.onclick=u=>De(e,u))}return}g+1<a&&d(()=>h(g+1),c)};h(),n=void 0},t)},l=()=>{let f=document.querySelector("#barMode");if(f){o=f,f.addEventListener("click",k,!0),i=void 0;return}s+=1,s<a?i=window.setTimeout(l,c):i=void 0};return l(),()=>{i!==void 0&&(window.clearTimeout(i),i=void 0),m(),o&&(o.removeEventListener("click",k,!0),o=null),n!==void 0&&(window.clearTimeout(n),n=void 0)}}var se=!1,T=null,re=0,E=null,A=null,H=null,I=null;function ae(){return document.querySelector(".protyle-hint.hint--menu:not(.fn__none)")}function _(){if(se=!1,E=null,T!==null&&(clearInterval(T),T=null),A){try{A.disconnect()}catch(e){}A=null}if(H){try{H.disconnect()}catch(e){}H=null}}function le(e){return!!(e&&document.body.contains(e)&&!e.classList.contains("fn__none"))}function ce(){if(E){if(!A){A=new MutationObserver(()=>{le(E)||_()});try{A.observe(E,{attributes:!0,attributeFilter:["class","style"]})}catch(e){}}if(!H){H=new MutationObserver(()=>{le(E)||_()});try{H.observe(document.body,{childList:!0,subtree:!0})}catch(e){}}}}function Xe(){let e=ae();return e?(E=e,ce(),!0):(re=0,T=setInterval(()=>{re+=1;let t=ae();t?(E=t,clearInterval(T),T=null,ce()):re>=10&&(clearInterval(T),T=null,_())},100),!1)}function Ze(e){return e?Array.from(e.querySelectorAll(".b3-list-item")):[]}function Ke(e){return e?e.querySelector(".b3-list-item--focus"):null}function Je(e){return e.map(t=>{let n=t.getBoundingClientRect();return{el:t,x:n.left+n.width/2,y:n.top+n.height/2}})}function Qe(e,t,n){if(!t||e.length===0)return null;let i=t.getBoundingClientRect(),o={x:i.left+i.width/2,y:i.top+i.height/2,el:t},s=Je(e),r=Math.max(i.width/2,10),a;switch(n){case"ArrowUp":a=l=>l.y<o.y-1&&Math.abs(l.x-o.x)<=r;break;case"ArrowDown":a=l=>l.y>o.y+1&&Math.abs(l.x-o.x)<=r;break;case"ArrowLeft":a=l=>l.x<o.x-1;break;case"ArrowRight":a=l=>l.x>o.x+1;break;default:return null}let c=s.filter(l=>l.el!==t&&a(l));if(c.length===0)return null;let m=(l,f)=>{let h=l.x-f.x,g=l.y-f.y;return h*h+g*g},d=c[0],k=m(d,o);for(let l=1;l<c.length;l++){let f=m(c[l],o);f<k&&(d=c[l],k=f)}return d.el}function ze(e){if(!E||!e)return;let t=Ke(E);if(t!==e){t&&t.classList.remove("b3-list-item--focus"),e.classList.add("b3-list-item--focus");try{e.scrollIntoView({block:"nearest",inline:"nearest"})}catch(n){}}}function et(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[0])!=null?i:null:n+1<e.length?e[n+1]:(o=e[0])!=null?o:null}function tt(e,t){var i,o;let n=e.indexOf(t);return n===-1?(i=e[e.length-1])!=null?i:null:n-1>=0?e[n-1]:(o=e[e.length-1])!=null?o:null}function Re(e,t){let n=t.getBoundingClientRect(),i=n.top+n.height/2,o=[];for(let s of e){if(s===t)continue;let r=s.getBoundingClientRect(),a=r.top+r.height/2,c=Math.min(n.height,r.height)/2;Math.abs(a-i)<=c&&o.push(s)}return o}function nt(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>t.x-n.x).map(t=>t.el)}function ot(e){return e.map(t=>({el:t,x:t.getBoundingClientRect().left})).sort((t,n)=>n.x-t.x).map(t=>t.el)}var it=e=>{var c,m;if(e.key==="/"){_(),se=!0,Xe();return}if(!se)return;if(e.key==="Escape"){_();return}if(!["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(e.key))return;let n=E||ae();if(!n||!le(n)){_();return}e.preventDefault(),e.stopPropagation(),E=n,ce();let i=Ze(n);if(i.length===0)return;let o=Ke(n);o||(o=i[0],o.classList.add("b3-list-item--focus"));let s=Qe(i,o,e.key);if(s){ze(s);return}let r=null,a=e.key;if(a==="ArrowDown")r=et(i,o);else if(a==="ArrowUp")r=tt(i,o);else if(a==="ArrowRight"){let d=Re(i,o);d.length>0&&(r=(c=nt(d)[0])!=null?c:null)}else if(a==="ArrowLeft"){let d=Re(i,o);d.length>0&&(r=(m=ot(d)[0])!=null?m:null)}r&&r!==o&&ze(r)};function je(){typeof document!="undefined"&&(I||(I=it,document.addEventListener("keydown",I,{capture:!0})))}function qe(){typeof document!="undefined"&&(I&&(document.removeEventListener("keydown",I,{capture:!0}),I=null),_())}var ue=class extends $e.Plugin{constructor(){super(...arguments);this.unsubscribeBarModeClick=null;this.unsubscribeTopbarFusionPlus=null;this.asriConfigClickHandler=null;this.themeModeObserver=null}async onload(){this.unsubscribeBarModeClick=Be(this,()=>{}),this.unsubscribeTopbarFusionPlus=Fe(this),this.asriConfigClickHandler=i=>{let o=i.target;if(!o||o.closest("#asri-enhance-amber")||o.closest("#asri-enhance-wilderness")||o.closest("#asri-enhance-midnight")||o.closest("#asri-enhance-salt")||o.closest("#asri-enhance-rosepine")||o.closest("#asri-enhance-topaz"))return;let s=o.closest(".asri-config");s&&s.id!=="topbarFusionPlus"&&ve.forEach(r=>{we(this,r,"config.json").catch(()=>{})})},document.addEventListener("click",this.asriConfigClickHandler,!0);let n=document.documentElement;n&&(this.themeModeObserver=new MutationObserver(i=>{for(let o of i)o.type==="attributes"&&o.attributeName==="data-theme-mode"&&(z(this).catch(()=>{}),R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),$(this).catch(()=>{}),q(this).catch(()=>{}))}),this.themeModeObserver.observe(n,{attributes:!0,attributeFilter:["data-theme-mode"]})),z(this).catch(()=>{}),R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),$(this).catch(()=>{}),q(this).catch(()=>{}),G(this).catch(()=>{}),W(this).catch(()=>{}),X(this).catch(()=>{}),je(),setTimeout(()=>{z(this).catch(()=>{}),R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),$(this).catch(()=>{}),q(this).catch(()=>{}),G(this).catch(()=>{}),W(this).catch(()=>{}),X(this).catch(()=>{})},500),setTimeout(()=>{z(this).catch(()=>{}),R(this).catch(()=>{}),K(this).catch(()=>{}),j(this).catch(()=>{}),$(this).catch(()=>{}),q(this).catch(()=>{}),G(this).catch(()=>{}),W(this).catch(()=>{}),X(this).catch(()=>{})},1500)}onunload(){this.unsubscribeBarModeClick&&(this.unsubscribeBarModeClick(),this.unsubscribeBarModeClick=null),this.unsubscribeTopbarFusionPlus&&(this.unsubscribeTopbarFusionPlus(),this.unsubscribeTopbarFusionPlus=null),this.asriConfigClickHandler&&(document.removeEventListener("click",this.asriConfigClickHandler,!0),this.asriConfigClickHandler=null),this.themeModeObserver&&(this.themeModeObserver.disconnect(),this.themeModeObserver=null),V(),qe()}async uninstall(){this.onunload(),await ye(this,"config.json").catch(()=>{})}};module.exports=ue;
